.. _2.1.3_c:

2.1.3 タッチスイッチモジュール
====================================

はじめに
-------------------

このプロジェクトでは、タッチスイッチモジュールについて学びます。このモジュールは、以下の利点を持つ従来のスイッチを置き換えることができます：操作が便利、タッチ感が良好、制御が正確、そして機械的な摩耗が最も少ない。

必要な部品
------------------------------

このプロジェクトには、以下の部品が必要です。

.. image:: ../img/2.1.3component.png
    :width: 700
    :align: center

全体のキットを購入することは確かに便利です。こちらがリンクです：

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - 名前	
        - このキットのアイテム
        - リンク
    *   - Raphael Kit
        - 337
        - |link_Raphael_kit|

以下のリンクから個別に購入することもできます。

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - コンポーネントの紹介
        - 購入リンク

    *   - :ref:`cpn_gpio_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_led`
        - |link_led_buy|
    *   - :ref:`cpn_touch_switch`
        - |link_touch_buy|

回路図
-----------------

.. image:: ../img/2.1.3circuit.png
    :width: 500
    :align: center

実験手順
------------------------------

**ステップ1:** 回路を組み立てる。

.. image:: ../img/2.1.3fritzing.png
    :width: 700
    :align: center

**ステップ2:** ディレクトリを変更する。

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/c/2.1.3/

**ステップ3:** コンパイルする。

.. raw:: html

   <run></run>

.. code-block::

    gcc 2.1.3_TouchSwitch.c -lwiringPi

**ステップ4:** 実行する。

.. raw:: html

   <run></run>

.. code-block::

    sudo ./a.out

コードが実行されている間、赤いLEDが点灯します。タッチスイッチモジュールをタップすると、黄色いLEDが点灯します。

.. note::

    実行後に動作しない、またはエラープロンプト「wiringPi.h: No such file or directory」が表示される場合は、 :ref:`install_wiringpi` を参照してください。

**コード**

.. code-block:: c

    #include <wiringPi.h>
    #include <stdio.h>

    #define touchPin		   0
    #define led1		   3
    #define led2 		   2

    int main(void)
    {
        // When initialize wiring failed, print message to screen
        if(wiringPiSetup() == -1){
            printf(etup w"siringPi failed !");
            return 1; 
        }
        
        pinMode(touchPin, INPUT);
        pinMode(led1, OUTPUT);
        pinMode(led2, OUTPUT);
        
        while(1){
            // touch switch high, led1 on
            if(digitalRead(touchPin) == 1){
                digitalWrite(led1, LOW);
                digitalWrite(led2, HIGH);
                printf("You touch it! \r\n");
            }
            // touch switch low, led2 on
            if(digitalRead(touchPin) == 0){
                digitalWrite(led2, LOW);
                digitalWrite(led1, HIGH);
            }
        }

        return 0;
    }

**コード説明**

.. code-block:: c

    #define touchPin		   0
    #define led1		   3
    #define led2 		   2
    
T_Extension BoardのGPIO17、GPIO22、GPIO27は、wiringPiのGPIO0、GPIO3、GPIO2に対応しています。GPIO0、GPIO3、GPIO2を ``touchPin``、 ``led1``、 ``led2`` に割り当てます。

.. code-block:: c

    pinMode(touchPin, INPUT);
    pinMode(led1, OUTPUT);
    pinMode(led2, OUTPUT);

``led1`` と ``led2`` を出力として設定し、それらに値を書き込みます。 ``touchPin`` を入力として設定し、それから値を読み取ります。

.. code-block:: c

    while(1){
        // touch switch high, led1 on
            if(digitalRead(touchPin) == 1){
            digitalWrite(led1, LOW);
            digitalWrite(led2, HIGH);
            printf("You touch it! \r\n");
        }
        // touch switch low, led2 on
        if(digitalRead(touchPin) == 0){
            digitalWrite(led2, LOW);
            digitalWrite(led1, HIGH);
        }
    }

無限ループを設定し、タッチスイッチモジュールをタップすると、 ``touchPin`` は高く、led1が点灯し、「You touch it!」と表示します。touchPinが低い場合、led2が点灯します。

現象の画像
------------------------

.. image:: ../img/2.1.3touch_switch_module.JPG
    :width: 500
    :align: center