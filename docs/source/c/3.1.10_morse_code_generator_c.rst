.. note::

    Ciao, benvenuto nella Community di appassionati di SunFounder Raspberry Pi & Arduino & ESP32 su Facebook! Approfondisci Raspberry Pi, Arduino ed ESP32 insieme agli altri appassionati.

    **PerchÃ© unirti a noi?**

    - **Supporto Esperto**: Risolvi problemi post-vendita e sfide tecniche con l'aiuto della nostra community e del nostro team.
    - **Impara e Condividi**: Scambia suggerimenti e tutorial per migliorare le tue competenze.
    - **Anteprime Esclusive**: Ottieni accesso anticipato ai nuovi annunci di prodotti e alle anteprime.
    - **Sconti Speciali**: Approfitta di sconti esclusivi sui nostri prodotti piÃ¹ recenti.
    - **Promozioni e Omaggi Festivi**: Partecipa a omaggi e promozioni speciali durante le festivitÃ .

    ğŸ‘‰ Sei pronto a esplorare e creare con noi? Clicca su [|link_sf_facebook|] e unisciti oggi stesso!

.. _3.1.10_c:

3.1.10 Generatore di Codice Morse
====================================

Introduzione
-----------------

In questo progetto, realizzeremo un generatore di codice Morse, dove digiti 
una serie di lettere inglesi nel Raspberry Pi e le fai apparire come codice Morse.

Componenti necessari
------------------------------

In questo progetto, avremo bisogno dei seguenti componenti.

.. image:: ../img/3.1.10.png
    :align: center

Ãˆ sicuramente conveniente acquistare un kit completo, ecco il link: 

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nome	
        - ELEMENTI IN QUESTO KIT
        - LINK
    *   - Kit Raphael
        - 337
        - |link_Raphael_kit|

Puoi anche acquistare i componenti separatamente dai link qui sotto.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUZIONE COMPONENTI
        - LINK DI ACQUISTO

    *   - :ref:`cpn_gpio_extension_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_led`
        - |link_led_buy|
    *   - :ref:`cpn_buzzer`
        - \-
    *   - :ref:`cpn_transistor`
        - |link_transistor_buy|

Schema elettrico
-----------------------

============ ======== ======== ===
T-Board Name physical wiringPi BCM
GPIO17       Pin 11   0        17
GPIO22       Pin 15   3        22
============ ======== ======== ===

.. image:: ../img/Schematic_three_one11.png
   :align: center

Procedura sperimentale
----------------------------

**Passo 1:** Costruisci il circuito. (Presta attenzione ai poli del cicalino: Quello con l'etichetta + Ã¨ il polo positivo e l'altro Ã¨ il negativo.)

.. image:: ../img/image269.png

**Passo 2**: Apri il file del codice.

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/raphael-kit/c/3.1.10/

**Passo 3**: Compila il codice.

.. raw:: html

   <run></run>

.. code-block:: 

    gcc 3.1.10_MorseCodeGenerator.c -lwiringPi

**Passo 4**: Esegui il file eseguibile.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo ./a.out

Dopo l'esecuzione del programma, digita una serie di caratteri e il cicalino e il LED invieranno i segnali corrispondenti in codice Morse.

.. note::

    Se non funziona dopo l'esecuzione o viene visualizzato un messaggio di errore: \"wiringPi.h: Nessun file o directory\", fai riferimento a :ref:`install_wiringpi`.

Spiegazione del codice
-------------------------------

.. code-block:: c

    structÂ MORSE{
    Â Â Â Â charÂ word;
    Â Â Â Â unsignedÂ charÂ *code;
    };

    structÂ MORSEÂ morseDict[]=
    {
    Â Â Â Â {'A',"01"},Â {'B',"1000"},Â {'C',"1010"},Â {'D',"100"},Â {'E',"0"},Â 
    Â Â Â Â {'F',"0010"},Â {'G',"110"},Â {'H',"0000"},Â {'I',"00"},Â {'J',"0111"},Â 
    Â Â Â Â {'K',"101"},Â {'L',"0100"},Â {'M',"11"},Â {'N',"10"},Â {'O',"111"},Â 
    Â Â Â Â {'P',"0110"},Â {'Q',"1101"},Â {'R',"010"},Â {'S',"000"},Â {'T',"1"},
    Â Â Â Â {'U',"001"},Â {'V',"0001"},Â {'W',"011"},Â {'X',"1001"},Â {'Y',"1011"},Â 
    Â Â Â Â {'Z',"1100"},{'1',"01111"},Â {'2',"00111"},Â {'3',"00011"},Â {'4',"00001"},Â 
    Â Â Â Â {'5',"00000"},{'6',"10000"},Â {'7',"11000"},Â {'8',"11100"},Â {'9',"11110"},
    Â Â Â Â {'0',"11111"},{'?',"001100"},Â {'/',"10010"},Â {',',"110011"},Â {'.',"010101"},
    Â Â Â Â {';',"101010"},{'!',"101011"},Â {'@',"011010"},Â {':',"111000"}
    };

Questa struttura MORSE Ã¨ il dizionario del codice Morse, contenente caratteri A-Z, 
numeri 0-9 e simboli â€œ?â€ â€œ/â€ â€œ:â€ â€œ,â€ â€œ.â€ â€œ;â€ â€œ!â€ â€œ@â€ .

.. code-block:: c

    charÂ *lookup(charÂ key,structÂ MORSEÂ *dict,intÂ length)
    {
    Â Â Â Â forÂ (intÂ i=0;i<length;i++)
    Â Â Â Â {
    Â Â Â Â Â Â Â Â if(dict[i].word==key){
    Â Â Â Â Â Â Â Â Â Â Â Â returnÂ dict[i].code;
    Â Â Â Â Â Â Â Â }
    Â Â Â Â }Â Â Â Â 
    }

La funzione ``lookup()`` funziona cercando nel dizionario. Definisce una chiave 
``key`` per cercare nella struttura ``morseDict`` e restituisce le informazioni 
corrispondentiâ€”il ``code`` della parola.

.. code-block:: c

    voidÂ on(){
    Â Â Â Â digitalWrite(ALedPin,HIGH);
    Â Â Â Â digitalWrite(BeepPin,HIGH);Â Â Â Â Â 
    }

Crea una funzione ``on()`` per accendere il cicalino e il LED.

.. code-block:: c

    voidÂ off(){
    Â Â Â Â digitalWrite(ALedPin,LOW);
    Â Â Â Â digitalWrite(BeepPin,LOW);
    }

La funzione ``off()`` spegne il cicalino e il LED.

.. code-block:: c

    voidÂ beep(intÂ dt){
    Â Â Â Â on();
    Â Â Â Â delay(dt);
    Â Â Â Â off();
    Â Â Â Â delay(dt);
    }

Definisci una funzione ``beep()`` per far emettere suoni e lampeggiare il cicalino e il LED a intervalli di **dt**.

.. code-block:: c

    voidÂ morsecode(charÂ *code){
    Â Â Â Â intÂ pauseÂ =Â 250;
    Â Â Â Â charÂ *pointÂ =Â NULL;
    Â Â Â Â intÂ lengthÂ =Â sizeof(morseDict)/sizeof(morseDict[0]);
    Â Â Â Â forÂ (intÂ i=0;i<strlen(code);i++)
    Â Â Â Â {
    Â Â Â Â Â Â Â Â point=lookup(code[i],morseDict,length);
    Â Â Â Â Â Â Â Â forÂ (intÂ j=0;j<strlen(point);j++){
    Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (point[j]=='0')
    Â Â Â Â Â Â Â Â Â Â Â Â {
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â beep(pause/2);
    Â Â Â Â Â Â Â Â Â Â Â Â }elseÂ if(point[j]=='1')
    Â Â Â Â Â Â Â Â Â Â Â Â {
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â beep(pause);
    Â Â Â Â Â Â Â Â Â Â Â Â }
    Â Â Â Â Â Â Â Â Â Â Â Â delay(pause);
    Â Â Â Â Â Â Â Â }
    Â Â Â Â }
    }

La funzione ``morsecode()`` viene utilizzata per elaborare il codice Morse dei 
caratteri di input facendo in modo che il â€œ1â€ del codice mantenga l'emissione 
di suoni o luci e lo â€œ0â€ emetta suoni o luci brevemente, ad esempio inserendo 
â€œSOSâ€, e ci sarÃ  un segnale contenente tre brevi, tre lunghi e poi tre brevi 
segmenti â€œ Â· Â· Â· - - - Â· Â· Â· â€.

.. code-block:: c

    intÂ toupper(intÂ c)
    {
    Â Â Â Â ifÂ ((cÂ >=Â 'a')Â &&Â (cÂ <=Â 'z'))
    Â Â Â Â Â Â Â Â returnÂ cÂ +Â ('A'Â -Â 'a');
    Â Â Â Â returnÂ c;
    }
    charÂ *strupr(charÂ *str)
    {
    Â Â Â Â charÂ *orign=str;
    Â Â Â Â forÂ (;Â *str!='\0';Â str++)
    Â Â Â Â Â Â Â Â *strÂ =Â toupper(*str);
    returnÂ orign;
    }

Prima della codifica, Ã¨ necessario unificare le lettere in lettere maiuscole.

.. code-block:: c

    voidÂ main(){
    Â Â Â Â setup();
    Â Â Â Â charÂ *code;
    Â Â Â Â intÂ length=8;
    Â Â Â Â codeÂ =Â (char*)malloc(sizeof(char)*length);
    Â Â Â Â whileÂ (1){
    Â Â Â Â Â Â Â Â printf("PleaseÂ inputÂ theÂ messenger:");
    Â Â Â Â Â Â Â Â scanf("%s",code);
    Â Â Â Â Â Â Â Â code=strupr(code);
    Â Â Â Â Â Â Â Â printf("%s\n",code);
    Â Â Â Â Â Â Â Â morsecode(code);
    Â Â Â Â }
    }

Quando digiti i caratteri rilevanti con la tastiera, ``code=strupr(code)`` 
convertirÃ  le lettere inserite nella loro forma maiuscola.

``Printf()`` stampa quindi il testo in chiaro sullo schermo del computer e la 
funzione ``morsecod()`` fa sÃ¬ che il cicalino e il LED emettano il codice Morse.

Nota che la lunghezza del carattere di input non deve superare il **length** (puÃ² essere modificato).

Foto del fenomeno
-----------------------

.. image:: ../img/image270.jpeg
   :align: center
