.. note::

    隆Hola, bienvenido a la comunidad de entusiastas de SunFounder Raspberry Pi & Arduino & ESP32 en Facebook! Sum茅rgete m谩s en Raspberry Pi, Arduino y ESP32 con otros entusiastas.

    **驴Por qu茅 unirse?**

    - **Soporte experto**: Resuelve problemas postventa y desaf铆os t茅cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Avances exclusivos**: Obt茅n acceso anticipado a nuevos anuncios de productos y adelantos.
    - **Descuentos especiales**: Disfruta de descuentos exclusivos en nuestros productos m谩s recientes.
    - **Promociones festivas y sorteos**: Participa en sorteos y promociones de temporada.

     驴Listo para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 煤nete hoy mismo.

.. _3.1.7_c_mcp3008:

3.1.7 Monitor de Sobrecalentamiento (MCP3008)
==================================================

.. note::

   .. image:: ../img/mcp3008_and_adc0834.jpg
      :width: 25%
      :align: left
    

   Dependiendo de la versi贸n de tu kit, identifica si tienes **ADC0834** o **MCP3008** y procede con la secci贸n correspondiente.

Introducci贸n
------------

Puede que quieras hacer un dispositivo de monitoreo de sobrecalentamiento aplicable a diversas situaciones, por ejemplo, en una f谩brica si queremos que haya una alarma y el apagado autom谩tico de la m谩quina cuando haya un circuito sobrecalentado.  
En este proyecto utilizaremos un termistor, un joystick, un zumbador (buzzer), un LED y un LCD para hacer un dispositivo inteligente de monitoreo de temperatura con un umbral ajustable.

Componentes requeridos
----------------------

En este proyecto necesitamos los siguientes componentes.

.. image:: ../img/list2_Overheat_Monitor.png
    :align: center

Es definitivamente conveniente comprar un kit completo, aqu铆 est谩 el enlace: 

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nombre	
        - ARTCULOS EN ESTE KIT
        - ENLACE
    *   - Kit Raphael
        - 337
        - |link_Raphael_kit|

Tambi茅n puedes comprarlos por separado en los siguientes enlaces.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCCIN DEL COMPONENTE
        - ENLACE DE COMPRA

    *   - :ref:`cpn_gpio_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_led`
        - |link_led_buy|
    *   - :ref:`cpn_joystick`
        - \-
    *   - :ref:`cpn_mcp3008`
        - \-
    *   - :ref:`cpn_transistor`
        - |link_transistor_buy|
    *   - :ref:`cpn_i2c_lcd`
        - |link_i2clcd1602_buy|
    *   - :ref:`cpn_thermistor`
        - |link_thermistor_buy|
    *   - :ref:`cpn_buzzer`
        - \-

Diagrama esquem谩tico
--------------------

.. list-table::
   :header-rows: 1

   * - Nombre
     - T-Board
     - wiringPi
     - BCM
   * - SPICE0
     - Pin 24
     - 10
     - 8
   * - SPIMOSI
     - Pin 19
     - 12
     - 10
   * - SPIMISO
     - Pin 21
     - 13
     - 9
   * - SPISCLK
     - Pin 23
     - 14
     - 11
   * - GPIO22
     - Pin 15
     - 3
     - 22
   * - GPIO23
     - Pin 16
     - 4
     - 23
   * - GPIO24
     - Pin 18
     - 5
     - 24
   * - SDA1
     - Pin 3
     - 
     - 
   * - SCL1
     - Pin 5
     - 
     - 


.. image:: ../img/Schematic_three_one8.png
   :align: center

Procedimientos experimentales
--------------------------------

**Paso 1:** Construye el circuito.

.. image:: ../img/july24_3.1.8_overheat_monitor_mcp3008.png

**Paso 2:** Ve a la carpeta del c贸digo.

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/raphael-kit/c/3.1.7-2/

**Paso 3:** Compila el c贸digo.

.. raw:: html

   <run></run>

.. code-block:: 

    gcc 3.1.7_OverheatMonitor.c -lm -lwiringPi

**Paso 4:** Ejecuta el archivo compilado.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo ./a.out

Al ejecutar el c贸digo, la temperatura actual y el umbral de alta temperatura **40** se muestran en el **I2C LCD1602**.  
Si la temperatura actual es mayor que el umbral, el zumbador y el LED se activar谩n para advertirte.

El **Joystick** se utiliza para ajustar el umbral de alta temperatura. Moviendo el **Joystick** en la direcci贸n del eje X y eje Y se puede ajustar (aumentar o disminuir) el umbral actual. Presionando el **Joystick** nuevamente se restablece el umbral al valor inicial.

.. note::

    * Si hay un error ``wiringPi.h: No such file or directory``, consulta :ref:`install_wiringpi`.
    * Si aparece el error ``Unable to open I2C device: No such file or directory``, consulta :ref:`i2c_config` para habilitar I2C y verificar el cableado.
    * Si el c贸digo y el cableado est谩n correctos, pero el LCD a煤n no muestra contenido, ajusta el potenci贸metro en la parte posterior para aumentar el contraste.

Explicaci贸n del c贸digo
----------------------

.. code-block:: c

    int read_ADC(int channel) { ... }

Lee un valor anal贸gico de 10 bits del canal MCP3008 (CH0CH7) usando SPI y devuelve un valor entre 0 y 1023.

.. code-block:: c

    int get_joystick_value() { ... }

Lee los valores anal贸gicos del joystick desde CH1 y CH2.  
Devuelve un entero que indica la direcci贸n del movimiento basado en umbrales.

.. code-block:: c

    void upper_tem_setting() { ... }

Permite al usuario ajustar el umbral de temperatura superior utilizando el joystick.  
Evita cambios repetidos si la direcci贸n se mantiene.

.. code-block:: c

    double temperature() { ... }

Lee el valor anal贸gico desde CH0 conectado al termistor.  
Utiliza la ecuaci贸n de SteinhartHart para calcular la temperatura en grados Celsius.

.. code-block:: c

    void monitoring_temp() { ... }

Lee continuamente la temperatura actual y la muestra junto con el umbral.  
Si la temperatura excede el umbral, el zumbador y el LED se activan.

.. code-block:: c

    void setup_all() { ... }

Inicializa el LCD, SPI y los pines GPIO para el bot贸n del joystick, el zumbador y el LED.  
Tambi茅n configura la resistencia pull-up para el bot贸n del joystick.

.. code-block:: c

    int main(void) { ... }

El bucle principal alterna entre dos modos:

1. Monitoreo de temperatura.  
2. Ajuste del l铆mite superior usando el joystick.

El modo cambia cuando se suelta el bot贸n del joystick (disparo por flanco ascendente).

.. Imagen del fen贸meno
.. -------------------

.. .. image:: ../img/image259.jpeg
   :align: center
