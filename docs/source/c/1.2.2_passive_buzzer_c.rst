.. note::

    ã“ã‚“ã«ã¡ã¯ã€SunFounderã®Raspberry Pi & Arduino & ESP32æ„›å¥½å®¶ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã‚ˆã†ã“ãï¼Facebookä¸Šã§Raspberry Piã€Arduinoã€ESP32ã«ã¤ã„ã¦ã‚‚ã£ã¨æ·±ãæ˜ã‚Šä¸‹ã’ã€ä»–ã®æ„›å¥½å®¶ã¨äº¤æµã—ã¾ã—ã‚‡ã†ã€‚

    **å‚åŠ ã™ã‚‹ç†ç”±ã¯ï¼Ÿ**

    - **ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚µãƒãƒ¼ãƒˆ**ï¼šã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„ãƒãƒ¼ãƒ ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€è²©å£²å¾Œã®å•é¡Œã‚„æŠ€è¡“çš„ãªèª²é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚
    - **å­¦ã³ï¼†å…±æœ‰**ï¼šãƒ’ãƒ³ãƒˆã‚„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’äº¤æ›ã—ã¦ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚
    - **ç‹¬å çš„ãªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼šæ–°è£½å“ã®ç™ºè¡¨ã‚„å…ˆè¡Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚
    - **ç‰¹åˆ¥å‰²å¼•**ï¼šæœ€æ–°è£½å“ã®ç‹¬å å‰²å¼•ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
    - **ç¥­ã‚Šã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚®ãƒ•ãƒˆ**ï¼šã‚®ãƒ•ãƒˆã‚„ç¥æ—¥ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚

    ğŸ‘‰ ç§ãŸã¡ã¨ä¸€ç·’ã«æ¢ç´¢ã—ã€å‰µé€ ã™ã‚‹æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ[|link_sf_facebook|]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä»Šã™ãå‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

.. _1.2.2_c:

1.2.2 å—å‹•ãƒ–ã‚¶ãƒ¼
==========================

ã¯ã˜ã‚ã«
------------

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€å—å‹•ãƒ–ã‚¶ãƒ¼ã§éŸ³æ¥½ã‚’å†ç”Ÿã™ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã™ã€‚

å¿…è¦ãªéƒ¨å“
------------------------------

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä»¥ä¸‹ã®éƒ¨å“ãŒå¿…è¦ã§ã™ã€‚

.. image:: ../img/list_1.2.2.png

å…¨ä½“ã®ã‚­ãƒƒãƒˆã‚’è³¼å…¥ã™ã‚‹ã®ã¯éå¸¸ã«ä¾¿åˆ©ã§ã™ã€‚ä»¥ä¸‹ãŒãƒªãƒ³ã‚¯ã§ã™ï¼š

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - åå‰
        - ã“ã®ã‚­ãƒƒãƒˆã®ã‚¢ã‚¤ãƒ†ãƒ 
        - ãƒªãƒ³ã‚¯
    *   - Raphael Kit
        - 337
        - |link_Raphael_kit|

ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å€‹åˆ¥ã«è³¼å…¥ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç´¹ä»‹
        - è³¼å…¥ãƒªãƒ³ã‚¯

    *   - :ref:`cpn_gpio_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_buzzer`
        - |link_passive_buzzer_buy|
    *   - :ref:`cpn_transistor`
        - |link_transistor_buy|

å›è·¯å›³
-----------------

ã“ã®å®Ÿé¨“ã§ã¯ã€å—å‹•ãƒ–ã‚¶ãƒ¼ã€PNPãƒˆãƒ©ãƒ³ã‚¸ã‚¹ã‚¿ã€ãƒˆãƒ©ãƒ³ã‚¸ã‚¹ã‚¿ã®ãƒ™ãƒ¼ã‚¹ã¨GPIOé–“ã®1kã®æŠµæŠ—ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãƒˆãƒ©ãƒ³ã‚¸ã‚¹ã‚¿ã‚’ä¿è­·ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚

GPIO17ã«ç•°ãªã‚‹å‘¨æ³¢æ•°ãŒä¸ãˆã‚‰ã‚Œã‚‹ã¨ã€å—å‹•ãƒ–ã‚¶ãƒ¼ã¯ç•°ãªã‚‹éŸ³ã‚’å‡ºã—ã¾ã™ã€‚ã“ã®æ–¹æ³•ã§ã€ãƒ–ã‚¶ãƒ¼ã¯éŸ³æ¥½ã‚’å†ç”Ÿã—ã¾ã™ã€‚

.. image:: ../img/image333.png

å®Ÿé¨“æ‰‹é †
-----------------------

**ã‚¹ãƒ†ãƒƒãƒ—1**: å›è·¯ã‚’çµ„ã¿ç«‹ã¦ã¾ã™ã€‚ï¼ˆèƒŒé¢ãŒç·‘ã®åŸºæ¿ã®å—å‹•ãƒ–ã‚¶ãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ï¼‰

.. image:: ../img/image106.png

**ã‚¹ãƒ†ãƒƒãƒ—2**: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¤‰æ›´ã—ã¾ã™ã€‚

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/c/1.2.2/

**ã‚¹ãƒ†ãƒƒãƒ—3**: ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¾ã™ã€‚

.. raw:: html

   <run></run>

.. code-block::

    gcc 1.2.2_PassiveBuzzer.c -lwiringPi

**ã‚¹ãƒ†ãƒƒãƒ—4**: å®Ÿè¡Œã—ã¾ã™ã€‚

.. raw:: html

   <run></run>

.. code-block::

    sudo ./a.out

ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€ãƒ–ã‚¶ãƒ¼ã¯éŸ³æ¥½ã®ä¸€éƒ¨ã‚’å†ç”Ÿã—ã¾ã™ã€‚

.. note::

    å®Ÿè¡Œå¾Œã«å‹•ä½œã—ãªã„ã‹ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ŒwiringPi.h: No such file or directoryã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆã€ :ref:`install_wiringpi` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**ã‚³ãƒ¼ãƒ‰**

.. code-block:: c

    #include <wiringPi.h>
    #include <softTone.h>
    #include <stdio.h>

    #define BuzPin    0

    #define  CL1  131
    #define  CL2  147
    #define  CL3  165
    #define  CL4  175
    #define  CL5  196
    #define  CL6  221
    #define  CL7  248

    #define  CM1  262
    #define  CM2  294
    #define  CM3  330
    #define  CM4  350
    #define  CM5  393
    #define  CM6  441
    #define  CM7  495

    #define  CH1  525
    #define  CH2  589
    #define  CH3  661
    #define  CH4  700
    #define  CH5  786
    #define  CH6  882
    #define  CH7  990

    int song_1[] = {CM3,CM5,CM6,CM3,CM2,CM3,CM5,CM6,CH1,CM6,CM5,CM1,CM3,CM2,
                    CM2,CM3,CM5,CM2,CM3,CM3,CL6,CL6,CL6,CM1,CM2,CM3,CM2,CL7,
                    CL6,CM1,CL5};

    int beat_1[] = {1,1,3,1,1,3,1,1,1,1,1,1,1,1,3,1,1,3,1,1,1,1,1,1,1,2,1,1,
                    1,1,1,1,1,1,3};


    int song_2[] = {CM1,CM1,CM1,CL5,CM3,CM3,CM3,CM1,CM1,CM3,CM5,CM5,CM4,CM3,CM2,
                    CM2,CM3,CM4,CM4,CM3,CM2,CM3,CM1,CM1,CM3,CM2,CL5,CL7,CM2,CM1
                    };

    int beat_2[] = {1,1,1,3,1,1,1,3,1,1,1,1,1,1,3,1,1,1,2,1,1,1,3,1,1,1,3,3,2,3};

    int main(void)
    {
        int i, j;
        if(wiringPiSetup() == -1){ //when initialize wiring failed,print message to screen
            printf("setup wiringPi failed !");
            return 1;
        }

        if(softToneCreate(BuzPin) == -1){
            printf("setup softTone failed !");
            return 1;
        }

        while(1){
            printf("music is being played...\n");

            for(i=0;i<sizeof(song_1)/4;i++){
                softToneWrite(BuzPin, song_1[i]);   
                delay(beat_1[i] * 500);
            }

            for(i=0;i<sizeof(song_2)/4;i++){
                softToneWrite(BuzPin, song_2[i]);   
                delay(beat_2[i] * 500);
            }   
        }

        return 0;
    }

**ã‚³ãƒ¼ãƒ‰èª¬æ˜**

.. code-block:: c

    #define  CL1  131
    #define  CL2  147
    #define  CL3  165
    #define  CL4  175
    #define  CL5  196
    #define  CL6  221
    #define  CL7  248

    #define  CM1  262
    #define  CM2  294


å„éŸ³ç¬¦ã®å‘¨æ³¢æ•°ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚CLã¯ä½éŸ³ã‚’ã€CMã¯ä¸­éŸ³ã‚’ã€CHã¯é«˜éŸ³ã‚’ç¤ºã—ã€1-7ã¯ãã‚Œãã‚Œã®éŸ³ç¬¦Cã€Dã€Eã€Fã€Gã€Aã€Bã«å¯¾å¿œã—ã¾ã™ã€‚

.. code-block:: c

    int song_1[] = {CM3,CM5,CM6,CM3,CM2,CM3,CM5,CM6,CH1,CM6,CM5,CM1,CM3,CM2,
                    CM2,CM3,CM5,CM2,CM3,CM3,CL6,CL6,CL6,CM1,CM2,CM3,CM2,CL7,
                    CL6,CM1,CL5};
    int beat_1[] = {1,1,3,1,1,3,1,1,1,1,1,1,1,1,3,1,1,3,1,1,1,1,1,1,1,2,1,1,
                    1,1,1,1,1,1,3};

``song_1[]`` é…åˆ—ã¯ã€æ›²ã®æ¥½è­œã‚’æ ¼ç´ã—ã€ ``beat_1[]`` ã¯æ›²ã®å„éŸ³ç¬¦ã®æ‹å­ã‚’ç¤ºã—ã¾ã™ï¼ˆå„æ‹å­ã¯0.5ç§’ã§ã™ï¼‰ã€‚

.. code-block:: c

    if(softToneCreate(BuzPin) == -1){
            printf("setup softTone failed !");
            return 1;
    }

ã“ã‚Œã¯ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§åˆ¶å¾¡ã•ã‚Œã‚‹éŸ³ã®ãƒ”ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚ä»»æ„ã®GPIOãƒ”ãƒ³ã‚’ä½¿ç”¨ã§ãã€ãƒ”ãƒ³ç•ªå·ã¯ä½¿ç”¨ã—ãŸ ``wiringPiSetup()`` é–¢æ•°ã®ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚æˆ»ã‚Šå€¤ãŒ0ãªã‚‰æˆåŠŸã§ã™ã€‚ãã‚Œä»¥å¤–ã®å ´åˆã€ä½•ãŒé–“é•ã£ã¦ã„ã‚‹ã‹ã‚’èª¿ã¹ã‚‹ãŸã‚ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªerrnovariableã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

.. code-block:: c

    for(i=0;i<sizeof(song_1)/4;i++){
        softToneWrite(BuzPin, song_1[i]);   
        delay(beat_1[i] * 500);
    }

foræ–‡ã‚’ä½¿ç”¨ã—ã¦song_1ã‚’å†ç”Ÿã—ã¾ã™ã€‚

åˆ¤å®šæ¡ä»¶ã® **i<sizeof(song_1)/4** ã§ã¯ã€ã€Œ4ã§å‰²ã‚‹ã€ã¯ ``song_1[]`` ãŒæ•´æ•°å‹ã®ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—ã®é…åˆ—ã§ã‚ã‚Šã€å„è¦ç´ ãŒ4ãƒã‚¤ãƒˆã‚’å æœ‰ã—ã¦ã„ã‚‹ãŸã‚ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

``song_1`` ã®è¦ç´ æ•°ï¼ˆéŸ³æ¥½ãƒãƒ¼ãƒˆã®æ•°ï¼‰ã¯ã€ ``sizeof(song_1)`` ã‚’4ã§å‰²ã‚‹ã“ã¨ã§å¾—ã‚‰ã‚Œã¾ã™ã€‚

å„éŸ³ç¬¦ã‚’æ‹å­ * 500msã§å†ç”Ÿã™ã‚‹ãŸã‚ã«ã€é–¢æ•° ``delay(beat_1[i] * 500)`` ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚

``softToneWrite(BuzPin, song_1[i])`` ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã¯ï¼š

.. code-block:: c

    void softToneWrite (int pin, int freq);

ã“ã‚Œã¯æŒ‡å®šã•ã‚ŒãŸãƒ”ãƒ³ã®éŸ³ã®å‘¨æ³¢æ•°å€¤ã‚’æ›´æ–°ã—ã¾ã™ã€‚å‘¨æ³¢æ•°ã‚’0ã«è¨­å®šã™ã‚‹ã¾ã§éŸ³ã¯å†ç”Ÿã‚’åœæ­¢ã—ã¾ã›ã‚“ã€‚

ç¾è±¡ã®ç”»åƒ
------------------

.. image:: ../img/image107.jpeg