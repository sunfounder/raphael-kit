 
.. note::

    Bonjour et bienvenue dans la Communaut√© Facebook des passionn√©s de Raspberry Pi, Arduino et ESP32 de SunFounder ! Plongez plus profond√©ment dans l'univers des Raspberry Pi, Arduino et ESP32 avec d'autres passionn√©s.

    **Pourquoi rejoindre ?**

    - **Support d'experts** : R√©solvez les probl√®mes apr√®s-vente et les d√©fis techniques avec l'aide de notre communaut√© et de notre √©quipe.
    - **Apprendre et partager** : √âchangez des astuces et des tutoriels pour am√©liorer vos comp√©tences.
    - **Aper√ßus exclusifs** : Acc√©dez en avant-premi√®re aux annonces de nouveaux produits et aux aper√ßus.
    - **R√©ductions sp√©ciales** : Profitez de r√©ductions exclusives sur nos produits les plus r√©cents.
    - **Promotions festives et cadeaux** : Participez √† des cadeaux et des promotions de vacances.

    üëâ Pr√™t √† explorer et √† cr√©er avec nous ? Cliquez [|link_sf_facebook|] et rejoignez-nous aujourd'hui !

.. _1.2.2_c:

1.2.2 Buzzer Passif
==========================

Introduction
---------------

Dans ce projet, nous allons apprendre √† faire jouer de la musique √† un buzzer passif.

Composants n√©cessaires
------------------------------

Dans ce projet, nous avons besoin des composants suivants. 

.. image:: ../img/list_1.2.2.png

Il est certainement pratique d'acheter un kit complet, voici le lien :

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Name	
        - ITEMS IN THIS KIT
        - LINK
    *   - Raphael Kit
        - 337
        - |link_Raphael_kit|

Vous pouvez √©galement les acheter s√©par√©ment via les liens ci-dessous.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCTION DES COMPOSANTS
        - LIEN D'ACHAT

    *   - :ref:`cpn_gpio_extension_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_buzzer`
        - |link_passive_buzzer_buy|
    *   - :ref:`cpn_transistor`
        - |link_transistor_buy|

Sch√©ma de c√¢blage
--------------------

Dans cette exp√©rience, un buzzer passif, un transistor PNP et une r√©sistance de 1k sont utilis√©s entre la base du transistor et le GPIO pour prot√©ger le transistor.

Lorsque le GPIO17 re√ßoit diff√©rentes fr√©quences, le buzzer passif √©mettra diff√©rents sons ; de cette mani√®re, le buzzer joue de la musique.

.. image:: ../img/image333.png


Proc√©dures exp√©rimentales
-----------------------------

**√âtape 1** : Construisez le circuit. (Le buzzer passif avec une carte de circuit verte √† l'arri√®re.)

.. image:: ../img/image106.png

**√âtape 2** : Changez de r√©pertoire.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/c/1.2.2/

**√âtape 3** : Compilez.

.. raw:: html

   <run></run>

.. code-block::

    gcc 1.2.2_PassiveBuzzer.c -lwiringPi

**√âtape 4** : Ex√©cutez.

.. raw:: html

   <run></run>

.. code-block::

    sudo ./a.out

Le code s'ex√©cute, le buzzer joue un morceau de musique.

.. note::

    Si cela ne fonctionne pas apr√®s l'ex√©cution, ou si un message d'erreur appara√Æt : "wiringPi.h: No such file or directory", veuillez vous r√©f√©rer √† :ref:`install_wiringpi`.

**Code**

.. code-block:: c

    #include <wiringPi.h>
    #include <softTone.h>
    #include <stdio.h>

    #define BuzPin    0

    #define  CL1  131
    #define  CL2  147
    #define  CL3  165
    #define  CL4  175
    #define  CL5  196
    #define  CL6  221
    #define  CL7  248

    #define  CM1  262
    #define  CM2  294
    #define  CM3  330
    #define  CM4  350
    #define  CM5  393
    #define  CM6  441
    #define  CM7  495

    #define  CH1  525
    #define  CH2  589
    #define  CH3  661
    #define  CH4  700
    #define  CH5  786
    #define  CH6  882
    #define  CH7  990

    int song_1[] = {CM3,CM5,CM6,CM3,CM2,CM3,CM5,CM6,CH1,CM6,CM5,CM1,CM3,CM2,
                    CM2,CM3,CM5,CM2,CM3,CM3,CL6,CL6,CL6,CM1,CM2,CM3,CM2,CL7,
                    CL6,CM1,CL5};

    int beat_1[] = {1,1,3,1,1,3,1,1,1,1,1,1,1,1,3,1,1,3,1,1,1,1,1,1,1,2,1,1,
                    1,1,1,1,1,1,3};


    int song_2[] = {CM1,CM1,CM1,CL5,CM3,CM3,CM3,CM1,CM1,CM3,CM5,CM5,CM4,CM3,CM2,
                    CM2,CM3,CM4,CM4,CM3,CM2,CM3,CM1,CM1,CM3,CM2,CL5,CL7,CM2,CM1
                    };

    int beat_2[] = {1,1,1,3,1,1,1,3,1,1,1,1,1,1,3,1,1,1,2,1,1,1,3,1,1,1,3,3,2,3};

    int main(void)
    {
        int i, j;
        if(wiringPiSetup() == -1){ //when initialize wiring failed,print message to screen
            printf("setup wiringPi failed !");
            return 1;
        }

        if(softToneCreate(BuzPin) == -1){
            printf("setup softTone failed !");
            return 1;
        }

        while(1){
            printf("music is being played...\n");

            for(i=0;i<sizeof(song_1)/4;i++){
                softToneWrite(BuzPin, song_1[i]);   
                delay(beat_1[i] * 500);
            }

            for(i=0;i<sizeof(song_2)/4;i++){
                softToneWrite(BuzPin, song_2[i]);   
                delay(beat_2[i] * 500);
            }   
        }

        return 0;
    }

**Explication du code**

.. code-block:: c

    #define  CL1  131
    #define  CL2  147
    #define  CL3  165
    #define  CL4  175
    #define  CL5  196
    #define  CL6  221
    #define  CL7  248

    #define  CM1  262
    #define  CM2  294



Ces fr√©quences de chaque note sont indiqu√©es ci-dessous. CL d√©signe une note basse, 
CM une note moyenne, CH une note haute, 1-7 correspondent aux notes C, D, E, F, G, A, B.

.. code-block:: c

    int song_1[] = {CM3,CM5,CM6,CM3,CM2,CM3,CM5,CM6,CH1,CM6,CM5,CM1,CM3,CM2,
                    CM2,CM3,CM5,CM2,CM3,CM3,CL6,CL6,CL6,CM1,CM2,CM3,CM2,CL7,
                    CL6,CM1,CL5};
    int beat_1[] = {1,1,3,1,1,3,1,1,1,1,1,1,1,1,3,1,1,3,1,1,1,1,1,1,1,2,1,1,
                    1,1,1,1,1,1,3};

Le tableau, ``song_1[]`` contient une partition musicale d'une chanson dans laquelle ``beat_1[]`` se r√©f√®re au rythme de chaque note de la chanson (0,5s par battement).

.. code-block:: c

    if(softToneCreate(BuzPin) == -1){
            printf("setup softTone failed !");
            return 1;
    }

Cela cr√©e une broche de tonalit√© contr√¥l√©e par logiciel. Vous pouvez utiliser n'importe 
quelle broche GPIO et la num√©rotation des broches sera celle de la fonction ``wiringPiSetup()`` 
que vous avez utilis√©e. La valeur de retour est 0 pour le succ√®s. Tout autre valeur indique 
une erreur et vous devez v√©rifier la variable globale errno pour voir ce qui a mal tourn√©.

.. code-block:: c

    for(i=0;i<sizeof(song_1)/4;i++){
        softToneWrite(BuzPin, song_1[i]);   
        delay(beat_1[i] * 500);
    }

Utilisez une boucle for pour jouer la chanson song_1.

Dans la condition de jugement, **i<sizeof(song_1)/4**, la division par 4 est 
utilis√©e car le tableau ``song_1[]`` est un tableau de type de donn√©es entier, 
et chaque √©l√©ment occupe quatre octets.

Le nombre d'√©l√©ments dans ``song_1`` (le nombre de notes musicales) est obtenu 
en divisant ``sizeof(song_1)`` par 4.

Pour que chaque note joue pendant beat \* 500ms, la fonction 
``delay(beat_1[i] \* 500)`` est appel√©e.

Le prototype de ``softToneWrite(BuzPin, song_1[i])`` est :

.. code-block:: c

    void softToneWrite (int pin, int freq);

Cela met √† jour la valeur de fr√©quence de la tonalit√© sur la broche donn√©e. La tonalit√© ne s'arr√™te pas de jouer tant que vous ne r√©glez pas la fr√©quence √† 0.

Image du ph√©nom√®ne
------------------

.. image:: ../img/image107.jpeg
