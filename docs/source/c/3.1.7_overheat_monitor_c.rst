.. nota::

    춰Hola! Bienvenido a la comunidad de entusiastas de SunFounder Raspberry Pi & Arduino & ESP32 en Facebook. Sum칠rgete m치s en Raspberry Pi, Arduino y ESP32 con otros entusiastas.

    **쯇or qu칠 unirse?**

    - **Soporte de expertos**: Resuelve problemas postventa y desaf칤os t칠cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Vistas previas exclusivas**: Obt칠n acceso anticipado a anuncios de nuevos productos y adelantos.
    - **Descuentos especiales**: Disfruta de descuentos exclusivos en nuestros productos m치s nuevos.
    - **Promociones festivas y sorteos**: Participa en sorteos y promociones de temporada.

    游녤 쯃isto para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 칰nete hoy mismo.

.. _3.1.7_c:

3.1.7 Monitor de Sobrecalentamiento
==================================

Introducci칩n
-------------------

Tal vez desees crear un dispositivo de monitoreo de sobrecalentamiento aplicable a diversas 
situaciones, por ejemplo, en una f치brica, si queremos tener una alarma y el apagado autom치tico 
de la m치quina cuando hay un sobrecalentamiento en el circuito. En este proyecto, utilizaremos 
un termistor, un joystick, un zumbador, un LED y una pantalla LCD para crear un dispositivo 
inteligente de monitoreo de temperatura cuyo umbral es ajustable.

Componentes Necesarios
------------------------------

En este proyecto, necesitamos los siguientes componentes.

.. image:: ../img/list_Overheat_Monitor.png
    :align: center

Es definitivamente conveniente comprar un kit completo, aqu칤 est치 el enlace:

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nombre
        - ELEMENTOS EN ESTE KIT
        - ENLACE
    *   - Kit Raphael
        - 337
        - |link_Raphael_kit|

Tambi칠n puedes comprarlos por separado en los enlaces a continuaci칩n.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCCI칍N DE COMPONENTES
        - ENLACE DE COMPRA

    *   - :ref:`cpn_gpio_extension_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_led`
        - |link_led_buy|
    *   - :ref:`cpn_joystick`
        - \-
    *   - :ref:`cpn_adc0834`
        - \-
    *   - :ref:`cpn_transistor`
        - |link_transistor_buy|
    *   - :ref:`cpn_i2c_lcd`
        - |link_i2clcd1602_buy|
    *   - :ref:`cpn_thermistor`
        - |link_thermistor_buy|
    *   - :ref:`cpn_buzzer`
        - \-

Diagrama Esquem치tico
--------------------------

============== ========== ======== ===
Nombre T-Board Pin f칤sico wiringPi BCM
GPIO17         Pin 11     0        17
GPIO18         Pin 12     1        18
GPIO27         Pin 13     2        27
GPIO22         Pin15      3        22
GPIO23         Pin16      4        23
GPIO24         Pin18      5        24
SDA1           Pin 3             
SCL1           Pin 5             
============== ========== ======== ===

.. image:: ../img/Schematic_three_one8.png
   :align: center

Procedimientos Experimentales
----------------------------------

**Paso 1:** Construye el circuito.

.. image:: ../img/image258.png

**Paso 2**: Ve a la carpeta del c칩digo.

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/raphael-kit/c/3.1.7/

**Paso 3**: Compila el c칩digo.

.. raw:: html

   <run></run>

.. code-block:: 

    gcc 3.1.7_OverheatMonitor.c -lm -lwiringPi

**Paso 4**: Ejecuta el archivo compilado.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo ./a.out

Cuando el c칩digo se ejecuta, la temperatura actual y el umbral de alta temperatura 
de **40** se muestran en el **I2C LCD1602**. Si la temperatura actual es mayor que 
el umbral, el zumbador y el LED se activar치n para alertarte.

El **joystick** aqu칤 se utiliza para ajustar el umbral de alta temperatura. Mover 
el **joystick** en la direcci칩n de los ejes X e Y puede ajustar (subir o bajar) el 
umbral de alta temperatura. Presiona el **joystick** nuevamente para restablecer el 
umbral al valor inicial.

.. nota::

    * Si aparece el mensaje de error ``wiringPi.h: No such file or directory``, por favor consulta :ref:`install_wiringpi`.
    * Si obtienes el error ``Unable to open I2C device: No such file or directory``, necesitas consultar :ref:`i2c_config` para habilitar I2C y verificar si el cableado es correcto.
    * Si el c칩digo y el cableado est치n bien, pero el LCD a칰n no muestra contenido, puedes girar el potenci칩metro en la parte posterior para aumentar el contraste.

**Explicaci칩n del C칩digo**

.. code-block:: c

    int많et_joystick_value(){
    먝먝먝맛char맞_val;
    먝먝먝맛char맟_val;
    먝먝먝맞_val=많et_ADC_Result(1);
    먝먝먝맟_val=많et_ADC_Result(2);
    먝먝먝말f(x_val>200){
    먝먝먝먝먝먝먝return1;
    먝먝먝맣
    먝먝먝만lse말f(x_val<50){
    먝먝먝먝먝먝먝return-1;
    먝먝먝맣
    먝먝먝만lse말f(y_val>200){
    먝먝먝먝먝먝먝return-10;
    먝먝먝맣
    먝먝먝만lse말f(y_val<50){
    먝먝먝먝먝먝먝return10;
    먝먝먝맣
    먝먝먝만lse{
    먝먝먝먝먝먝먝return0;
    먝먝먝맣
    }

Esta funci칩n lee los valores de X e Y. Si ``X>200``, devolver치 
``1``; si ``X<50``, devolver치 ``-1``; si ``y>200``, devolver치 
``-10``; y si ``y<50``, devolver치 ``10``.

.. code-block:: c

    void맛pper_tem_setting(){
    먝먝먝망rite(0,0,"Upperㅁdjust:");
    먝먝먝말nt맊hange=많et_joystick_value();
    먝먝먝맛pperTem=맛pperTem+맊hange;
    먝먝먝맊har맙tr[6];
    먝먝먝맙nprintf(str,3,"%d",upperTem);
    먝먝먝망rite(0,1,str);
    먝먝먝말nt맓en;
    먝먝먝맓en=맙trlen(str);
    먝먝먝망rite(len,1,"먝먝먝먝먝먝먝먝먝먝먝먝");
    먝먝먝맋elay(100);
    }

Esta funci칩n se utiliza para ajustar el umbral y mostrarlo en el I2C LCD1602.

.. code-block:: c

    double맚emperature(){
    먝먝먝맛nsigned맊har맚emp_value;
    먝먝먝맋oubleVr,Rt,맚emp,맊el,Fah;
    먝먝먝맚emp_value=많et_ADC_Result(0);
    먝먝먝Vr=5*(double)(temp_value)/255;
    먝먝먝Rt=10000*(double)(Vr)/(5-(double)(Vr));
    먝먝먝맚emp=1/(((log(Rt/10000))/3950)+(1/(273.15+25)));
    먝먝먝맊el=맚emp-273.15;
    먝먝먝Fah=맊el*1.8+32;
    먝먝먝return맊el;
    }

Lee el valor anal칩gico del **CH0** (termistor) de **ADC0834** y luego lo 
convierte en valor de temperatura.

.. code-block:: c

    void맔onitoring_temp(){
    먝먝먝맊har맙tr[6];
    먝먝먝맋ouble맊el=맚emperature();
    먝먝먝맙nprintf(str,6,"%.2f",cel);
    먝먝먝망rite(0,0,"Temp:");
    먝먝먝망rite(6,0,맙tr);
    먝먝먝맙nprintf(str,3,"%d",upperTem);
    먝먝먝망rite(0,1,"Upper:");
    먝먝먝망rite(7,1,맙tr);
    먝먝먝맋elay(100);
    먝먝먝말f(cel>=맛pperTem){
    먝먝먝먝먝먝먝맋igitalWrite(buzzPin,HIGH);
    먝먝먝먝먝먝먝맋igitalWrite(LedPin,HIGH);
    먝먝먝맣
    먝먝먝만lse말f(cel<맛pperTem){
    먝먝먝먝먝먝먝맋igitalWrite(buzzPin,LOW);
    먝먝먝먝먝먝먝맋igitalWrite(LedPin,LOW);
    먝먝먝맣
    }

Cuando el c칩digo se ejecuta, la temperatura actual y el umbral de alta 
temperatura **40** se muestran en **I2C LCD1602**. Si la temperatura 
actual es mayor que el umbral, el zumbador y el LED se activar치n para alertarte.

.. code-block:: c

    int맔ain(void)
    {
    먝먝먝맙etup();
    먝먝먝말nt맓astState=1;
    먝먝먝말nt맙tage=0;
    먝먝먝망hile(1)
    먝먝먝맡
    먝먝먝먝먝먝먝말nt맊urrentState=맋igitalRead(Joy_BtnPin);
    먝먝먝먝먝먝먝말f(currentState==1&&맓astState==0){
    먝먝먝먝먝먝먝먝먝먝먝맙tage=(stage+1)%2;
    먝먝먝먝먝먝먝먝먝먝먝맋elay(100);
    먝먝먝먝먝먝먝먝먝먝먝맓cd_clear();
    먝먝먝먝먝먝먝맣
    먝먝먝먝먝먝먝맓astState=currentState;
    먝먝먝먝먝먝먝말f(stage==1){
    먝먝먝먝먝먝먝먝먝먝먝맛pper_tem_setting();
    먝먝먝먝먝먝먝맣
    먝먝먝먝먝먝먝만lse{
    먝먝먝먝먝먝먝먝먝먝먝맔onitoring_temp();
    먝먝먝먝먝먝먝맣
    먝먝먝맣
    먝먝먝return0;
    }

La funci칩n ``main()`` contiene todo el proceso del programa como se muestra:

1) Cuando el programa comienza, el valor inicial de **stage** es **0**, y la 
temperatura actual y el umbral de alta temperatura **40** se muestran en **I2C LCD1602**. 
Si la temperatura actual es mayor que el umbral, el zumbador y el LED se activar치n para alertarte.

2) Presiona el joystick y **stage** ser치 **1** y podr치s ajustar el umbral de alta temperatura. 
Mover el joystick en la direcci칩n de los ejes X e Y puede ajustar (subir o bajar) el umbral 
actual. Presiona el joystick una vez m치s para restablecer el umbral al valor inicial.



Imagen del Fen칩meno
-------------------------

.. image:: ../img/image259.jpeg
   :align: center