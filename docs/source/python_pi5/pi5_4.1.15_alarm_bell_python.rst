.. note::

    ã“ã‚“ã«ã¡ã¯ã€SunFounderã®Raspberry Pi & Arduino & ESP32æ„›å¥½å®¶ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã‚ˆã†ã“ãï¼Facebookä¸Šã§Raspberry Piã€Arduinoã€ESP32ã«ã¤ã„ã¦ã‚‚ã£ã¨æ·±ãæ˜ã‚Šä¸‹ã’ã€ä»–ã®æ„›å¥½å®¶ã¨äº¤æµã—ã¾ã—ã‚‡ã†ã€‚

    **å‚åŠ ã™ã‚‹ç†ç”±ã¯ï¼Ÿ**

    - **ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚µãƒãƒ¼ãƒˆ**ï¼šã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„ãƒãƒ¼ãƒ ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€è²©å£²å¾Œã®å•é¡Œã‚„æŠ€è¡“çš„ãªèª²é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚
    - **å­¦ã³ï¼†å…±æœ‰**ï¼šãƒ’ãƒ³ãƒˆã‚„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’äº¤æ›ã—ã¦ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚
    - **ç‹¬å çš„ãªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼šæ–°è£½å“ã®ç™ºè¡¨ã‚„å…ˆè¡Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚
    - **ç‰¹åˆ¥å‰²å¼•**ï¼šæœ€æ–°è£½å“ã®ç‹¬å å‰²å¼•ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
    - **ç¥­ã‚Šã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚®ãƒ•ãƒˆ**ï¼šã‚®ãƒ•ãƒˆã‚„ç¥æ—¥ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚

    ğŸ‘‰ ç§ãŸã¡ã¨ä¸€ç·’ã«æ¢ç´¢ã—ã€å‰µé€ ã™ã‚‹æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ[|link_sf_facebook|]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä»Šã™ãå‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

.. _4.1.15_py_pi5:

4.1.10 ã‚¢ãƒ©ãƒ¼ãƒ ãƒ™ãƒ«
=======================


æ¦‚è¦
-----------------

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€æ‰‹å‹•ã‚¢ãƒ©ãƒ¼ãƒ ãƒ‡ãƒã‚¤ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒã‚’ã‚µãƒ¼ãƒŸã‚¹ã‚¿ã¾ãŸã¯å…‰æ„ŸçŸ¥ã‚»ãƒ³ã‚µãƒ¼ã«ç½®ãæ›ãˆã¦ã€æ¸©åº¦ã‚¢ãƒ©ãƒ¼ãƒ ã¾ãŸã¯å…‰ã‚¢ãƒ©ãƒ¼ãƒ ã‚’ä½œæˆã§ãã¾ã™ã€‚

å¿…è¦ãªéƒ¨å“
------------------------------

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ã€æ¬¡ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå¿…è¦ã§ã™ã€‚

.. image:: ../python_pi5/img/4.1.15_alarm_bell_list.png
    :width: 800
    :align: center

ä¸€å¼ã‚’è³¼å…¥ã™ã‚‹ã®ãŒä¾¿åˆ©ã§ã™ã€ã“ã¡ã‚‰ãŒãƒªãƒ³ã‚¯ã§ã™ï¼š 

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - åå‰	
        - ã“ã®ã‚­ãƒƒãƒˆã®ã‚¢ã‚¤ãƒ†ãƒ 
        - ãƒªãƒ³ã‚¯
    *   - Raphael Kit
        - 337
        - |link_Raphael_kit|

ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰åˆ¥ã€…ã«è³¼å…¥ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç´¹ä»‹
        - è³¼å…¥ãƒªãƒ³ã‚¯

    *   - :ref:`cpn_gpio_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_led`
        - |link_led_buy|
    *   - :ref:`cpn_buzzer`
        - |link_passive_buzzer_buy|
    *   - :ref:`cpn_slide_switch`
        - |link_slide_switch_buy|
    *   - :ref:`cpn_transistor`
        - |link_transistor_buy|
    *   - :ref:`cpn_capacitor`
        - |link_capacitor_buy|

å›è·¯å›³
-------------------------


============ ======== ======== ===
T-Board Name physical wiringPi BCM
GPIO17       Pin 11   0        17
GPIO18       Pin 12   1        18
GPIO27       Pin 13   2        27
GPIO22       Pin 15   3        22
============ ======== ======== ===

.. image:: ../python_pi5/img/4.1.15_alarm_bell_schematic.png
    :width: 600
    :align: center

å®Ÿé¨“æ‰‹é †
-----------------------------

**ã‚¹ãƒ†ãƒƒãƒ— 1**: å›è·¯ã‚’çµ„ã¿ç«‹ã¦ã¾ã™ã€‚

.. image:: ../python_pi5/img/4.1.15_alarm_bell_circuit.png

**ã‚¹ãƒ†ãƒƒãƒ— 2**: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¤‰æ›´ã—ã¾ã™ã€‚

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/python-pi5

**ã‚¹ãƒ†ãƒƒãƒ— 3**: å®Ÿè¡Œã—ã¾ã™ã€‚

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 3.1.10_AlarmBell_zero.py

ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’èµ·å‹•ã—ãŸå¾Œã€ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒã‚’å³ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨ã€ãƒ–ã‚¶ãƒ¼ã‹ã‚‰ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ãŒé³´ã‚Šã¾ã™ã€‚åŒæ™‚ã«ã€èµ¤ã¨ç·‘ã®LEDãŒä¸€å®šã®é »åº¦ã§ç‚¹æ»…ã—ã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰
----------------

.. note::
    ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ **ä¿®æ­£/ãƒªã‚»ãƒƒãƒˆ/ã‚³ãƒ”ãƒ¼/å®Ÿè¡Œ/åœæ­¢** ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã ã—ã€ãã®å‰ã« ``raphael-kit/python-pi5`` ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¹ã«ç§»å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

.. raw:: html

    <run></run>

.. code-block:: python

    #!/usr/bin/env python3

    from gpiozero import LED, Button, TonalBuzzer
    import time
    import threading

    # Initialize TonalBuzzer on GPIO pin 22
    BeepPin = TonalBuzzer(22)

    # Initialize LEDs on GPIO pins 17 and 27
    ALedPin = LED(17)
    BLedPin = LED(27)

    # Initialize Button on GPIO pin 18
    switchPin = Button(18)

    # Global flag to control the buzzer and LED states
    flag = 0

    def ledWork():
        """
        Control LED blinking pattern based on the flag state.
        When flag is set, alternately blink ALedPin and BLedPin.
        """
        while True:
            if flag:
                # Alternate blinking of LEDs
                ALedPin.on()
                time.sleep(0.5)
                ALedPin.off()
                BLedPin.on()
                time.sleep(0.5)
                BLedPin.off()
            else:
                # Turn off both LEDs if flag is not set
                ALedPin.off()
                BLedPin.off()

    # Define the musical tune as a list of notes and their durations
    tune = [
        ('C4', 0.1), ('E4', 0.1), ('G4', 0.1), 
        (None, 0.1), 
        ('E4', 0.1), ('G4', 0.1), ('C5', 0.1), 
        (None, 0.1), 
        ('C5', 0.1), ('G4', 0.1), ('E4', 0.1), 
        (None, 0.1), 
        ('G4', 0.1), ('E4', 0.1), ('C4', 0.1), 
        (None, 0.1)
    ]

    def buzzerWork():
        """
        Play a tune using the buzzer based on the flag state.
        The tune is played only when the flag is set.
        """
        while True:
            for note, duration in tune:
                if flag == 0:
                    break
                print(note)  # Output the current note to the console
                BeepPin.play(note)  # Play the current note
                time.sleep(duration)  # Pause for the duration of the note
            BeepPin.stop()  # Stop the buzzer after playing the tune

    def main():
        """
        Monitor button press to update the flag state.
        Sets the flag when the button is pressed.
        """
        global flag
        while True:
            flag = 1 if switchPin.is_pressed else 0

    try:
        # Initialize and start threads for buzzer and LED control
        tBuzz = threading.Thread(target=buzzerWork)
        tBuzz.start()
        tLed = threading.Thread(target=ledWork)
        tLed.start()
        main()

    except KeyboardInterrupt:
        # Stop the buzzer and turn off LEDs on program interruption
        BeepPin.stop()
        ALedPin.off()    
        BLedPin.off()


**ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜**

1. ã“ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã§ã¯ã€é…å»¶ã¨ã‚¹ãƒ¬ãƒƒãƒ‰å‡¦ç†ã®å®Ÿè£…ã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’è¡Œã„ã¾ã™ã€‚ã¾ãŸã€Raspberry Piä¸Šã®GPIOãƒ‡ãƒã‚¤ã‚¹ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã«ã€gpiozeroãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰LEDã€Buttonã€ãŠã‚ˆã³TonalBuzzerã‚¯ãƒ©ã‚¹ã‚‚ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

   .. code-block:: python

       #!/usr/bin/env python3

       from gpiozero import LED, Button, TonalBuzzer
       import time
       import threading

2. GPIOãƒ”ãƒ³22ã«ãƒ–ã‚¶ãƒ¼ã€GPIOãƒ”ãƒ³17ã¨27ã«LEDã€GPIOãƒ”ãƒ³18ã«ãƒœã‚¿ãƒ³ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚ãƒ–ã‚¶ãƒ¼ã¨LEDã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã«ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ•ãƒ©ã‚°ã‚‚å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

   .. code-block:: python

       # Initialize TonalBuzzer on GPIO pin 22
       BeepPin = TonalBuzzer(22)

       # Initialize LEDs on GPIO pins 17 and 27
       ALedPin = LED(17)
       BLedPin = LED(27)

       # Initialize Button on GPIO pin 18
       switchPin = Button(18)

       # Global flag to control the buzzer and LED states
       flag = 0


3. ã“ã®é–¢æ•°ã¯ã€ãƒ•ãƒ©ã‚°ã®çŠ¶æ…‹ã«å¿œã˜ã¦LEDã®ç‚¹æ»…ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚ãƒ•ãƒ©ã‚°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ˆ1ï¼‰å ´åˆã€å„LEDã‚’ã‚ªãƒ³ã¨ã‚ªãƒ•ã«äº¤äº’ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚ãƒ•ãƒ©ã‚°ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ï¼ˆ0ï¼‰å ´åˆã€ä¸¡æ–¹ã®LEDã‚’ã‚ªãƒ•ã«ã—ã¾ã™ã€‚

   .. code-block:: python

       def ledWork():
           """
           Control LED blinking pattern based on the flag state.
           When flag is set, alternately blink ALedPin and BLedPin.
           """
           while True:
               if flag:
                   # Alternate blinking of LEDs
                   ALedPin.on()
                   time.sleep(0.5)
                   ALedPin.off()
                   BLedPin.on()
                   time.sleep(0.5)
                   BLedPin.off()
               else:
                   # Turn off both LEDs if flag is not set
                   ALedPin.off()
                   BLedPin.off()

4. éŸ³æ¥½ã®éŸ³ç¬¦ï¼ˆå‘¨æ³¢æ•°ï¼‰ã¨æŒç¶šæ™‚é–“ï¼ˆç§’ï¼‰ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã§ã‚ã‚‹ã€Œtuneã€ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

   .. code-block:: python

       # Define the musical tune as a list of notes and their durations
       tune = [
           ('C4', 0.1), ('E4', 0.1), ('G4', 0.1), 
           (None, 0.1), 
           ('E4', 0.1), ('G4', 0.1), ('C5', 0.1), 
           (None, 0.1), 
           ('C5', 0.1), ('G4', 0.1), ('E4', 0.1), 
           (None, 0.1), 
           ('G4', 0.1), ('E4', 0.1), ('C4', 0.1), 
           (None, 0.1)
       ]

5. ãƒ•ãƒ©ã‚°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã«äºˆã‚å®šç¾©ã•ã‚ŒãŸãƒ¡ãƒ­ãƒ‡ã‚£ã‚’æ¼”å¥ã—ã¾ã™ã€‚æ¼”å¥ä¸­ã«ãƒ•ãƒ©ã‚°ãŒè§£é™¤ã•ã‚Œã‚‹ã¨ã€æ¼”å¥ãŒåœæ­¢ã—ã¾ã™ã€‚

   .. code-block:: python

       def buzzerWork():
           """
           Play a tune using the buzzer based on the flag state.
           The tune is played only when the flag is set.
           """
           while True:
               for note, duration in tune:
                   if flag == 0:
                       break
                   print(note)  # Output the current note to the console
                   BeepPin.play(note)  # Play the current note
                   time.sleep(duration)  # Pause for the duration of the note
               BeepPin.stop()  # Stop the buzzer after playing the tune

6. ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã€ãƒ•ãƒ©ã‚°ã‚’è¨­å®šã¾ãŸã¯è§£é™¤ã—ã¾ã™ã€‚

   .. code-block:: python

       def main():
           """
           Monitor button press to update the flag state.
           Sets the flag when the button is pressed.
           """
           global flag
           while True:
               flag = 1 if switchPin.is_pressed else 0

7. ``buzzerWork`` ã¨ ``ledWork`` ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’é–‹å§‹ã—ã€ãã‚Œã‚‰ã‚’ãƒ¡ã‚¤ãƒ³é–¢æ•°ã¨åŒæ™‚ã«å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

   .. code-block:: python

       try:
           # Initialize and start threads for buzzer and LED control
           tBuzz = threading.Thread(target=buzzerWork)
           tBuzz.start()
           tLed = threading.Thread(target=ledWork)
           tLed.start()
           main()


8. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒä¸­æ–­ã•ã‚ŒãŸã¨ãã«ã€ãã‚Œã„ã«çµ‚äº†ã™ã‚‹ã‚ˆã†ã«ã€ãƒ–ã‚¶ãƒ¼ã‚’åœæ­¢ã—ã€LEDã‚’ã‚ªãƒ•ã«ã—ã¾ã™ã€‚

   .. code-block:: python

       except KeyboardInterrupt:
           # Stop the buzzer and turn off LEDs on program interruption
           BeepPin.stop()
           ALedPin.off()    
           BLedPin.off()