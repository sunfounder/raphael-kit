 
.. _2.2.8_py_pi5:

2.2.7 Module de capteur ultrasonique
=======================================

Introduction
--------------

Le capteur ultrasonique utilise des ultrasons pour détecter avec précision des objets et mesurer des distances. Il émet des ondes ultrasonores et les convertit en signaux électroniques.

Composants nécessaires
-------------------------

Dans ce projet, nous avons besoin des composants suivants.

.. image:: ../python_pi5/img/2.2.8_ultrasonic_list.png

Il est certainement pratique d'acheter un kit complet, voici le lien :

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nom	
        - ARTICLES DANS CE KIT
        - LIEN
    *   - Kit Raphael
        - 337
        - |link_Raphael_kit|

Vous pouvez également les acheter séparément via les liens ci-dessous.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCTION DU COMPOSANT
        - LIEN D'ACHAT

    *   - :ref:`cpn_gpio_extension_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_ultrasonic_sensor`
        - |link_ultrasonic_buy|

Schéma
---------

.. image:: ../python_pi5/img/2.2.8_ultrasonic_schematic.png


Procédures expérimentales
-----------------------------

**Étape 1 :** Construisez le circuit.

.. image:: ../python_pi5/img/2.2.8_ultrasonic_circuit.png

**Étape 2 :** Allez dans le dossier du code.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/python-pi5

**Étape 3 :** Exécutez le fichier exécutable.

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 2.2.8_Ultrasonic_zero.py

Lorsque le code est exécuté, le module de capteur ultrasonique détecte la 
distance entre l'obstacle devant et le module lui-même, puis la valeur de 
la distance sera imprimée à l'écran.

**Code**

.. note::

    Vous pouvez **Modifier/Réinitialiser/Copier/Exécuter/Arrêter** le code ci-dessous. Mais avant cela, vous devez vous rendre au chemin du code source comme ``raphael-kit/python-pi5``. Après avoir modifié le code, vous pouvez l'exécuter directement pour voir l'effet.


.. raw:: html

    <run></run>

.. code-block:: python

   #!/usr/bin/env python3
   from gpiozero import DistanceSensor
   from time import sleep

   # Initialize the DistanceSensor using GPIO Zero library
   # Trigger pin is connected to GPIO 23, Echo pin to GPIO 24
   sensor = DistanceSensor(echo=24, trigger=23)

   try:
       # Main loop to continuously measure and report distance
       while True:
           dis = sensor.distance * 100  # Measure distance and convert from meters to centimeters
           print('Distance: {:.2f} cm'.format(dis))  # Print the distance with two decimal precision
           sleep(0.3)  # Wait for 0.3 seconds before the next measurement

   except KeyboardInterrupt:
       # Handle KeyboardInterrupt (Ctrl+C) to gracefully exit the loop
       pass


**Explication du code**

#. Importe la classe ``DistanceSensor`` de la bibliothèque ``gpiozero`` pour la mesure de distance, et la fonction ``sleep`` du module ``time`` pour les délais.

   .. code-block:: python

       #!/usr/bin/env python3
       from gpiozero import DistanceSensor
       from time import sleep

#. Initialise le capteur de distance ultrasonique avec la broche Echo connectée à GPIO 24 et la broche Trigger à GPIO 23.

   .. code-block:: python

       # Initialize the DistanceSensor using GPIO Zero library
       # Trigger pin is connected to GPIO 23, Echo pin to GPIO 24
       sensor = DistanceSensor(echo=24, trigger=23)

#. La boucle principale mesure continuellement la distance, la convertit de mètres en centimètres et l'imprime avec une précision de deux décimales. Puis attend 0,3 secondes avant de refaire une mesure. Gère un KeyboardInterrupt (comme Ctrl+C) pour permettre une sortie propre du script.

   .. code-block:: python

       try:
           # Main loop to continuously measure and report distance
           while True:
               dis = sensor.distance * 100  # Measure distance and convert from meters to centimeters
               print('Distance: {:.2f} cm'.format(dis))  # Print the distance with two decimal precision
               sleep(0.3)  # Wait for 0.3 seconds before the next measurement

       except KeyboardInterrupt:
           # Handle KeyboardInterrupt (Ctrl+C) to gracefully exit the loop
           pass

