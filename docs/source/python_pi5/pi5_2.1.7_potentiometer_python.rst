.. note::

    隆Hola! Bienvenidos a la comunidad de entusiastas de SunFounder Raspberry Pi, Arduino y ESP32 en Facebook. Sum茅rgete m谩s en Raspberry Pi, Arduino y ESP32 con otros entusiastas.

    **驴Por qu茅 unirse?**

    - **Soporte experto**: Resuelve problemas postventa y desaf铆os t茅cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprender y compartir**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Avances exclusivos**: Obt茅n acceso anticipado a anuncios de nuevos productos y adelantos.
    - **Descuentos especiales**: Disfruta de descuentos exclusivos en nuestros productos m谩s recientes.
    - **Promociones festivas y sorteos**: Participa en sorteos y promociones de temporada.

     驴Listo para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 煤nete hoy mismo!

.. _2.1.7_py_pi5:

2.1.7 Potenci贸metro
======================


.. note::

   .. image:: ../img/mcp3008_and_adc0834.jpg
      :width: 25%
      :align: left
    

   Dependiendo de la versi贸n de su kit, identifique si tiene **ADC0834** o **MCP3008** y contin煤e con la secci贸n correspondiente.

Introducci贸n
----------------

La funci贸n ADC se puede utilizar para convertir se帽ales anal贸gicas en se帽ales digitales y, 
en este experimento, se utiliza el ADC0834 para obtener la funci贸n que implica ADC. Aqu铆, 
implementamos este proceso utilizando un potenci贸metro. El potenci贸metro cambia la cantidad 
f铆sica: el voltaje, que es convertido por la funci贸n ADC.

Componentes necesarios
------------------------------

En este proyecto, necesitamos los siguientes componentes.

.. image:: ../python_pi5/img/2.1.7_potentiometer_list.png

Es definitivamente conveniente comprar un kit completo, aqu铆 est谩 el enlace:

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nombre	
        - ARTCULOS EN ESTE KIT
        - ENLACE
    *   - Kit Raphael
        - 337
        - |link_Raphael_kit|

Tambi茅n puedes comprarlos por separado en los enlaces a continuaci贸n.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCCIN DEL COMPONENTE
        - ENLACE DE COMPRA

    *   - :ref:`cpn_gpio_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_led`
        - |link_led_buy|
    *   - :ref:`cpn_potentiometer`
        - |link_potentiometer_buy|
    *   - :ref:`cpn_adc0834`
        - \-

Diagrama esquem谩tico
------------------------

.. image:: ../python_pi5/img/2.1.7_potentiometer_second_1.png


.. image:: ../python_pi5/img/2.1.7_potentiometer_second_2.png

Procedimientos experimentales
--------------------------------

**Paso 1:** Construye el circuito.

.. image:: ../python_pi5/img/2.1.7_Potentiometer_circuit.png


.. note::
    Coloca el chip refiri茅ndote a la posici贸n correspondiente
    mostrada en la imagen. Ten en cuenta que las ranuras del chip deben estar a la 
    izquierda cuando se coloque.

**Paso 2:** Abre el archivo de c贸digo

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/python-pi5

**Paso 3:** Ejecuta.

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 2.1.7_Potentiometer_zero.py

Despu茅s de ejecutar el c贸digo, gira la perilla del potenci贸metro, la intensidad del LED cambiar谩 en consecuencia.

.. warning::

    Si recibe el mensaje de error ``RuntimeError: Cannot determine SOC peripheral base address``, consulte :ref:`faq_soc`


**C贸digo**

.. note::

    Puedes **Modificar/Restablecer/Copiar/Ejecutar/Detener** el c贸digo a continuaci贸n. Pero antes de eso, debes ir a la ruta del c贸digo fuente como ``raphael-kit/python-pi5``. Despu茅s de modificar el c贸digo, puedes ejecutarlo directamente para ver el efecto.


.. raw:: html

    <run></run>

.. code-block:: python

   #!/usr/bin/env python3

   from gpiozero import PWMLED
   import ADC0834
   import time

   # Inicializar un LED PWM en el pin GPIO 22
   led = PWMLED(22)

   # Configurar el m贸dulo ADC0834
   ADC0834.setup()

   def MAP(x, in_min, in_max, out_min, out_max):
       """
       Map a value from one range to another.
       :param x: The value to be mapped.
       :param in_min: The lower bound of the value's current range.
       :param in_max: The upper bound of the value's current range.
       :param out_min: The lower bound of the value's target range.
       :param out_max: The upper bound of the value's target range.
       :return: The mapped value.
       """
       return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min

   try:
       while True:
           # Obtener la lectura actual del m贸dulo ADC0834
           res = ADC0834.getResult()
           print('res = %d' % res)

           # Mapear el valor del ADC a un rango adecuado para ajustar el brillo del LED
           R_val = MAP(res, 0, 255, 0, 100)

           # Ajustar el brillo del LED
           led.value = float(R_val / 100)

           # Esperar 0.2 segundos antes de leer nuevamente
           time.sleep(0.2)

   # Salida elegante cuando se presiona 'Ctrl+C'
   except KeyboardInterrupt: 
       led.value = 0  # Apagar el LED


**Explicaci贸n del C贸digo**

#. ``gpiozero`` para el control de LED PWM, ``ADC0834`` para la conversi贸n de anal贸gico a digital y ``time`` para implementar retardos.

   .. code-block:: python

       #!/usr/bin/env python3

       from gpiozero import PWMLED
       import ADC0834
       import time

#. Inicializa un objeto PWMLED conectado al pin GPIO 22 y configura el convertidor ADC0834.

   .. code-block:: python

       # Inicializa un LED PWM en el pin GPIO 22
       led = PWMLED(22)

       # Configura el m贸dulo ADC0834
       ADC0834.setup()

#. Define una funci贸n llamada ``MAP`` para convertir un rango de valores a otro, 煤til para mapear los valores del ADC a niveles de brillo adecuados para el LED.

   .. code-block:: python

       def MAP(x, in_min, in_max, out_min, out_max):
           return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min

#. Lee continuamente el valor del ADC en un bucle, mapeando la lectura del ADC (0-255) a un nivel de brillo (0-100) para el LED. Ajusta el brillo del LED basado en este valor mapeado. Implementa un retraso de 0.2 segundos para una mejor legibilidad y estabilidad.

   .. code-block:: python

       try:
           while True:
               # Obt茅n la lectura actual del m贸dulo ADC0834
               res = ADC0834.getResult()
               print('res = %d' % res)

               # Mapea el valor del ADC a un rango adecuado para ajustar el brillo del LED
               R_val = MAP(res, 0, 255, 0, 100)

               # Ajusta el brillo del LED
               led.value = float(R_val / 100)

               # Espera 0.2 segundos antes de leer nuevamente
               time.sleep(0.2)

       # Salida elegante cuando se presiona 'Ctrl+C'
       except KeyboardInterrupt: 
           led.value = 0  # Apaga el LED
