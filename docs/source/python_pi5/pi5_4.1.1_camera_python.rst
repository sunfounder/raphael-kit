.. note::

    Hola, 춰bienvenido a la comunidad de entusiastas de SunFounder Raspberry Pi & Arduino & ESP32 en Facebook! Sum칠rgete en el mundo de Raspberry Pi, Arduino y ESP32 con otros entusiastas.

    **쯇or qu칠 unirse?**

    - **Soporte experto**: Resuelve problemas postventa y desaf칤os t칠cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Preestrenos exclusivos**: Obt칠n acceso anticipado a nuevos anuncios de productos y adelantos.
    - **Descuentos especiales**: Disfruta de descuentos exclusivos en nuestros productos m치s nuevos.
    - **Promociones y sorteos festivos**: Participa en sorteos y promociones de temporada.

    游녤 쯃isto para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 칰nete hoy mismo!

.. _4.1.1_py_pi5:

4.1.1 C치mara
=====================

Introducci칩n
----------------

Aqu칤 haremos una c치mara con un obturador, cuando presiones el bot칩n, la c치mara tomar치 una foto mientras el LED parpadea.

Componentes necesarios
----------------------------

En este proyecto, necesitamos los siguientes componentes. 

.. image:: ../python_pi5/img/4.1.1_camera_list.png
  :width: 800
  :align: center

Es definitivamente conveniente comprar un kit completo, aqu칤 est치 el enlace:

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nombre	
        - ELEMENTOS EN ESTE KIT
        - ENLACE
    *   - Raphael Kit
        - 337
        - |link_Raphael_kit|

Tambi칠n puedes comprarlos por separado en los enlaces a continuaci칩n.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCCI칍N DEL COMPONENTE
        - ENLACE DE COMPRA

    *   - :ref:`cpn_gpio_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_led`
        - |link_led_buy|
    *   - :ref:`cpn_button`
        - |link_button_buy|
    *   - :ref:`cpn_camera_module`
        - |link_camera_buy|

Diagrama esquem치tico
--------------------------

============== ====== ======== ===
Nombre T-Board f칤sico wiringPi BCM
GPIO17         Pin 11 0        17
GPIO18         Pin 12 1        18
============== ====== ======== ===

.. image:: ../python_pi5/img/4.1.1_camera_schematic.png
   :align: center

Procedimientos experimentales
----------------------------------

**Paso 1:** Construye el circuito.

.. image:: ../python_pi5/img/4.1.1_camera_circuit.png
  :width: 800
  :align: center

**Paso 2:** Ingresa al escritorio de Raspberry Pi. Puede que necesites una pantalla para una mejor experiencia, consulta: `Connect your Raspberry Pi <https://projects.raspberrypi.org/en/projects/raspberry-pi-setting-up/3>`_. O accede al escritorio de Raspberry Pi de forma remota, para un tutorial detallado consulta :ref:`remote_desktop`.

**Paso 3:** Abre una Terminal y entra en la carpeta del c칩digo.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/python-pi5

**Paso 4:** Ejecuta.

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 4.1.1_Camera_zero.py

Despu칠s de que el c칩digo se ejecute, presiona el bot칩n, el Raspberry Pi har치 parpadear el LED y tomar치 una foto. La foto se llamar치 ``my_photo.jpg`` y se guardar치 en el directorio ``~``.

.. note::

    Tambi칠n puedes abrir ``4.1.1_Camera_zero.py`` en la ruta ``~/raphael-kit/python/`` con un IDE de Python, hacer clic en el bot칩n de Ejecutar para ejecutarlo y detener el c칩digo con el bot칩n de Detener.

Si deseas descargar la foto a tu PC, consulta :ref:`filezilla`.
.. warning::

    Si recibe el mensaje de error ``RuntimeError: Cannot determine SOC peripheral base address``, consulte :ref:`faq_soc`


**C칩digo**


.. code-block:: python

   #!/usr/bin/env python3
   from picamera2 import Picamera2, Preview
   from gpiozero import LED, Button
   import time
   import os

   # Obtener el nombre de usuario actual y el directorio de inicio
   user = os.getlogin()
   user_home = os.path.expanduser(f'~{user}')

   # Inicializar la c치mara
   camera = Picamera2()
   camera.start()

   # Inicializar una variable para rastrear el estado de la c치mara
   global status
   status = False

   # Configurar el LED y el bot칩n con sus n칰meros de pin GPIO
   led = LED(17)
   button = Button(18)

   def takePhotos(pin):
       """Function to set the camera's status to True when the button is pressed."""
       global status
       status = True

   try:
       # Asignar la funci칩n a ser llamada cuando se presione el bot칩n
       button.when_pressed = takePhotos
       
       # Bucle principal
       while True:
           # Verificar si el bot칩n ha sido presionado
           if status:
               # Hacer parpadear el LED cinco veces
               for i in range(5):
                   led.on()
                   time.sleep(0.1)
                   led.off()
                   time.sleep(0.1)
               # Capturar y guardar una foto
               camera.capture_file(f'{user_home}/my_photo.jpg')
               print('Take a photo!')          
               # Reset the status
               status = False
           else:
               # Apagar el LED si no se est치 capturando
               led.off()
           
           # Esperar un corto per칤odo antes de verificar el estado del bot칩n nuevamente
           time.sleep(1)

   except KeyboardInterrupt:
       # Detener la c치mara y apagar el LED si ocurre una interrupci칩n de teclado
       camera.stop_preview()
       led.off()
       pass


**Explicaci칩n del C칩digo**

#. Importa las librer칤as necesarias para el manejo del tiempo, control de la c치mara y control de componentes GPIO.

   .. code-block:: python

       #!/usr/bin/env python3
       from picamera2 import Picamera2, Preview
       from gpiozero import LED, Button
       import time
       import os

#. Obtiene el nombre de usuario actual y el directorio de inicio para guardar las fotos.

   .. code-block:: python

       # Obtener el nombre de usuario actual y el directorio de inicio
       user = os.getlogin()
       user_home = os.path.expanduser(f'~{user}')

#. Inicializa la c치mara y la pone en marcha.

   .. code-block:: python

       # Inicializar la c치mara
       camera = Picamera2()
       camera.start()

#. Declara ``status`` como una variable global y la inicializa a ``False``.

   .. code-block:: python

       # Inicializar una variable para rastrear el estado de la c치mara
       global status
       status = False

#. Inicializa un LED conectado al pin GPIO 17 y un bot칩n conectado al pin GPIO 18.

   .. code-block:: python

       # Configurar el LED y el bot칩n con sus n칰meros de pin GPIO
       led = LED(17)
       button = Button(18)

#. Define una funci칩n ``takePhotos`` que establece la variable global ``status`` en ``True`` cuando se presiona el bot칩n.

   .. code-block:: python

       def takePhotos(pin):
           """Function to set the camera's status to True when the button is pressed."""
           global status
           status = True

#. Asigna la funci칩n ``takePhotos`` para ser llamada cuando se presione el bot칩n.

   .. code-block:: python

       try:
           # Asignar la funci칩n a ser llamada cuando se presione el bot칩n
           button.when_pressed = takePhotos
           
           ...
           
#. Verifica continuamente si ``status`` es ``True``. Si es as칤, hace parpadear el LED cinco veces, captura una foto y restablece ``status``. Si no, el LED permanece apagado. Hay un retraso de 1 segundo entre cada iteraci칩n del bucle.

   .. code-block:: python

       try:        
           ...
           
           # Bucle principal
           while True:
               # Verificar si el bot칩n ha sido presionado
               if status:
                   # Hacer parpadear el LED cinco veces
                   for i in range(5):
                       led.on()
                       time.sleep(0.1)
                       led.off()
                       time.sleep(0.1)
                   # Capturar y guardar una foto
                   camera.capture_file(f'{user_home}/my_photo.jpg')
                   print('Take a photo!')          
                   # Reset the status
                   status = False
               else:
                   # Apagar el LED si no se est치 capturando
                   led.off()
               
               # Esperar un corto per칤odo antes de verificar el estado del bot칩n nuevamente
               time.sleep(1)

#. Captura una interrupci칩n de teclado (como Ctrl+C) y detiene la vista previa de la c치mara y apaga el LED antes de salir.

   .. code-block:: python

       except KeyboardInterrupt:
           # Detener la c치mara y apagar el LED si ocurre una interrupci칩n de teclado
           camera.stop_preview()
           led.off()
           pass

