.. note::

    隆Hola, bienvenido a la Comunidad de Entusiastas de SunFounder para Raspberry Pi, Arduino y ESP32 en Facebook! Sum茅rgete en el mundo de Raspberry Pi, Arduino y ESP32 con otros entusiastas.

    **驴Por qu茅 unirse?**

    - **Soporte Experto**: Resuelve problemas post-venta y desaf铆os t茅cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y Comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Avances Exclusivos**: Obt茅n acceso anticipado a nuevos anuncios de productos y adelantos exclusivos.
    - **Descuentos Especiales**: Disfruta de descuentos exclusivos en nuestros productos m谩s recientes.
    - **Promociones y Sorteos Festivos**: Participa en sorteos y promociones durante las festividades.

     驴Listo para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 煤nete hoy mismo!

.. _2.2.7_py_pi5:

2.2.7 PIR
==============

Introducci贸n
------------------

En este proyecto, haremos un dispositivo utilizando sensores piroel茅ctricos de infrarrojos del 
cuerpo humano. Cuando alguien se acerque al LED, este se encender谩 autom谩ticamente. Si no hay 
nadie, la luz se apagar谩. Este sensor de movimiento infrarrojo es un tipo de sensor que puede 
detectar el infrarrojo emitido por humanos y animales.


Componentes Necesarios
--------------------------

En este proyecto, necesitamos los siguientes componentes.

.. image:: ../python_pi5/img/2.2.7_pir_list.png

Es definitivamente conveniente comprar un kit completo, aqu铆 tienes el enlace:

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nombre	
        - COMPONENTES EN ESTE KIT
        - ENLACE
    *   - Kit Raphael
        - 337
        - |link_Raphael_kit|

Tambi茅n puedes comprarlos por separado en los siguientes enlaces.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCCIN DEL COMPONENTE
        - ENLACE DE COMPRA

    *   - :ref:`cpn_gpio_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_rgb_led`
        - |link_rgb_led_buy|
    *   - :ref:`cpn_pir`
        - \-

Diagrama Esquem谩tico
--------------------------

.. image:: ../python_pi5/img/2.2.7_pir_schematic.png


Procedimientos Experimentales
----------------------------------

**Paso 1:** Construir el circuito.

.. image:: ../python_pi5/img/2.2.7_pir_circuit.png

**Paso 2:** Ve a la carpeta del c贸digo.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/python-pi5

**Paso 3:** Ejecuta el archivo ejecutable.

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 2.2.7_PIR_zero.py

Despu茅s de ejecutar el c贸digo, el PIR detectar谩 el entorno y har谩 que el LED RGB brille en amarillo si detecta a alguien pasando.

Hay dos potenci贸metros en el m贸dulo PIR: uno para ajustar la sensibilidad y otro para ajustar la distancia de detecci贸n. Para que el m贸dulo PIR funcione mejor, necesitas girar ambos completamente en sentido contrario a las agujas del reloj.

.. image:: ../python_pi5/img/2.2.7_PIR_TTE.png
    :width: 400
    :align: center

.. warning::

    Si recibe el mensaje de error ``RuntimeError: Cannot determine SOC peripheral base address``, consulte :ref:`faq_soc`


**C贸digo**

.. note::

    Puedes **Modificar/Restablecer/Copiar/Ejecutar/Detener** el c贸digo a continuaci贸n. Pero antes de eso, necesitas ir a la ruta del c贸digo fuente como ``raphael-kit/python-pi5``. Despu茅s de modificar el c贸digo, puedes ejecutarlo directamente para ver el efecto.


.. raw:: html

    <run></run>

.. code-block:: python

   #!/usr/bin/env python3
   from gpiozero import RGBLED, MotionSensor
   from time import sleep

   # Inicializar el LED RGB y el sensor de movimiento PIR usando la biblioteca GPIO Zero
   led = RGBLED(red=18, green=27, blue=22)  # LED RGB conectado a los pines GPIO 18 (Rojo), 27 (Verde), 22 (Azul)
   pir = MotionSensor(17)  # Sensor PIR conectado al pin GPIO 17

   try:
       # Monitorear continuamente el movimiento y actualizar el color del LED
       while True:
           if pir.motion_detected:  # Verificar si el sensor PIR detecta movimiento
               led.color = (1, 1, 0)  # Establecer el color del LED a amarillo (Rojo + Verde)
           else:
               led.color = (0, 0, 1)  # Establecer el color del LED a azul (solo Azul)
           sleep(0.1)  # Breve retraso para reducir la carga de la CPU

   except KeyboardInterrupt:
       # Manejar la interrupci贸n del teclado (Ctrl+C) para salir del bucle de manera ordenada
       pass


**Explicaci贸n del C贸digo**

#. Importa la clase ``RGBLED`` para controlar un LED RGB y la clase ``MotionSensor`` para la detecci贸n de movimiento de la biblioteca GPIO Zero. Tambi茅n importa la funci贸n ``sleep`` para crear retrasos.

   .. code-block:: python

       #!/usr/bin/env python3
       from gpiozero import RGBLED, MotionSensor
       from time import sleep

#. Inicializa un LED RGB con componentes rojo, verde y azul conectados a los pines GPIO 18, 27 y 22, respectivamente. Tambi茅n inicializa un sensor PIR en el pin GPIO 17.

   .. code-block:: python

       # Inicializar el LED RGB y el sensor de movimiento PIR usando la biblioteca GPIO Zero
       led = RGBLED(red=18, green=27, blue=22)  # LED RGB conectado a los pines GPIO 18 (Rojo), 27 (Verde), 22 (Azul)
       pir = MotionSensor(17)  # Sensor PIR conectado al pin GPIO 17

#. El programa entra en un bucle infinito, verificando continuamente si hay movimiento con el sensor PIR. Si se detecta movimiento, el LED se pone amarillo (mezcla de rojo y verde). Si no se detecta movimiento, el LED se pone azul. Un breve retraso de 0.1 segundos reduce la carga de la CPU.

   .. code-block:: python

       try:
           # Monitorear continuamente el movimiento y actualizar el color del LED
           while True:
               if pir.motion_detected:  # Verificar si el sensor PIR detecta movimiento
                   led.color = (1, 1, 0)  # Establecer el color del LED a amarillo (Rojo + Verde)
               else:
                   led.color = (0, 0, 1)  # Establecer el color del LED a azul (solo Azul)
               sleep(0.1)  # Breve retraso para reducir la carga de la CPU

       except KeyboardInterrupt:
           # Manejar la interrupci贸n del teclado (Ctrl+C) para salir del bucle de manera ordenada
           pass

