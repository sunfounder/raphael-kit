 
.. _3.1.1_py_pi5:

3.1.1 Module Photographique
===============================

Introduction
---------------

Dans ce kit, équipé d'un module caméra, essayons de prendre une photo avec le Raspberry Pi.

Composants nécessaires
--------------------------

Dans ce projet, nous avons besoin des composants suivants.

.. image:: ../python_pi5/img/3.3.1_photograph_list.png
  :width: 800

Il est certainement pratique d'acheter un kit complet, voici le lien :

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nom
        - ARTICLES DANS CE KIT
        - LIEN
    *   - Kit Raphael
        - 337
        - |link_Raphael_kit|

Vous pouvez également les acheter séparément via les liens ci-dessous.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCTION DU COMPOSANT
        - LIEN D'ACHAT

    *   - :ref:`cpn_camera_module`
        - |link_camera_buy|

Procédures expérimentales
-----------------------------

**Étape 1 :** Accédez au bureau du Raspberry Pi. Vous aurez peut-être besoin d'un écran pour une meilleure expérience, référez-vous à : `Connecter votre Raspberry Pi <https://projects.raspberrypi.org/en/projects/raspberry-pi-setting-up/3>`_. Ou accédez au bureau du Raspberry Pi à distance, pour un tutoriel détaillé veuillez consulter :ref:`remote_desktop`.

**Étape 2 :** Vérifiez si la caméra est activée. Pour les instructions, veuillez consulter : :ref:`enable_camera`.

**Étape 3 :** Ouvrez un Terminal et accédez au dossier du code.

.. code-block::

    cd ~/raphael-kit/python-pi5

**Étape 4 :** Exécutez.

.. code-block::

    sudo python3 3.1.1_PhotographModule_zero.py

Lorsque le code s'exécute, la caméra prendra une photo. Vous pouvez maintenant voir la photo nommée ``my_photo.jpg`` dans le répertoire ``~``.

.. note::

    Vous pouvez également ouvrir ``3.1.1_PhotographModule.py`` dans le chemin ``~/raphael-kit/python-pi5/`` avec un IDE Python, cliquer sur le bouton Exécuter pour exécuter et arrêter le code avec le bouton Stop.

Si vous souhaitez télécharger la photo sur votre PC, veuillez vous référer à :ref:`filezilla`.

**Code**

.. code-block:: python

   #!/usr/bin/env python3    
   from picamera2 import Picamera2, Preview
   import os

   # Get the current user's login name
   user = os.getlogin()
   # Get the path to the user's home directory
   user_home = os.path.expanduser(f'~{user}')

   # Create a Picamera2 instance
   camera = Picamera2()
   # Retrieve the default preview configuration
   preview_config = camera.preview_configuration

   try:
       # Set preview size and format
       preview_config.size = (800, 600)
       preview_config.format = 'XRGB8888'  
       # Start the camera preview in QTGL mode
       camera.start_preview(Preview.QTGL)
       # Start the camera
       camera.start()
       # Capture and save a photo to the user's home directory
       camera.capture_file(f'{user_home}/my_photo.jpg')

   except KeyboardInterrupt:
       # Stop the camera preview if a KeyboardInterrupt (e.g., Ctrl+C) occurs
       camera.stop_preview()
       pass


**Explication du Code**

#. Importe les classes ``Picamera2`` et ``Preview`` de la bibliothèque picamera2, ainsi que le module ``os`` pour les interactions avec le système d'exploitation.

   .. code-block:: python

       #!/usr/bin/env python3    
       from picamera2 import Picamera2, Preview
       import os

#. Récupère le nom d'utilisateur actuel et le chemin de son répertoire personnel.

   .. code-block:: python

       # Get the current user's login name
       user = os.getlogin()
       # Get the path to the user's home directory
       user_home = os.path.expanduser(f'~{user}')

#. Crée une instance de la classe ``Picamera2`` et récupère la configuration de prévisualisation par défaut.

   .. code-block:: python

       # Create a Picamera2 instance
       camera = Picamera2()
       # Retrieve the default preview configuration
       preview_config = camera.preview_configuration

#. Définit la taille et le format de la prévisualisation de la caméra. La taille est définie à 800x600 pixels, et le format à ``XRGB8888``.

   .. code-block:: python

       try:
           # Set preview size and format
           preview_config.size = (800, 600)
           preview_config.format = 'XRGB8888'

           ...

#. Démarre la prévisualisation de la caméra en mode QTGL, puis démarre la caméra elle-même.

   .. code-block:: python

       try:
           ...
           
           # Start the camera preview in QTGL mode
           camera.start_preview(Preview.QTGL)
           # Start the camera
           camera.start()

           ...

#. Capture une image à partir de la caméra et l'enregistre dans le répertoire personnel de l'utilisateur.

   .. code-block:: python

       try:
           ...           
           
           # Capture and save a photo to the user's home directory
           camera.capture_file(f'{user_home}/my_photo.jpg')

   .. note::
       Vous pouvez utiliser la fonction ``camera.capture()`` et une boucle ``for`` ensemble pour réaliser une prise de vue en continu. Utilisez la fonction ``delay`` pour ajuster l'intervalle de temps entre les prises de vue.

       .. code-block:: python

           for i in 5:
               camera.capture(f'{user_home}/my_photo%s.jpg' % i)

#. Ce bloc de code gère une interruption clavier (comme Ctrl+C) en arrêtant la prévisualisation de la caméra. L'instruction ``pass`` est utilisée pour gérer l'exception sans faire autre chose.

   .. code-block:: python

       except KeyboardInterrupt:
           # Stop the camera preview if a KeyboardInterrupt (e.g., Ctrl+C) occurs
           camera.stop_preview()
           pass



