.. note::

    ã“ã‚“ã«ã¡ã¯ã€SunFounderã®Raspberry Pi & Arduino & ESP32æ„›å¥½å®¶ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã‚ˆã†ã“ãï¼Facebookä¸Šã§Raspberry Piã€Arduinoã€ESP32ã«ã¤ã„ã¦ã‚‚ã£ã¨æ·±ãæ˜ã‚Šä¸‹ã’ã€ä»–ã®æ„›å¥½å®¶ã¨äº¤æµã—ã¾ã—ã‚‡ã†ã€‚

    **å‚åŠ ã™ã‚‹ç†ç”±ã¯ï¼Ÿ**

    - **ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚µãƒãƒ¼ãƒˆ**ï¼šã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„ãƒãƒ¼ãƒ ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€è²©å£²å¾Œã®å•é¡Œã‚„æŠ€è¡“çš„ãªèª²é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚
    - **å­¦ã³ï¼†å…±æœ‰**ï¼šãƒ’ãƒ³ãƒˆã‚„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’äº¤æ›ã—ã¦ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚
    - **ç‹¬å çš„ãªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼šæ–°è£½å“ã®ç™ºè¡¨ã‚„å…ˆè¡Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚
    - **ç‰¹åˆ¥å‰²å¼•**ï¼šæœ€æ–°è£½å“ã®ç‹¬å å‰²å¼•ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
    - **ç¥­ã‚Šã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚®ãƒ•ãƒˆ**ï¼šã‚®ãƒ•ãƒˆã‚„ç¥æ—¥ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚

    ğŸ‘‰ ç§ãŸã¡ã¨ä¸€ç·’ã«æ¢ç´¢ã—ã€å‰µé€ ã™ã‚‹æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ[|link_sf_facebook|]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä»Šã™ãå‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

.. _2.2.3_c_pi5:

2.2.3 DHT-11
==================

ã¯ã˜ã‚ã«
--------------

ãƒ‡ã‚¸ã‚¿ãƒ«æ¸©åº¦æ¹¿åº¦ã‚»ãƒ³ã‚µãƒ¼DHT11ã¯ã€æ¸©åº¦ã¨æ¹¿åº¦ã®ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ãƒˆã•ã‚ŒãŸãƒ‡ã‚¸ã‚¿ãƒ«ä¿¡å·å‡ºåŠ›ã‚’å«ã‚€è¤‡åˆã‚»ãƒ³ã‚µãƒ¼ã§ã™ã€‚å°‚ç”¨ã®ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åé›†æŠ€è¡“ã¨æ¸©åº¦æ¹¿åº¦æ¤œçŸ¥æŠ€è¡“ãŒé©ç”¨ã•ã‚Œã¦ãŠã‚Šã€è£½å“ãŒé«˜ã„ä¿¡é ¼æ€§ã¨å„ªã‚ŒãŸå®‰å®šæ€§ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºä¿ã—ã¾ã™ã€‚

ã‚»ãƒ³ã‚µãƒ¼ã«ã¯ã€æ¹¿å¼æŠµæŠ—ã‚»ãƒ³ã‚µãƒ¼ã¨NTCæ¸©åº¦ã‚»ãƒ³ã‚µãƒ¼ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€é«˜æ€§èƒ½ã®8ãƒ“ãƒƒãƒˆãƒã‚¤ã‚¯ãƒ­ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«æ¥ç¶šã•ã‚Œã¦ã„ã¾ã™ã€‚

å¿…è¦ãªéƒ¨å“
------------------------------

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå¿…è¦ã§ã™ã€‚

.. image:: ../img/list_2.2.3_dht-11.png

å…¨ã‚­ãƒƒãƒˆã‚’è³¼å…¥ã™ã‚‹ã“ã¨ã¯ç¢ºã‹ã«ä¾¿åˆ©ã§ã™ã€‚ãƒªãƒ³ã‚¯ã¯ã“ã¡ã‚‰ï¼š

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - åå‰	
        - ã“ã®ã‚­ãƒƒãƒˆã®ã‚¢ã‚¤ãƒ†ãƒ 
        - ãƒªãƒ³ã‚¯
    *   - Raphael Kit
        - 337
        - |link_Raphael_kit|

ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å€‹åˆ¥ã«è³¼å…¥ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç´¹ä»‹
        - è³¼å…¥ãƒªãƒ³ã‚¯

    *   - :ref:`cpn_gpio_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_humiture_sensor`
        - |link_humiture_buy|

å›è·¯å›³
-----------------

.. image:: ../img/image326.png


å®Ÿé¨“æ‰‹é †
-----------------------

**ã‚¹ãƒ†ãƒƒãƒ—1:** å›è·¯ã‚’ä½œæˆã—ã¾ã™ã€‚

.. image:: ../img/image207.png

**ã‚¹ãƒ†ãƒƒãƒ—2:** ã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã—ã¾ã™ã€‚

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/c/2.2.3/

**ã‚¹ãƒ†ãƒƒãƒ—3:** ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¾ã™ã€‚

.. raw:: html

   <run></run>

.. code-block::

    gcc 2.2.3_DHT.c -lwiringPi

**ã‚¹ãƒ†ãƒƒãƒ—4:** å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

.. raw:: html

   <run></run>

.. code-block::

    sudo ./a.out

ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®ç”»é¢ã«DHT11ã§æ¤œå‡ºã•ã‚ŒãŸæ¸©åº¦ã¨æ¹¿åº¦ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

.. note::

    å®Ÿè¡Œå¾Œã«å‹•ä½œã—ãªã„ã€ã¾ãŸã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆã€ŒwiringPi.h: No such file or directoryã€ã¯ã€ :ref:`install_wiringpi` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**ã‚³ãƒ¼ãƒ‰**

.. code-block:: c

    #include <wiringPi.h>
    #include <stdio.h>
    #include <stdlib.h>
    #include <stdint.h>

    #define maxTim 85
    #define dhtPin 0

    int dht11_dat[5] = {0,0,0,0,0};

    void readDht11() {
        uint8_t laststate = HIGH;
        uint8_t counter = 0;
        uint8_t j = 0, i;
        float Fah; // fahrenheit
        dht11_dat[0] = dht11_dat[1] = dht11_dat[2] = dht11_dat[3] = dht11_dat[4] = 0;
        // pull pin down for 18 milliseconds
        pinMode(dhtPin, OUTPUT);
        digitalWrite(dhtPin, LOW);
        delay(18);
        // then pull it up for 40 microseconds
        digitalWrite(dhtPin, HIGH);
        delayMicroseconds(40); 
        // prepare to read the pin
        pinMode(dhtPin, INPUT);

        // detect change and read data
        for ( i=0; i< maxTim; i++) {
            counter = 0;
            while (digitalRead(dhtPin) == laststate) {
                counter++;
                delayMicroseconds(1);
                if (counter == 255) {
                    break;
                }
            }
            laststate = digitalRead(dhtPin);

            if (counter == 255) break;
            // ignore first 3 transitions
            if ((i >= 4) && (i%2 == 0)) {
                // shove each bit into the storage bytes
                dht11_dat[j/8] <<= 1;
                if (counter > 50)
                    dht11_dat[j/8] |= 1;
                j++;
            }
        }
        // check we read 40 bits (8bit x 5 ) + verify checksum in the last byte
        // print it out if data is good
        if ((j >= 40) && 
                (dht11_dat[4] == ((dht11_dat[0] + dht11_dat[1] + dht11_dat[2] + dht11_dat[3]) & 0xFF)) ) {
            Fah = dht11_dat[2] * 9. / 5. + 32;
            printf("Humidity = %d.%d %% Temperature = %d.%d *C (%.1f *F)\n", 
                    dht11_dat[0], dht11_dat[1], dht11_dat[2], dht11_dat[3], Fah);
        }
    }

    int main (void) {
        if(wiringPiSetup() == -1){ //when initialize wiring failed, print messageto screen
            printf("setup wiringPi failed !");
            return 1; 
        }
        while (1) {
            readDht11();
            delay(500); // wait 1sec to refresh
        }
        return 0 ;
    }

**ã‚³ãƒ¼ãƒ‰èª¬æ˜**

.. code-block:: c

    void readDht11() {
        uint8_t laststate = HIGH;
        uint8_t counter = 0;
        uint8_t j = 0, i;
        float Fah; // fahrenheit
        dht11_dat[0] = dht11_dat[1] = dht11_dat[2] = dht11_dat[3] = dht11_dat[4] = 0;
        // ...
    }

ã“ã®é–¢æ•°ã¯DHT11ã®æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ä¸»ã«3ã¤ã®éƒ¨åˆ†ã«åˆ†ã‘ã‚‰ã‚Œã¾ã™ï¼š

1. ãƒ”ãƒ³ã®èª­ã¿å–ã‚Šæº–å‚™:

.. code-block:: c

    // pull pin down for 18 milliseconds
    pinMode(dhtPin, OUTPUT);
    digitalWrite(dhtPin, LOW);
    delay(18);
    // then pull it up for 40 microseconds
    digitalWrite(dhtPin, HIGH);
    delayMicroseconds(40); 
    // prepare to read the pin
    pinMode(dhtPin, INPUT);

ãã®é€šä¿¡ã®æµã‚Œã¯ã€å‹•ä½œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ã‚ˆã£ã¦æ±ºã¾ã‚Šã¾ã™ã€‚

.. image:: ../img/image208.png


DHT11ãŒèµ·å‹•ã™ã‚‹ã¨ã€MCUã¯ä½ãƒ¬ãƒ™ãƒ«ã®ä¿¡å·ã‚’é€ä¿¡ã—ã€ãã®å¾Œ40usã®é–“ã«é«˜ãƒ¬ãƒ™ãƒ«ã®ä¿¡å·ã‚’ç¶­æŒã—ã¾ã™ã€‚ãã®å¾Œã€å¤–éƒ¨ç’°å¢ƒã®æ¡ä»¶ã®æ¤œå‡ºãŒå§‹ã¾ã‚Šã¾ã™ã€‚

2. ãƒ‡ãƒ¼ã‚¿èª­ã¿å–ã‚Š:

.. code-block:: c

    // detect change and read data  
    for ( i=0; i< maxTim; i++) {
            counter = 0;
            while (digitalRead(dhtPin) == laststate) {
                counter++;
                delayMicroseconds(1);
                if (counter == 255) {
                    break;
                }
            }
            laststate = digitalRead(dhtPin);
            if (counter == 255) break;
            // ignore first 3 transitions
            if ((i >= 4) && (i%2 == 0)) {
                // shove each bit into the storage bytes
                dht11_dat[j/8] <<= 1;
                if (counter > 50)
                    dht11_dat[j/8] |= 1;
                j++;
            }
        }

ã“ã®ãƒ«ãƒ¼ãƒ—ã¯ã€æ¤œå‡ºã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’dht11_dat[]é…åˆ—ã«æ ¼ç´ã—ã¾ã™ã€‚DHT11ã¯ä¸€åº¦ã«40ãƒ“ãƒƒãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ã¾ã™ã€‚æœ€åˆã®16ãƒ“ãƒƒãƒˆã¯æ¹¿åº¦ã«é–¢é€£ã—ã€ä¸­å¤®ã®16ãƒ“ãƒƒãƒˆã¯æ¸©åº¦ã«é–¢é€£ã—ã€æœ€å¾Œã®8ãƒ“ãƒƒãƒˆã¯æ¤œè¨¼ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯ï¼š

**8ãƒ“ãƒƒãƒˆã®æ¹¿åº¦æ•´æ•°ãƒ‡ãƒ¼ã‚¿** + **8ãƒ“ãƒƒãƒˆã®æ¹¿åº¦å°æ•°ãƒ‡ãƒ¼ã‚¿** + **8ãƒ“ãƒƒãƒˆã®æ¸©åº¦æ•´æ•°ãƒ‡ãƒ¼ã‚¿** + **8ãƒ“ãƒƒãƒˆã®æ¸©åº¦å°æ•°ãƒ‡ãƒ¼ã‚¿** + **8ãƒ“ãƒƒãƒˆã®ãƒã‚§ãƒƒã‚¯ãƒ“ãƒƒãƒˆ**ã€‚

3. æ¹¿åº¦ & æ¸©åº¦ã®å°åˆ·

.. code-block:: c

    // check we read 40 bits (8bit x 5 ) + verify checksum in the last byte
    // print it out if data is good
    if ((j >= 40) && 
            (dht11_dat[4] == ((dht11_dat[0] + dht11_dat[1] + dht11_dat[2] + dht11_dat[3]) & 0xFF)) ) {
        Fah = dht11_dat[2] * 9. / 5. + 32;
        printf("Humidity = %d.%d %% Temperature = %d.%d *C (%.1f *F)\n", 
                dht11_dat[0], dht11_dat[1], dht11_dat[2], dht11_dat[3], Fah);
    }

ãƒ‡ãƒ¼ã‚¿ãŒ40ãƒ“ãƒƒãƒˆã«é”ã—ãŸã‚‰ã€ **ãƒã‚§ãƒƒã‚¯ãƒ“ãƒƒãƒˆ(dht11_dat[4])** ã‚’é€šã˜ã¦ãƒ‡ãƒ¼ã‚¿ã®æœ‰åŠ¹æ€§ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ãã®å¾Œã€æ¸©åº¦ã¨æ¹¿åº¦ã‚’å°åˆ·ã—ã¾ã™ã€‚

ä¾‹ã¨ã—ã¦ã€å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿ãŒ00101011(æ¹¿åº¦æ•´æ•°ã®8ãƒ“ãƒƒãƒˆå€¤) 00000000 (æ¹¿åº¦å°æ•°ã®8ãƒ“ãƒƒãƒˆå€¤) 00111100 (æ¸©åº¦æ•´æ•°ã®8ãƒ“ãƒƒãƒˆå€¤) 00000000 (æ¸©åº¦å°æ•°ã®8ãƒ“ãƒƒãƒˆå€¤) 01100111 (ãƒã‚§ãƒƒã‚¯ãƒ“ãƒƒãƒˆ)ã®å ´åˆã€

**è¨ˆç®—:**

00101011+00000000+00111100+00000000=01100111ã€‚

æœ€çµ‚çµæœãŒãƒã‚§ãƒƒã‚¯ãƒ“ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã¨ç­‰ã—ã„å ´åˆã€å—ä¿¡ãƒ‡ãƒ¼ã‚¿ã¯æ­£ç¢ºã§ã™ã€‚

æ¹¿åº¦=43%ï¼Œæ¸©åº¦=60Â°Cã€‚

ãã‚ŒãŒãƒã‚§ãƒƒã‚¯ãƒ“ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã¨ç­‰ã—ããªã„å ´åˆã€ãƒ‡ãƒ¼ã‚¿ã®ä¼é€ãŒæ­£å¸¸ã§ã¯ãªãã€ãƒ‡ãƒ¼ã‚¿ã¯å†ã³å—ä¿¡ã•ã‚Œã¾ã™ã€‚

ç¾è±¡ã®ç”»åƒ
------------------

.. image:: ../img/image209.jpeg