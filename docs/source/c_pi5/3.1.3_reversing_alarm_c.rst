.. nota::

    춰Hola, bienvenido a la comunidad de entusiastas de SunFounder Raspberry Pi & Arduino & ESP32 en Facebook! Sum칠rgete m치s en Raspberry Pi, Arduino y ESP32 con otros entusiastas.

    **쯇or qu칠 unirse?**

    - **Soporte experto**: Resuelve problemas postventa y desaf칤os t칠cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprender y compartir**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Previsualizaciones exclusivas**: Obt칠n acceso temprano a anuncios de nuevos productos y adelantos exclusivos.
    - **Descuentos especiales**: Disfruta de descuentos exclusivos en nuestros productos m치s nuevos.
    - **Promociones y sorteos festivos**: Participa en sorteos y promociones festivas.

    游녤 쯃isto para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 칰nete hoy mismo.

.. _3.1.3_c_pi5:

3.1.3 Alarma de Reversa
================================

Introducci칩n
----------------

En este proyecto, usaremos una pantalla LCD, un zumbador y sensores ultras칩nicos 
para crear un sistema de asistencia de reversa. Podemos colocarlo en un veh칤culo 
controlado a distancia para simular el proceso real de reversa del coche en el garaje.

Componentes Necesarios
------------------------------

En este proyecto, necesitaremos los siguientes componentes. 

.. image:: ../img/list_Reversing_Alarm.png
    :align: center

Es definitivamente conveniente comprar un kit completo, aqu칤 est치 el enlace:

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nombre
        - ART칈CULOS EN ESTE KIT
        - ENLACE
    *   - Kit Raphael
        - 337
        - |link_Raphael_kit|

Tambi칠n puedes comprarlos por separado desde los enlaces a continuaci칩n.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCCI칍N DEL COMPONENTE
        - ENLACE DE COMPRA

    *   - :ref:`cpn_gpio_extension_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_buzzer`
        - \-
    *   - :ref:`cpn_transistor`
        - |link_transistor_buy|
    *   - :ref:`cpn_ultrasonic_sensor`
        - |link_ultrasonic_buy|
    *   - :ref:`cpn_i2c_lcd`
        - |link_i2clcd1602_buy|
Diagrama Esquem치tico
------------------------

El sensor ultras칩nico detecta la distancia entre 칠l mismo y el obst치culo, 
que se mostrar치 en la pantalla LCD en forma de c칩digo. Al mismo tiempo, 
el sensor ultras칩nico hace que el zumbador emita un sonido de advertencia 
de diferentes frecuencias seg칰n el valor de la distancia.

============== ======== ======== ===
Nombre T-Board f칤sica   wiringPi BCM
GPIO23         Pin 16   4        23
GPIO24         Pin 18   5        24
GPIO17         Pin 11   0        17
SDA1           Pin 3             
SCL1           Pin 5             
============== ======== ======== ===

.. image:: ../img/Schematic_three_one3.png
   :align: center

Procedimientos Experimentales
---------------------------------

**Paso 1:** Construye el circuito.

.. image:: ../img/image242.png

**Paso 2:** Cambiar directorio.

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/raphael-kit/c/3.1.3/

**Paso 3:** Compilar.

.. raw:: html

   <run></run>

.. code-block:: 

    gcc 3.1.3_ReversingAlarm.c -lwiringPi

**Paso 4:** Ejecutar.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo ./a.out

A medida que se ejecuta el c칩digo, el m칩dulo de sensor ultras칩nico detecta la 
distancia al obst치culo y luego muestra la informaci칩n sobre la distancia en el 
LCD1602; adem치s, el zumbador emite un tono de advertencia cuya frecuencia cambia 
con la distancia.

.. nota::

    * Si aparece un mensaje de error ``wiringPi.h: No such file or directory``, consulta :ref:`install_wiringpi`.
    * Si aparece el error ``Unable to open I2C device: No such file or directory``, consulta :ref:`i2c_config` para habilitar I2C y verificar si el cableado es correcto.
    * Si el c칩digo y el cableado est치n bien, pero la pantalla LCD a칰n no muestra contenido, puedes girar el potenci칩metro en la parte posterior para aumentar el contraste.

**C칩digo**

.. note::
    Los siguientes c칩digos est치n incompletos. Si deseas ver los c칩digos completos,
    se sugiere usar el comando nano 3.1.1_ReversingAlarm.c.

.. code-block:: c

    #include <wiringPi.h>
    #include <stdio.h>
    #include <sys/time.h>
    #include <wiringPi.h>
    #include <wiringPiI2C.h>
    #include <string.h>

    #define Trig    4
    #define Echo    5
    #define Buzzer  0

    int LCDAddr = 0x27;
    int BLEN = 1;
    int fd;

    //here is the function of LCD
    void write_word(int data){...}

    void send_command(int comm){...}

    void send_data(int data){...}

    void lcdInit(){...}

    void clear(){...}

    void write(int x, int y, char data[]){...}

    //here is the function of Ultrasonic
    void ultraInit(void){...}

    float disMeasure(void){...}

    //here is the main function
    int main(void)
    {
        float dis;
        char result[10];
        if(wiringPiSetup() == -1){ 
            printf("setup wiringPi failed !");
            return 1;
        }

        pinMode(Buzzer,OUTPUT);
        fd = wiringPiI2CSetup(LCDAddr);
        lcdInit();
        ultraInit();

        clear();
        write(0, 0, "Ultrasonic Starting"); 
        write(1, 1, "By Sunfounder");   

        while(1){
            dis = disMeasure();
            printf("%.2f cm \n",dis);
            digitalWrite(Buzzer,LOW);
            if (dis > 400){
                clear();
                write(0, 0, "Error");
                write(3, 1, "Out of range");    
                delay(500);
            }
            else
            {
                clear();
                write(0, 0, "Distance is");
                sprintf(result,"%.2f cm",dis);
                write(5, 1, result);

                if(dis>=50)
                {delay(500);}
                else if(dis<50 & dis>20) {
                    for(int i=0;i<2;i++){
                    digitalWrite(Buzzer,HIGH);
                    delay(50);
                    digitalWrite(Buzzer,LOW);
                    delay(200);
                    }
                }
                else if(dis<=20){
                    for(int i=0;i<5;i++){
                    digitalWrite(Buzzer,HIGH);
                    delay(50);
                    digitalWrite(Buzzer,LOW);
                    delay(50);
                    }
                }
            }   
        }

        return 0;
    }

**Explicaci칩n del C칩digo**

.. code-block:: c

    pinMode(Buzzer,OUTPUT);
    fd = wiringPiI2CSetup(LCDAddr);
    lcdInit();
    ultraInit();

En este programa, aplicamos componentes anteriores de manera sint칠tica. Aqu칤 usamos 
zumbadores, LCD y ultrasonido. Los inicializamos de la misma manera que hicimos antes.

.. code-block:: c

    dis = disMeasure();
    printf("%.2f cm \n",dis);
    digitalWrite(Buzzer,LOW);
    if (dis > 400){
        write(0, 0, "Error");
        write(3, 1, "Out of range");    
    }
    else
    {
        write(0, 0, "Distance is");
        sprintf(result,"%.2f cm",dis);
        write(5, 1, result);
	}

Aqu칤 obtenemos el valor del sensor ultras칩nico y calculamos la distancia.

Si el valor de la distancia es mayor que el valor del rango a detectar,
se imprime un mensaje de error en el LCD. Y si el valor de la distancia est치
dentro del rango, se mostrar치n los resultados correspondientes.

.. code-block:: c

    sprintf(result,"%.2f cm",dis);

Dado que el modo de salida del LCD solo admite el tipo de car치cter y la
variable dis almacena el valor de tipo float, necesitamos usar sprintf().
La funci칩n convierte el valor de tipo float en un car치cter y lo almacena
en la variable de cadena result[]. %.2f significa mantener dos decimales.

.. code-block:: c

    if(dis>=50)
    {delay(500);}
    else if(dis<50 & dis>20) {
        for(int i=0;i<2;i++){
        digitalWrite(Buzzer,HIGH);
        delay(50);
        digitalWrite(Buzzer,LOW);
        delay(200);
        }
    }
    else if(dis<=20){
        for(int i=0;i<5;i++){
        digitalWrite(Buzzer,HIGH);
        delay(50);
        digitalWrite(Buzzer,LOW);
        delay(50);
        }
    }

Esta condici칩n de juicio se utiliza para controlar el sonido del zumbador.
De acuerdo con la diferencia en la distancia, se puede dividir en tres
casos, en los que habr치 diferentes frecuencias de sonido. Dado que
el valor total de delay es 500, todos los casos pueden proporcionar un intervalo
de 500 ms para el sensor ultras칩nico.

Imagen del Fen칩meno
-----------------------

.. image:: ../img/image243.jpeg
   :align: center