.. note::

    ã“ã‚“ã«ã¡ã¯ã€SunFounderã®Raspberry Pi & Arduino & ESP32æ„›å¥½å®¶ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã‚ˆã†ã“ãï¼Facebookä¸Šã§Raspberry Piã€Arduinoã€ESP32ã«ã¤ã„ã¦ã‚‚ã£ã¨æ·±ãæ˜ã‚Šä¸‹ã’ã€ä»–ã®æ„›å¥½å®¶ã¨äº¤æµã—ã¾ã—ã‚‡ã†ã€‚

    **å‚åŠ ã™ã‚‹ç†ç”±ã¯ï¼Ÿ**

    - **ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚µãƒãƒ¼ãƒˆ**ï¼šã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„ãƒãƒ¼ãƒ ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€è²©å£²å¾Œã®å•é¡Œã‚„æŠ€è¡“çš„ãªèª²é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚
    - **å­¦ã³ï¼†å…±æœ‰**ï¼šãƒ’ãƒ³ãƒˆã‚„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’äº¤æ›ã—ã¦ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚
    - **ç‹¬å çš„ãªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼šæ–°è£½å“ã®ç™ºè¡¨ã‚„å…ˆè¡Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚
    - **ç‰¹åˆ¥å‰²å¼•**ï¼šæœ€æ–°è£½å“ã®ç‹¬å å‰²å¼•ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
    - **ç¥­ã‚Šã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚®ãƒ•ãƒˆ**ï¼šã‚®ãƒ•ãƒˆã‚„ç¥æ—¥ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚

    ğŸ‘‰ ç§ãŸã¡ã¨ä¸€ç·’ã«æ¢ç´¢ã—ã€å‰µé€ ã™ã‚‹æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ[|link_sf_facebook|]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä»Šã™ãå‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

.. _2.2.9_c_pi5:

2.2.9 MPU6050ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
===========================

ã¯ã˜ã‚ã«
------------

MPU-6050ã¯ã€ä¸–ç•Œåˆã‹ã¤å”¯ä¸€ã®6è»¸ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒ‡ãƒã‚¤ã‚¹ï¼ˆ3è»¸ã‚¸ãƒ£ã‚¤ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ãŠã‚ˆã³3è»¸åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ï¼‰ã§ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã€ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã€ã‚¦ã‚§ã‚¢ãƒ©ãƒ–ãƒ«ã‚»ãƒ³ã‚µãƒ¼å‘ã‘ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ç‰¹æ€§ã€ä½æ¶ˆè²»é›»åŠ›ã€ä½ã‚³ã‚¹ãƒˆã€é«˜æ€§èƒ½ã®è¦ä»¶ã‚’å«ã¿ã¾ã™ã€‚

ã“ã®å®Ÿé¨“ã§ã¯ã€I2Cã‚’ä½¿ç”¨ã—ã¦MPU6050ã®ä¸‰è»¸åŠ é€Ÿã‚»ãƒ³ã‚µãƒ¼ã¨ä¸‰è»¸ã‚¸ãƒ£ã‚¤ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ã®å€¤ã‚’å–å¾—ã—ã€ç”»é¢ã«è¡¨ç¤ºã—ã¾ã™ã€‚

å¿…è¦ãªéƒ¨å“
------------------------------

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

.. image:: ../img/list_2.2.6.png

å…¨ä½“ã‚­ãƒƒãƒˆã‚’è³¼å…¥ã™ã‚‹ã®ã¯ç¢ºã‹ã«ä¾¿åˆ©ã§ã™ã€‚ãƒªãƒ³ã‚¯ã¯ã“ã¡ã‚‰ï¼š

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - åå‰
        - ã“ã®ã‚­ãƒƒãƒˆã®ã‚¢ã‚¤ãƒ†ãƒ 
        - ãƒªãƒ³ã‚¯
    *   - Raphael Kit
        - 337
        - |link_Raphael_kit|

ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å€‹åˆ¥ã«è³¼å…¥ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç´¹ä»‹
        - è³¼å…¥ãƒªãƒ³ã‚¯

    *   - :ref:`cpn_gpio_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_mpu6050`
        - |link_mpu6050_buy|

å›è·¯å›³
-----------------

MPU6050ã¯ã€I2Cãƒã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä»‹ã—ã¦ãƒã‚¤ã‚¯ãƒ­ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¨é€šä¿¡ã—ã¾ã™ã€‚SDA1ã¨SCL1ã¯ã€å¯¾å¿œã™ã‚‹ãƒ”ãƒ³ã«æ¥ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

.. image:: ../img/image330.png

å®Ÿé¨“æ‰‹é †
----------------------------------

**ã‚¹ãƒ†ãƒƒãƒ—1:** å›è·¯ã‚’ä½œæˆã—ã¾ã™ã€‚

.. image:: ../img/image227.png

**ã‚¹ãƒ†ãƒƒãƒ—2**: I2Cã‚’è¨­å®šã—ã¾ã™ï¼ˆè©³ç´°ã¯ä»˜éŒ² :ref:`i2c_config` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã™ã§ã«I2Cã‚’è¨­å®šã—ã¦ã„ã‚‹å ´åˆã¯ã€ã“ã®æ‰‹é †ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚ï¼‰

**ã‚¹ãƒ†ãƒƒãƒ—3:** ã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã—ã¾ã™ã€‚

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/c/2.2.9/

**ã‚¹ãƒ†ãƒƒãƒ—4:** ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¾ã™ã€‚

.. raw:: html

   <run></run>

.. code-block::

    gcc 2.2.9_mpu6050.c -lwiringPi -lm

**ã‚¹ãƒ†ãƒƒãƒ—5:** å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

.. raw:: html

   <run></run>

.. code-block::

    sudo ./a.out

ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€MPU6050ã§èª­ã¿å–ã£ãŸxè»¸ã€yè»¸ã®åè§’ã€å„è»¸ä¸Šã®åŠ é€Ÿåº¦ã¨è§’é€Ÿåº¦ãŒè¨ˆç®—ã•ã‚Œã¦ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

.. note::

    * ã‚¨ãƒ©ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ ``wiringPi.h: No such file or directory`` ãŒã‚ã‚‹å ´åˆã¯ã€ :ref:`install_wiringpi` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
    * ``Unable to open I2C device: No such file or directory`` ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ :ref:`i2c_config` ã‚’å‚ç…§ã—ã¦I2Cã‚’æœ‰åŠ¹ã«ã—ã€é…ç·šãŒæ­£ã—ã„ã‹ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

**ã‚³ãƒ¼ãƒ‰**

.. code-block:: c

    #include  <wiringPiI2C.h>
    #include <wiringPi.h>
    #include  <stdio.h>
    #include  <math.h>
    int fd;
    int acclX, acclY, acclZ;
    int gyroX, gyroY, gyroZ;
    double acclX_scaled, acclY_scaled, acclZ_scaled;
    double gyroX_scaled, gyroY_scaled, gyroZ_scaled;

    int read_word_2c(int addr)
    {
    int val;
    val = wiringPiI2CReadReg8(fd, addr);
    val = val << 8;
    val += wiringPiI2CReadReg8(fd, addr+1);
    if (val >= 0x8000)
        val = -(65536 - val);
    return val;
    }

    double dist(double a, double b)
    {
    return sqrt((a*a) + (b*b));
    }

    double get_y_rotation(double x, double y, double z)
    {
    double radians;
    radians = atan2(x, dist(y, z));
    return -(radians * (180.0 / M_PI));
    }

    double get_x_rotation(double x, double y, double z)
    {
    double radians;
    radians = atan2(y, dist(x, z));
    return (radians * (180.0 / M_PI));
    }

    int main()
    {
    fd = wiringPiI2CSetup (0x68);
    wiringPiI2CWriteReg8 (fd,0x6B,0x00);//disable sleep mode 
    printf("set 0x6B=%X\n",wiringPiI2CReadReg8 (fd,0x6B));
    
    while(1) {

        gyroX = read_word_2c(0x43);
        gyroY = read_word_2c(0x45);
        gyroZ = read_word_2c(0x47);

        gyroX_scaled = gyroX / 131.0;
        gyroY_scaled = gyroY / 131.0;
        gyroZ_scaled = gyroZ / 131.0;

        //Print values for the X, Y, and Z axes of the gyroscope sensor.
        printf("My gyroX_scaled: %f\n", gyroY X_scaled);
        printf("My gyroY_scaled: %f\n", gyroY Y_scaled);
        printf("My gyroZ_scaled: %f\n", gyroY Z_scaled);

        acclX = read_word_2c(0x3B);
        acclY = read_word_2c(0x3D);
        acclZ = read_word_2c(0x3F);

        acclX_scaled = acclX / 16384.0;
        acclY_scaled = acclY / 16384.0;
        acclZ_scaled = acclZ / 16384.0;
        
        //Print the X, Y, and Z values of the acceleration sensor.
        printf("My acclX_scaled: %f\n", acclX_scaled);
        printf("My acclY_scaled: %f\n", acclY_scaled);
        printf("My acclZ_scaled: %f\n", acclZ_scaled);

        printf("My X rotation: %f\n", get_x_rotation(acclX_scaled, acclY_scaled, acclZ_scaled));
        printf("My Y rotation: %f\n", get_y_rotation(acclX_scaled, acclY_scaled, acclZ_scaled));
        
        delay(100);
    }
    return 0;
    }

**ã‚³ãƒ¼ãƒ‰èª¬æ˜**

.. code-block:: c

    int read_word_2c(int addr)
    {
    int val;
    val = wiringPiI2CReadReg8(fd, addr);
    val = val << 8;
    val += wiringPiI2CReadReg8(fd, addr+1);
    if (val >= 0x8000)
        val = -(65536 - val);
    return val;
    }

MPU6050ã‹ã‚‰é€ä¿¡ã•ã‚Œã‚‹ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Šã¾ã™ã€‚

.. code-block:: c

    double get_y_rotation(double x, double y, double z)
    {
    double radians;
    radians = atan2(x, dist(y, z));
    return -(radians * (180.0 / M_PI));
    }

Yè»¸ä¸Šã®åè§’ã‚’å–å¾—ã—ã¾ã™ã€‚

.. code-block:: c

    double get_x_rotation(double x, double y, double z)
    {
    double radians;
    radians = atan2(y, dist(x, z));
    return (radians * (180.0 / M_PI));
    }

Xè»¸ã®åè§’ã‚’è¨ˆç®—ã—ã¾ã™ã€‚

.. code-block:: c

    gyroX = read_word_2c(0x43);
    gyroY = read_word_2c(0x45);
    gyroZ = read_word_2c(0x47);

    gyroX_scaled = gyroX / 131.0;
    gyroY_scaled = gyroY / 131.0;
    gyroZ_scaled = gyroZ / 131.0;

    //Print values for the X, Y, and Z axes of the gyroscope sensor.
    printf("My gyroX_scaled: %f\n", gyroY X_scaled);
    printf("My gyroY_scaled: %f\n", gyroY Y_scaled);
    printf("My gyroZ_scaled: %f\n", gyroY Z_scaled);

ã‚¸ãƒ£ã‚¤ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ã‚»ãƒ³ã‚µãƒ¼ã®xè»¸ã€yè»¸ã€zè»¸ã®å€¤ã‚’èª­ã¿å–ã‚Šã€
ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è§’é€Ÿåº¦ã®å€¤ã«å¤‰æ›ã—ã¦ã€ãã‚Œã‚‰ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚

.. code-block:: c

    acclX = read_word_2c(0x3B);
    acclY = read_word_2c(0x3D);
    acclZ = read_word_2c(0x3F);

    acclX_scaled = acclX / 16384.0;
    acclY_scaled = acclY / 16384.0;
    acclZ_scaled = acclZ / 16384.0;

    //Print the X, Y, and Z values of the acceleration sensor.
    printf("My acclX_scaled: %f\n", acclX_scaled);
    printf("My acclY_scaled: %f\n", acclY_scaled);
    printf("My acclZ_scaled: %f\n", acclZ_scaled);

åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã®xè»¸ã€yè»¸ã€zè»¸ã®å€¤ã‚’èª­ã¿å–ã‚Šã€
ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’åŠ é€Ÿåº¦ã®å€¤ï¼ˆé‡åŠ›å˜ä½ï¼‰ã«å¤‰æ›ã—ã¦ã€ãã‚Œã‚‰ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚

.. code-block:: c

    printf("My X rotation: %f\n", get_x_rotation(acclX_scaled, acclY_scaled, acclZ_scaled));
    printf("My Y rotation: %f\n", get_y_rotation(acclX_scaled, acclY_scaled, acclZ_scaled));

xè»¸ã¨yè»¸ã®åè§’ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚

ç¾è±¡ã®ç”»åƒ
------------------

.. image:: ../img/image228.jpeg