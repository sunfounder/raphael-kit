 
.. note::

    Bonjour et bienvenue dans la Communaut√© Facebook des passionn√©s de Raspberry Pi, Arduino et ESP32 de SunFounder ! Plongez plus profond√©ment dans l'univers des Raspberry Pi, Arduino et ESP32 avec d'autres passionn√©s.

    **Pourquoi rejoindre ?**

    - **Support d'experts** : R√©solvez les probl√®mes apr√®s-vente et les d√©fis techniques avec l'aide de notre communaut√© et de notre √©quipe.
    - **Apprendre et partager** : √âchangez des astuces et des tutoriels pour am√©liorer vos comp√©tences.
    - **Aper√ßus exclusifs** : Acc√©dez en avant-premi√®re aux annonces de nouveaux produits et aux aper√ßus.
    - **R√©ductions sp√©ciales** : Profitez de r√©ductions exclusives sur nos produits les plus r√©cents.
    - **Promotions festives et cadeaux** : Participez √† des cadeaux et des promotions de vacances.

    üëâ Pr√™t √† explorer et √† cr√©er avec nous ? Cliquez [|link_sf_facebook|] et rejoignez-nous aujourd'hui !

.. _3.1.2_c_pi5:

3.1.2 Bienvenue
=================================

Introduction
-------------

Dans ce projet, nous utiliserons un capteur PIR pour d√©tecter le mouvement des pi√©tons et des servos,
une LED et un buzzer pour simuler le fonctionnement de la porte automatique d'un magasin de proximit√©. 
Lorsque le pi√©ton entre dans la zone de d√©tection du capteur PIR, le voyant s'allume, la porte s'ouvre
et le buzzer √©met un signal sonore d'ouverture.

Composants N√©cessaires
------------------------------

Pour ce projet, nous avons besoin des composants suivants.

.. image:: ../img/list_Welcome.png
    :align: center

Il est vraiment pratique d'acheter un kit complet, voici le lien : 

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nom
        - ARTICLES DANS CE KIT
        - LIEN
    *   - Kit Raphael
        - 337
        - |link_Raphael_kit|

Vous pouvez √©galement les acheter s√©par√©ment via les liens ci-dessous.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCTION AUX COMPOSANTS
        - LIEN D'ACHAT

    *   - :ref:`cpn_gpio_extension_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_led`
        - |link_led_buy|
    *   - :ref:`cpn_pir`
        - \-
    *   - :ref:`cpn_servo`
        - |link_servo_buy|
    *   - :ref:`cpn_buzzer`
        - |link_passive_buzzer_buy|
    *   - :ref:`cpn_transistor`
        - |link_transistor_buy|

Sch√©ma de C√¢blage
-------------------

============ ======== ======== ===
T-Board Name physical wiringPi BCM
GPIO18       Pin 12   1        18
GPIO17       Pin 11   0        17
GPIO27       Pin 13   2        27
GPIO22       Pin 15   3        22
============ ======== ======== ===

.. image:: ../img/Schematic_three_one2.png
   :align: center

Proc√©dures Exp√©rimentales
-----------------------------

**√âtape 1:** Construire le circuit.

.. image:: ../img/image239.png
    :align: center

**√âtape 2:** Changer de r√©pertoire.

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/raphael-kit/c/3.1.2/

**√âtape 3 :** Compiler.

.. raw:: html

   <run></run>

.. code-block:: 

    gcc 3.1.2_Welcome.c -lwiringPi

**√âtape 4 :** Ex√©cuter.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo ./a.out

Apr√®s l'ex√©cution du code, si le capteur PIR d√©tecte une personne passant √† proximit√©, 
la porte s'ouvrira automatiquement (simul√©e par le servo), allumera l'indicateur et 
jouera la musique de la sonnette. Une fois la musique de la sonnette jou√©e, le syst√®me 
fermera automatiquement la porte et √©teindra l'indicateur lumineux, attendant la prochaine 
personne passant √† proximit√©.

Il y a deux potentiom√®tres sur le module PIR : l'un pour ajuster la sensibilit√© et l'autre 
pour ajuster la distance de d√©tection. Pour que le module PIR fonctionne mieux, vous devez 
les tourner compl√®tement dans le sens inverse des aiguilles d'une montre.

.. image:: ../img/PIR_TTE.png
    :width: 400
    :align: center

.. note::

    Si cela ne fonctionne pas apr√®s l'ex√©cution, ou s'il y a une erreur indiquant : "wiringPi.h : Aucun fichier ou r√©pertoire de ce type", veuillez vous r√©f√©rer √† :ref:`install_wiringpi_pi5`.

**Explication du Code**

.. code-block:: c

    void setAngle(int pin, int angle){    //Create a funtion to control the angle of the servo.
        if(angle < 0)
            angle = 0;
        if(angle > 180)
            angle = 180;
        softPwmWrite(pin,Map(angle, 0, 180, 5, 25));   
    } 

Cr√©er une fonction, setAngle, pour d√©finir l'angle du servo de 0 √† 180 degr√©s.

.. code-block:: c

    void doorbell(){
    for(int i=0;i<sizeof(song)/4;i++){
            softToneWrite(BuzPin, song[i]); 
            delay(beat[i] * 250);
        }

Cr√©er une fonction, doorbell, pour faire jouer de la musique au buzzer.

.. code-block:: c

    void closedoor(){
    digitalWrite(ledPin, LOW);   //led off
    for(int i=180;i>-1;i--){  //make servo rotate from maximum angle to minimum angle
        setAngle(servoPin,i);
        delay(1);
        }
    }

Cr√©er une fonction, closedoor, pour simuler la fermeture de la porte, √©teindre la LED et faire tourner le servo de 180 degr√©s √† 0 degr√©.

.. code-block:: c

    void opendoor(){
        digitalWrite(ledPin, HIGH);   //led on
        for(int i=0;i<181;i++){  //make servo rotate from minimum angle to maximum angle
            setAngle(servoPin,i);
            delay(1);
        }
        doorbell();
        closedoor();
    }

La fonction opendoor() comprend plusieurs parties : allumer l'indicateur lumineux, 
faire tourner le servo (simuler l'ouverture de la porte), jouer la musique de la 
sonnette du magasin et appeler la fonction closedoor() apr√®s avoir jou√© la musique.

.. code-block:: c

        int main(void)
    {
        if(wiringPiSetup() == -1){ //when initialize wiring failed,print message to screen
            printf("setup wiringPi failed !");
            return 1;
        }
        if(softToneCreate(BuzPin) == -1){
            printf("setup softTone failed !");
            return 1;
    ......

Dans la fonction main(), initialiser la biblioth√®que wiringPi et configurer softTone, 
puis d√©finir ledPin en mode sortie et pirPin en mode entr√©e. Si le capteur PIR d√©tecte 
une personne passant √† proximit√©, la fonction opendoor sera appel√©e pour simuler 
l'ouverture de la porte.

Image du Ph√©nom√®ne
--------------------

.. image:: ../img/image240.jpeg
   :align: center