.. note::

    Ciao, benvenuto nella SunFounder Raspberry Pi & Arduino & ESP32 Enthusiasts Community su Facebook! Approfondisci Raspberry Pi, Arduino ed ESP32 insieme ad altri appassionati.

    **PerchÃ© unirti?**

    - **Supporto esperto**: Risolvi problemi post-vendita e sfide tecniche con l'aiuto della nostra community e del nostro team.
    - **Impara e condividi**: Scambia suggerimenti e tutorial per migliorare le tue competenze.
    - **Anteprime esclusive**: Ottieni accesso anticipato agli annunci di nuovi prodotti e alle anteprime.
    - **Sconti speciali**: Goditi sconti esclusivi sui nostri prodotti piÃ¹ recenti.
    - **Promozioni festive e omaggi**: Partecipa a concorsi e promozioni festive.

    ğŸ‘‰ Pronto a esplorare e creare con noi? Clicca su [|link_sf_facebook|] e unisciti oggi!

.. _3.1.11_c_pi5:

3.1.11 GIOCOâ€“ Indovina il Numero
======================================

Introduzione
------------------

"Indovina il Numero" Ã¨ un divertente gioco di societÃ  in cui tu e i tuoi 
amici vi alternate a inserire un numero (0~99). L'intervallo si ridurrÃ  man 
mano che si inseriscono numeri fino a quando un giocatore non indovinerÃ  
correttamente l'enigma. A quel punto, il giocatore viene sconfitto e punito. 
Ad esempio, se il numero fortunato Ã¨ 51, che i giocatori non possono vedere, 
e il giocatore â‘  inserisce 50, l'intervallo cambia a 50~99; se il giocatore 
â‘¡ inserisce 70, l'intervallo diventa 50~70; se il giocatore â‘¢ inserisce 51, 
questo giocatore Ã¨ il sfortunato. Qui, utilizziamo una tastiera per inserire 
i numeri e un LCD per visualizzare i risultati.

Componenti necessari
------------------------------

In questo progetto, abbiamo bisogno dei seguenti componenti.

.. image:: ../img/list_GAME_Guess_Number.png
    :align: center

Ãˆ sicuramente conveniente acquistare un kit completo, ecco il link: 

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nome	
        - ELEMENTI IN QUESTO KIT
        - LINK
    *   - Kit Raphael
        - 337
        - |link_Raphael_kit|

Puoi anche acquistarli separatamente dai link sottostanti.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUZIONE COMPONENTE
        - LINK PER L'ACQUISTO

    *   - :ref:`cpn_gpio_extension_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_keypad`
        - \-
    *   - :ref:`cpn_i2c_lcd`
        - |link_i2clcd1602_buy|

Schema elettrico
-----------------------

============ ======== ======== =======
T-Board Name physical wiringPi BCM
GPIO18       Pin 12   1        18
GPIO23       Pin 16   4        23
GPIO24       Pin 18   5        24
GPIO25       Pin 22   6        25
SPIMOSI      Pin 19   12       10
GPIO22       Pin 15   3        22
GPIO27       Pin 13   2        27
GPIO17       Pin 11   0        17
SDA1         Pin 3    SDA1(8)  SDA1(2)
SCL1         Pin 5    SCL1(9)  SDA1(3)
============ ======== ======== =======

.. image:: ../img/Schematic_three_one12.png
   :align: center

Procedure sperimentali
-----------------------------

**Passo 1:** Costruisci il circuito.

.. image:: ../img/image273.png

**Passo 2**: Configura I2C (vedi Appendice :ref:`i2c_config`. Se hai giÃ  configurato I2C, salta questo passo.)

**Passo 3**: Cambia directory.

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/raphael-kit/c/3.1.11/

**Passo 4**: Compila.

.. raw:: html

   <run></run>

.. code-block:: 

    gcc 3.1.11_GAME_GuessNumber.c -lwiringPi

**Passo 5**: Esegui.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo ./a.out

Dopo l'esecuzione del programma, apparirÃ  la pagina iniziale sull'LCD:

.. note::

    * Se appare il messaggio di errore ``wiringPi.h: No such file or directory``, consulta :ref:`install_wiringpi_pi5`.
    * Se ottieni l'errore ``Unable to open I2C device: No such file or directory``, devi consultare :ref:`i2c_config` per abilitare I2C e controllare che il cablaggio sia corretto.
    * Se il codice e il cablaggio sono corretti ma l'LCD non visualizza ancora il contenuto, puoi regolare il contrasto con il potenziometro sul retro.

.. code-block:: 

   Benvenuto!
   PremiÂ AÂ perÂ iniziare!

Premi 'A', e il gioco inizierÃ  e la schermata di gioco apparirÃ  sull'LCD.

.. code-block:: 

   Inserisci numero:
   0 â€¹pointâ€¹ 99

Viene generato un numero casuale '\ **point**\ ' che non viene visualizzato 
sull'LCD all'inizio del gioco, e quello che devi fare Ã¨ indovinarlo. Il numero 
digitato apparirÃ  alla fine della prima riga fino a quando il calcolo finale 
non sarÃ  completato. (Premi 'D' per avviare la comparazione, e se il numero 
inserito Ã¨ maggiore di **10**, la comparazione automatica inizierÃ .)

L'intervallo del numero 'point' viene visualizzato sulla seconda riga. Devi 
digitare il numero entro l'intervallo. Quando digiti un numero, l'intervallo 
si restringe; se ottieni il numero fortunato, comparirÃ  "Hai indovinato!"


**Spiegazione del codice**

All'inizio del codice ci sono le funzioni di base della **keypad** e dell'**I2C LCD1602**. Puoi approfondire maggiori dettagli su di loro in :ref:`1.1.7_c_pi5` e :ref:`2.1.8_c_pi5`.

Ecco cosa dobbiamo sapere:

.. code-block:: c

    /****************************************/
    //Inizia da qui
    /****************************************/
    voidÂ init(void){
    Â Â Â Â fdÂ =Â wiringPiI2CSetup(LCDAddr);
    Â Â Â Â lcd_init();
    Â Â Â Â lcd_clear();
    Â Â Â Â for(intÂ i=0Â ;Â i<4Â ;Â i++)Â {
    Â Â Â Â Â Â Â Â pinMode(rowPins[i],Â OUTPUT);
    Â Â Â Â Â Â Â Â pinMode(colPins[i],Â INPUT);
    Â Â Â Â }
    Â Â Â Â lcd_clear();
    Â Â Â Â write(0,Â 0,Â "Welcome!");
    Â Â Â Â write(0,Â 1,Â "PressÂ AÂ toÂ go!");
    }
    
Questa funzione viene utilizzata per definire inizialmente l'**I2C LCD1602** e la **keypad** e per visualizzare "Benvenuto!" e "Premi A per iniziare!".

.. code-block:: c

    voidÂ init_new_value(void){
    Â Â Â Â srand(time(0));
    Â Â Â Â pointValueÂ =Â rand()%100;
    Â Â Â Â upperÂ =Â 99;
    Â Â Â Â lowerÂ =Â 0;
    Â Â Â Â countÂ =Â 0;
    Â Â Â Â printf("pointÂ isÂ %d\n",pointValue);
    }

La funzione genera il numero casuale '\ **point**\ ' e reimposta l'intervallo di suggerimento del numero.

.. code-block:: c

    boolÂ detect_point(void){
    Â Â Â Â if(countÂ >Â pointValue){
    Â Â Â Â Â Â Â Â if(countÂ <Â upper){
    Â Â Â Â Â Â Â Â Â Â Â Â upperÂ =Â count;
    Â Â Â Â Â Â Â Â }
    Â Â Â Â }
    Â Â Â Â elseÂ if(countÂ <Â pointValue){
    Â Â Â Â Â Â Â Â if(countÂ >Â lower){
    Â Â Â Â Â Â Â Â Â Â Â Â lowerÂ =Â count;
    Â Â Â Â Â Â Â Â }
    Â Â Â Â }
    Â Â Â Â elseÂ if(countÂ =Â pointValue){
    Â Â Â Â Â Â Â Â countÂ =Â 0;
    Â Â Â Â Â Â Â Â returnÂ 1;
    Â Â Â Â }
    Â Â Â Â countÂ =Â 0;
    Â Â Â Â returnÂ 0;
    }

``detect_point()`` confronta il numero inserito con il numero generato â€œpointâ€. 
Se l'esito del confronto non Ã¨ uguale, **count** assegnerÃ  valori a **upper** e 
**lower** e restituirÃ  '0'; altrimenti, se il risultato indica che sono uguali, 
restituirÃ  '1'.

.. code-block:: c

    voidÂ lcd_show_input(boolÂ result){
    Â Â Â Â charÂ *str=NULL;
    Â Â Â Â strÂ =(char*)malloc(sizeof(char)*3);
    Â Â Â Â lcd_clear();
    Â Â Â Â ifÂ (resultÂ ==Â 1){
    Â Â Â Â Â Â Â Â write(0,1,"You'veÂ gotÂ it!");
    Â Â Â Â Â Â Â Â delay(5000);
    Â Â Â Â Â Â Â Â init_new_value();
    Â Â Â Â Â Â Â Â lcd_show_input(0);
    Â Â Â Â Â Â Â Â return;
    Â Â Â Â }
    Â Â Â Â write(0,0,"EnterÂ number:");
    Â Â Â Â Int2Str(str,count);
    Â Â Â Â write(13,0,str);
    Â Â Â Â Int2Str(str,lower);
    Â Â Â Â write(0,1,str);
    Â Â Â Â write(3,1,"<Point<");
    Â Â Â Â Int2Str(str,upper);
    Â Â Â Â write(12,1,str);
    }

Questa funzione serve per visualizzare la pagina di gioco. 
Presta attenzione alla funzione **Int2Str(str,count)**, 
che converte queste variabili **count**, **lower**, e **upper** 
da **intero** a **stringa di caratteri** per la corretta visualizzazione sull'**lcd**.

.. code-block:: c

    intÂ main(){
    Â Â Â Â unsignedÂ charÂ pressed_keys[BUTTON_NUM];
    Â Â Â Â unsignedÂ charÂ last_key_pressed[BUTTON_NUM];
    Â Â Â Â if(wiringPiSetup()Â ==Â -1){Â //quandoÂ l'inizializzazioneÂ diÂ wiringPiÂ fallisce, stampaÂ messaggioÂ sulloÂ schermo
    Â Â Â Â Â Â Â Â printf("setupÂ wiringPiÂ failedÂ !");
    Â Â Â Â Â Â Â Â returnÂ 1;Â 
    Â Â Â Â }
    Â Â Â Â init();
    Â Â Â Â init_new_value();
    Â Â Â Â while(1){
    Â Â Â Â Â Â Â Â keyRead(pressed_keys);
    Â Â Â Â Â Â Â Â boolÂ compÂ =Â keyCompare(pressed_keys,Â last_key_pressed);
    Â Â Â Â Â Â Â Â ifÂ (!comp){
    Â Â Â Â Â Â Â Â Â Â Â Â if(pressed_keys[0]Â !=Â 0){
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â boolÂ resultÂ =Â 0;
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if(pressed_keys[0]Â ==Â 'A'){
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â init_new_value();
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lcd_show_input(0);
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â elseÂ if(pressed_keys[0]Â ==Â 'D'){
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â resultÂ =Â detect_point();
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lcd_show_input(result);
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â elseÂ if(pressed_keys[0]Â >='0'Â &&Â pressed_keys[0]Â <=Â '9'){
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â countÂ =Â countÂ *Â 10;
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â countÂ =Â countÂ +Â (pressed_keys[0]Â -Â 48);
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (count>=10){
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â resultÂ =Â detect_point();
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lcd_show_input(result);
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
    Â Â Â Â Â Â Â Â Â Â Â Â }
    Â Â Â Â Â Â Â Â Â Â Â Â keyCopy(last_key_pressed,Â pressed_keys);
    Â Â Â Â Â Â Â Â }
    Â Â Â Â Â Â Â Â delay(100);
    Â Â Â Â }
    Â Â Â Â returnÂ 0;Â Â Â 
    }

Main() contiene l'intero processo del programma, come mostrato di seguito:

1) Inizializza **I2C LCD1602** e **Keypad**.

2) Usa **init_new_value()** per creare un numero casuale **0-99**.

3) Verifica se un pulsante Ã¨ stato premuto e leggi il valore del pulsante.

4) Se viene premuto il pulsante â€˜Aâ€™, verrÃ  generato un numero casuale **0-99** 
e il gioco inizierÃ .

5) Se viene rilevata la pressione del pulsante â€˜Dâ€™, il programma entrerÃ  nel giudizio 
   del risultato e lo visualizzerÃ  sull'LCD. Questo passaggio consente di giudicare il 
   risultato anche quando viene premuto un solo numero e poi il pulsante â€˜Dâ€™.

6) Se viene premuto il pulsante **0-9**, il valore di **count** cambierÃ ; se il **count**
    Ã¨ maggiore di **10**, inizia il giudizio.

7) Le modifiche del gioco e i suoi valori vengono visualizzati su **LCD1602**.

Immagine del fenomeno
--------------------------

.. image:: ../img/image274.jpeg
   :align: center
