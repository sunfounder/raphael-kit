 
.. note::

    Bonjour et bienvenue dans la CommunautÃ© Facebook des passionnÃ©s de Raspberry Pi, Arduino et ESP32 de SunFounder ! Plongez plus profondÃ©ment dans l'univers des Raspberry Pi, Arduino et ESP32 avec d'autres passionnÃ©s.

    **Pourquoi rejoindre ?**

    - **Support d'experts** : RÃ©solvez les problÃ¨mes aprÃ¨s-vente et les dÃ©fis techniques avec l'aide de notre communautÃ© et de notre Ã©quipe.
    - **Apprendre et partager** : Ã‰changez des astuces et des tutoriels pour amÃ©liorer vos compÃ©tences.
    - **AperÃ§us exclusifs** : AccÃ©dez en avant-premiÃ¨re aux annonces de nouveaux produits et aux aperÃ§us.
    - **RÃ©ductions spÃ©ciales** : Profitez de rÃ©ductions exclusives sur nos produits les plus rÃ©cents.
    - **Promotions festives et cadeaux** : Participez Ã  des cadeaux et des promotions de vacances.

    ğŸ‘‰ PrÃªt Ã  explorer et Ã  crÃ©er avec nous ? Cliquez [|link_sf_facebook|] et rejoignez-nous aujourd'hui !

.. _3.1.11_c_pi5:

3.1.11 JEU â€“ Devinez le nombre
======================================

Introduction
------------------

Deviner les nombres est un jeu amusant oÃ¹ vous et vos amis tour Ã  tour entrez un nombre (0~99). 
La plage sera rÃ©duite Ã  chaque entrÃ©e de nombre jusqu'Ã  ce qu'un joueur trouve la bonne rÃ©ponse. 
Ensuite, le joueur est Ã©liminÃ© et puni. Par exemple, si le nombre chanceux est 51 que les joueurs 
ne peuvent pas voir, et que le joueur â‘  entre 50, la plage de nombres change Ã  50~99 ; si le joueur
â‘¡ entre 70, la plage devient 50~70 ; si le joueur â‘¢ entre 51, ce joueur est le perdant. Ici, nous utilisons un clavier pour entrer les nombres et un Ã©cran LCD pour afficher les rÃ©sultats.

Composants nÃ©cessaires
------------------------------

Pour ce projet, nous avons besoin des composants suivants.

.. image:: ../img/list_GAME_Guess_Number.png
    :align: center

Il est certainement pratique d'acheter un kit complet, voici le lien :

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nom	
        - Ã‰LÃ‰MENTS DANS CE KIT
        - LIEN
    *   - Kit Raphael
        - 337
        - |link_Raphael_kit|

Vous pouvez Ã©galement les acheter sÃ©parÃ©ment aux liens ci-dessous.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCTION DES COMPOSANTS
        - LIEN D'ACHAT

    *   - :ref:`cpn_gpio_extension_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_keypad`
        - \-
    *   - :ref:`cpn_i2c_lcd`
        - |link_i2clcd1602_buy|

SchÃ©ma de cÃ¢blage
-----------------------

=============== ======== ======== =======
Nom de la carte Physique WiringPi BCM
GPIO18          Pin 12   1        18
GPIO23          Pin 16   4        23
GPIO24          Pin 18   5        24
GPIO25          Pin 22   6        25
SPIMOSI         Pin 19   12       10
GPIO22          Pin 15   3        22
GPIO27          Pin 13   2        27
GPIO17          Pin 11   0        17
SDA1            Pin 3    SDA1(8)  SDA1(2)
SCL1            Pin 5    SCL1(9)  SDA1(3)
=============== ======== ======== =======

.. image:: ../img/Schematic_three_one12.png
   :align: center

ProcÃ©dures expÃ©rimentales
-----------------------------

**Ã‰tape 1 :** Construisez le circuit.

.. image:: ../img/image273.png

**Ã‰tape 2 :** Configurez l'I2C (voir l'appendice :ref:`i2c_config`. Si vous avez dÃ©jÃ  configurÃ© l'I2C, passez cette Ã©tape.)

**Ã‰tape 3 :** Changez de rÃ©pertoire.

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/raphael-kit/c/3.1.11/

**Ã‰tape 4 :** Compilez.

.. raw:: html

   <run></run>

.. code-block:: 

    gcc 3.1.11_GAME_GuessNumber.c -lwiringPi

**Ã‰tape 5 :** ExÃ©cutez.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo ./a.out

AprÃ¨s l'exÃ©cution du programme, la page initiale s'affiche sur l'Ã©cran LCD :

.. note::

    * Si un message d'erreur ``wiringPi.h: No such file or directory`` s'affiche, veuillez consulter :ref:`install_wiringpi_pi5`.
    * Si vous recevez l'erreur ``Unable to open I2C device: No such file or directory``, vous devez vous rÃ©fÃ©rer Ã  :ref:`i2c_config` pour activer l'I2C et vÃ©rifier si le cÃ¢blage est correct.
    * Si le code et le cÃ¢blage sont corrects, mais que l'Ã©cran LCD ne s'affiche toujours pas, vous pouvez tourner le potentiomÃ¨tre Ã  l'arriÃ¨re pour augmenter le contraste.

.. code-block:: 

   Welcome!
   PressÂ AÂ toÂ go!

Appuyez sur Â« A Â», et le jeu commencera et la page de jeu apparaÃ®tra sur l'Ã©cran LCD.

.. code-block:: 

   Enter number:
   0 â€¹pointâ€¹ 99

Un nombre alÃ©atoire â€˜\ **point**\ â€™ est gÃ©nÃ©rÃ© mais non affichÃ© sur l'Ã©cran LCD au dÃ©but du jeu, 
et votre tÃ¢che est de le deviner. Le nombre que vous avez entrÃ© apparaÃ®t Ã  la fin de la premiÃ¨re 
ligne jusqu'Ã  ce que le calcul final soit terminÃ©. (Appuyez sur Â« D Â» pour lancer la comparaison, 
et si le nombre entrÃ© est supÃ©rieur Ã  **10**, la comparaison automatique commencera.)

La plage de nombres de â€˜pointâ€™ est affichÃ©e sur la deuxiÃ¨me ligne. Vous devez entrer un nombre dans
 cette plage. Lorsque vous tapez un nombre, la plage se rÃ©duit ; si vous trouvez le nombre chanceux,
  il s'affichera Â« You've got it! Â».

**Explication du code**

Au dÃ©but du code se trouvent les fonctions de base du **clavier** et de l'**I2C LCD1602**. 
Vous pouvez en apprendre plus sur eux dans :ref:`1.1.7_c_pi5` et :ref:`2.1.8_c_pi5`.





Voici ce que vous devez savoir :

.. code-block:: c

    /****************************************/
    //StartÂ fromÂ here
    /****************************************/
    voidÂ init(void){
    Â Â Â Â fdÂ =Â wiringPiI2CSetup(LCDAddr);
    Â Â Â Â lcd_init();
    Â Â Â Â lcd_clear();
    Â Â Â Â for(intÂ i=0Â ;Â i<4Â ;Â i++)Â {
    Â Â Â Â Â Â Â Â pinMode(rowPins[i],Â OUTPUT);
    Â Â Â Â Â Â Â Â pinMode(colPins[i],Â INPUT);
    Â Â Â Â }
    Â Â Â Â lcd_clear();
    Â Â Â Â write(0,Â 0,Â "Welcome!");
    Â Â Â Â write(0,Â 1,Â "PressÂ AÂ toÂ go!");
    }
    
Cette fonction est utilisÃ©e pour initialiser l'**I2C LCD1602** et le **clavier**, et pour afficher Â« Welcome! Â» et Â« PressÂ AÂ toÂ go! Â».

.. code-block:: c

    voidÂ init_new_value(void){
    Â Â Â Â srand(time(0));
    Â Â Â Â pointValueÂ =Â rand()%100;
    Â Â Â Â upperÂ =Â 99;
    Â Â Â Â lowerÂ =Â 0;
    Â Â Â Â countÂ =Â 0;
    Â Â Â Â printf("pointÂ isÂ %d\n",pointValue);
    }

Cette fonction gÃ©nÃ¨re le nombre alÃ©atoire â€˜\ **point**\ â€™ et rÃ©initialise l'indice de plage du point.

.. code-block:: c

    boolÂ detect_point(void){
    Â Â Â Â if(countÂ >Â pointValue){
    Â Â Â Â Â Â Â Â if(countÂ <Â upper){
    Â Â Â Â Â Â Â Â Â Â Â Â upperÂ =Â count;
    Â Â Â Â Â Â Â Â }
    Â Â Â Â }
    Â Â Â Â elseÂ if(countÂ <Â pointValue){
    Â Â Â Â Â Â Â Â if(countÂ >Â lower){
    Â Â Â Â Â Â Â Â Â Â Â Â lowerÂ =Â count;
    Â Â Â Â Â Â Â Â }
    Â Â Â Â }
    Â Â Â Â elseÂ if(countÂ =Â pointValue){
    Â Â Â Â Â Â Â Â countÂ =Â 0;
    Â Â Â Â Â Â Â Â returnÂ 1;
    Â Â Â Â }
    Â Â Â Â countÂ =Â 0;
    Â Â Â Â returnÂ 0;
    }

detect_point() compare le nombre entrÃ© avec le nombre gÃ©nÃ©rÃ© â€œpointâ€. Si le rÃ©sultat de la 
comparaison indique qu'ils ne sont pas identiques, **count** assignera des valeurs Ã  **upper** 
et **lower** et retournera â€˜\ **0**\ â€™ ; sinon, s'ils sont identiques, la fonction retournera 
â€˜\ **1**\ â€™.

.. code-block:: c

    voidÂ lcd_show_input(boolÂ result){
    Â Â Â Â charÂ *str=NULL;
    Â Â Â Â strÂ =(char*)malloc(sizeof(char)*3);
    Â Â Â Â lcd_clear();
    Â Â Â Â ifÂ (resultÂ ==Â 1){
    Â Â Â Â Â Â Â Â write(0,1,"You'veÂ gotÂ it!");
    Â Â Â Â Â Â Â Â delay(5000);
    Â Â Â Â Â Â Â Â init_new_value();
    Â Â Â Â Â Â Â Â lcd_show_input(0);
    Â Â Â Â Â Â Â Â return;
    Â Â Â Â }
    Â Â Â Â write(0,0,"EnterÂ number:");
    Â Â Â Â Int2Str(str,count);
    Â Â Â Â write(13,0,str);
    Â Â Â Â Int2Str(str,lower);
    Â Â Â Â write(0,1,str);
    Â Â Â Â write(3,1,"<Point<");
    Â Â Â Â Int2Str(str,upper);
    Â Â Â Â write(12,1,str);
    }

Cette fonction permet d'afficher la page de jeu. Faites attention Ã  la fonction 
**Int2Str(str,count)**, elle convertit les variables **count**, **lower** et **upper** 
de **integer** Ã  **character string** pour un affichage correct sur l'**lcd**.

.. code-block:: c

    intÂ main(){
    Â Â Â Â unsignedÂ charÂ pressed_keys[BUTTON_NUM];
    Â Â Â Â unsignedÂ charÂ last_key_pressed[BUTTON_NUM];
    Â Â Â Â if(wiringPiSetup()Â ==Â -1){Â //whenÂ initializeÂ wiringÂ failed,printÂ messagetoÂ screen
    Â Â Â Â Â Â Â Â printf("setupÂ wiringPiÂ failedÂ !");
    Â Â Â Â Â Â Â Â returnÂ 1;Â 
    Â Â Â Â }
    Â Â Â Â init();
    Â Â Â Â init_new_value();
    Â Â Â Â while(1){
    Â Â Â Â Â Â Â Â keyRead(pressed_keys);
    Â Â Â Â Â Â Â Â boolÂ compÂ =Â keyCompare(pressed_keys,Â last_key_pressed);
    Â Â Â Â Â Â Â Â ifÂ (!comp){
    Â Â Â Â Â Â Â Â Â Â Â Â if(pressed_keys[0]Â !=Â 0){
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â boolÂ resultÂ =Â 0;
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if(pressed_keys[0]Â ==Â 'A'){
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â init_new_value();
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lcd_show_input(0);
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â elseÂ if(pressed_keys[0]Â ==Â 'D'){
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â resultÂ =Â detect_point();
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lcd_show_input(result);
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â elseÂ if(pressed_keys[0]Â >='0'Â &&Â pressed_keys[0]Â <=Â '9'){
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â countÂ =Â countÂ *Â 10;
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â countÂ =Â countÂ +Â (pressed_keys[0]Â -Â 48);
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (count>=10){
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â resultÂ =Â detect_point();
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lcd_show_input(result);
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
    Â Â Â Â Â Â Â Â Â Â Â Â }
    Â Â Â Â Â Â Â Â Â Â Â Â keyCopy(last_key_pressed,Â pressed_keys);
    Â Â Â Â Â Â Â Â }
    Â Â Â Â Â Â Â Â delay(100);
    Â Â Â Â }
    Â Â Â Â returnÂ 0;Â Â Â 
    }

Main() contient l'ensemble du processus du programme, comme montrÃ© ci-dessous :

1) Initialiser l'**I2C LCD1602** et le **clavier**.

2) Utiliser **init_new_value()** pour crÃ©er un nombre alÃ©atoire **0-99**.

3) VÃ©rifier si un bouton est appuyÃ© et lire l'Ã©tat du bouton.

4) Si le bouton â€˜\ **A**\ â€™ est appuyÃ©, un nombre alÃ©atoire **0-99** apparaÃ®tra et le jeu commencera.

5) Si le bouton â€˜\ **D**\ â€™ est dÃ©tectÃ© comme Ã©tant appuyÃ©, le programme entrera dans le jugement du rÃ©sultat et affichera le rÃ©sultat sur l'Ã©cran LCD. Cette Ã©tape permet Ã©galement de juger le rÃ©sultat lorsque vous appuyez sur un seul nombre puis sur le bouton â€˜\ **D**\ â€™.

6) Si un bouton **0-9** est appuyÃ©, la valeur de **count** sera modifiÃ©e ; si **count** est supÃ©rieur Ã  **10**, alors le jugement commence.

7) Les changements du jeu et ses valeurs sont affichÃ©s sur l'**LCD1602**.

Image du phÃ©nomÃ¨ne
------------------------

.. image:: ../img/image274.jpeg
   :align: center