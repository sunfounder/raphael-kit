.. note::

    Bonjour et bienvenue dans la Communaut√© Facebook des passionn√©s de Raspberry Pi, Arduino et ESP32 de SunFounder ! Plongez plus profond√©ment dans l'univers des Raspberry Pi, Arduino et ESP32 avec d'autres passionn√©s.

    **Pourquoi rejoindre ?**

    - **Support d'experts** : R√©solvez les probl√®mes apr√®s-vente et les d√©fis techniques avec l'aide de notre communaut√© et de notre √©quipe.
    - **Apprendre et partager** : √âchangez des astuces et des tutoriels pour am√©liorer vos comp√©tences.
    - **Aper√ßus exclusifs** : Acc√©dez en avant-premi√®re aux annonces de nouveaux produits et aux aper√ßus.
    - **R√©ductions sp√©ciales** : Profitez de r√©ductions exclusives sur nos produits les plus r√©cents.
    - **Promotions festives et cadeaux** : Participez √† des cadeaux et des promotions de vacances.

    üëâ Pr√™t √† explorer et √† cr√©er avec nous ? Cliquez [|link_sf_facebook|] et rejoignez-nous aujourd'hui !

.. _1.3.2_c_pi5:

1.3.2 Servo
=================

Introduction
--------------

Dans ce projet, nous allons apprendre √† faire tourner un servo-moteur.

Required Components
------------------------------

Dans ce projet, nous avons besoin des composants suivants. 

.. image:: ../img/list_1.3.2.png

Il est d√©finitivement pratique d'acheter un kit complet, voici le lien : 

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Name	
        - ITEMS IN THIS KIT
        - LINK
    *   - Raphael Kit
        - 337
        - |link_Raphael_kit|

Vous pouvez √©galement les acheter s√©par√©ment aux liens ci-dessous.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCTION DES COMPOSANTS
        - LIEN D'ACHAT

    *   - :ref:`cpn_gpio_extension_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_servo`
        - |link_servo_buy|

Schematic Diagram
-----------------

.. image:: ../img/image337.png


Experimental Procedures
-----------------------

**Step 1:** Construisez le circuit.

.. image:: ../img/image125.png

**Step 2**: Acc√©dez au dossier du code.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/c/1.3.2

**Step 3**: Compilez le code.

.. raw:: html

   <run></run>

.. code-block::

    gcc 1.3.2_Servo.c -lwiringPi

**Step 4**: Ex√©cutez le fichier ex√©cutable.

.. raw:: html

   <run></run>

.. code-block::

    sudo ./a.out
    
Apr√®s l'ex√©cution du programme, le servo va tourner de 
0 degr√©s √† 180 degr√©s, puis de 180 degr√©s √† 0 degr√©s, en boucle.

.. note::

    Si cela ne fonctionne pas apr√®s ex√©cution, ou s'il y a un message d'erreur : "wiringPi.h : Aucun fichier ou r√©pertoire de ce type", veuillez vous r√©f√©rer √† :ref:`install_wiringpi`.

**Code**

.. code-block:: c

    #include <wiringPi.h>
    #include <softPwm.h>
    #include <stdio.h>

    #define ServoPin    1       //define the servo to GPIO1
    long Map(long value,long fromLow,long fromHigh,long toLow,long toHigh){
        return (toHigh-toLow)*(value-fromLow) / (fromHigh-fromLow) + toLow;
    }
    void setAngle(int pin, int angle){    //Create a funtion to control the angle of the servo.
        if(angle < 0)
            angle = 0;
        if(angle > 180)
            angle = 180;
        softPwmWrite(pin,Map(angle, 0, 180, 5, 25));   
    } 

    int main(void)
    {
        int i;
        if(wiringPiSetup() == -1){ //when initialize wiring failed,print message to screen
            printf("setup wiringPi failed !");
            return 1; 
        }
        softPwmCreate(ServoPin, 0, 200);       //initialize PMW pin of servo
        while(1){
            for(i=0;i<181;i++){     // Let servo rotate from 0 to 180.            	setAngle(ServoPin,i);
                delay(2);
            }
            delay(1000);
            for(i=181;i>-1;i--){        // Let servo rotate from 180 to 0.            	setAngle(ServoPin,i);
                delay(2);
            }
            delay(1000);
        }
        return 0;
    }

**Explication du Code**

.. code-block:: c

    long Map(long value,long fromLow,long fromHigh,long toLow,long toHigh){
        return (toHigh-toLow)*(value-fromLow) / (fromHigh-fromLow) + toLow;
    }

Cr√©er une fonction ``Map()`` pour mapper la valeur dans le code suivant.

.. code-block:: c

    void setAngle(int pin, int angle){    //Create a funtion to control the angle of the servo.
        if(angle < 0)
            angle = 0;
        if(angle > 180)
            angle = 180;
        softPwmWrite(pin,Map(angle, 0, 180, 5, 25));   
    } 

Cr√©er une fonction, ``setAngle()`` pour √©crire l'angle sur le servo.

.. code-block:: c

    softPwmWrite(pin,Map(angle,0,180,5,25));  

Cette fonction peut changer le cycle de service du PWM.

Pour faire tourner le servo de 0 √† 180 ¬∞, la largeur d'impulsion doit changer
dans la plage de 0,5 ms √† 2,5 ms lorsque la p√©riode est de 20 ms ; dans la
fonction, ``softPwmCreate()`` , nous avons d√©fini que la p√©riode est
200x100us=20ms, nous devons donc mapper 0 ~ 180 √† 5x100us ~ 25x100us.

Le prototype de cette fonction est montr√© ci-dessous.

.. code-block::

    int softPwmCreateÔºàint pinÔºåint initialValueÔºåint pwmRangeÔºâ;

* ``pin``: N'importe quelle broche GPIO du Raspberry Pi peut √™tre d√©finie comme broche PWM.
* ``initialValue``: La largeur d'impulsion initiale est cette valeur initiale multipli√©e par 100us.
* ``pwmRange``: la p√©riode du PWM est cette plage PWM multipli√©e par 100us.

Photo du Ph√©nom√®ne
-----------------------

.. image:: ../img/image126.jpeg
