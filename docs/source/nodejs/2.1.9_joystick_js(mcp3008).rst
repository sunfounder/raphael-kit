.. note::

    Bonjour et bienvenue dans la communautÃ© SunFounder Raspberry Pi & Arduino & ESP32 sur FacebookÂ ! 
    Plongez plus profondÃ©ment dans le monde de RaspberryÂ Pi, Arduino et ESP32 avec d'autres passionnÃ©s.

    **Pourquoi rejoindreÂ ?**

    - **Support dâ€™experts**Â : RÃ©solvez les problÃ¨mes aprÃ¨s-vente et les dÃ©fis techniques avec lâ€™aide de notre communautÃ© et de notre Ã©quipe.
    - **Apprendre et partager**Â : Ã‰changez des astuces et des tutoriels pour amÃ©liorer vos compÃ©tences.
    - **AperÃ§us exclusifs**Â : Obtenez un accÃ¨s anticipÃ© aux annonces de nouveaux produits et aux avantâ€‘premiÃ¨res.
    - **RÃ©ductions spÃ©ciales**Â : Profitez de remises exclusives sur nos derniers produits.
    - **Promotions et concours festifs**Â : Participez Ã  des concours et promotions de vacances.

    ğŸ‘‰ PrÃªt Ã  explorer et crÃ©er avec nousÂ ? Cliquez sur [|link_sf_facebook|] et rejoignezâ€‘nous dÃ¨s aujourdâ€™huiÂ !

.. _2.1.9_js_pi5_mcp3008:

2.1.9 Joystick (MCP3008)
==========================

Introduction
--------------

Dans ce projet, nous allons apprendre comment fonctionne un joystick. 
Nous manipulons le joystick et affichons les rÃ©sultats Ã  lâ€™Ã©cran.

Composants requis
-------------------------------

Dans ce projet, nous avons besoin des composants suivantsÂ : 

.. image:: ../img/image317-copy.png

Il est dÃ©finitivement plus pratique dâ€™acheter un kit complet, voici le lienÂ : 

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nom	
        - Ã‰LÃ‰MENTS DANS CE KIT
        - LIEN
    *   - Kit Raphael
        - 337
        - |link_Raphael_kit|

Vous pouvez Ã©galement les acheter sÃ©parÃ©ment via les liens ciâ€‘dessousÂ :

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCTION DU COMPOSANT
        - LIEN Dâ€™ACHAT

    *   - :ref:`cpn_gpio_extension_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_joystick`
        - \-
    *   - :ref:`cpn_mcp3008`
        - \-

SchÃ©ma
-----------------

Lors de la lecture des donnÃ©es du joystick, il y a une diffÃ©rence entre les axesÂ :  
les donnÃ©es des axesÂ X etÂ Y sont analogiques, il faut donc utiliser le MCP3008 pour convertir la valeur analogique en valeur numÃ©rique.  
Les donnÃ©es de lâ€™axeÂ Z sont numÃ©riques, vous pouvez donc lire directement avec le GPIO ou via lâ€™ADC.

.. image:: ../img/schematic_2.1.9_joystick_mcp3008_js.png

ProcÃ©dure expÃ©rimentale
-----------------------

**Ã‰tapeÂ 1Â :** Construire le circuit.

.. image:: ../img/2.1.9_Joystick_js.png

**Ã‰tapeÂ 2Â :** Aller dans le dossier du code.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/nodejs/

**Ã‰tapeÂ 3Â :** ExÃ©cuter le code.

.. raw:: html

   <run></run>

.. code-block::

    sudo node joystick-2.js

AprÃ¨s exÃ©cution du code, bougez le joystickÂ ; les valeurs correspondantes de X, Y et Btn sont alors affichÃ©es Ã  lâ€™Ã©cran.

Code
----

.. code-block:: js

    const Gpio = require('pigpio').Gpio;
    const mcpadc = require('mcp-spi-adc');

    // Ouvrir le canal 1 (axe X)
    const xChannel = mcpadc.openMcp3008(1, { speedHz: 1350000 }, (err) => {
    if (err) {
        console.error('Ã‰chec de lâ€™ouverture du canal XÂ :', err);
        process.exit(1);
    }
    });

    // Ouvrir le canal 2 (axe Y)
    const yChannel = mcpadc.openMcp3008(2, { speedHz: 1350000 }, (err) => {
    if (err) {
        console.error('Ã‰chec de lâ€™ouverture du canal YÂ :', err);
        process.exit(1);
    }
    });

    // EntrÃ©e bouton sur GPIO22 avec pull-up
    const btn = new Gpio(22, {
    mode: Gpio.INPUT,
    pullUpDown: Gpio.PUD_UP,
    });

    // Boucle de lecture
    setInterval(() => {
    xChannel.read((errX, xReading) => {
        if (errX) {
        console.error('Erreur de lecture du canal XÂ :', errX);
        return;
        }

        yChannel.read((errY, yReading) => {
        if (errY) {
            console.error('Erreur de lecture du canal YÂ :', errY);
            return;
        }

        const x_val = Math.round(xReading.value * 1023);
        const y_val = Math.round(yReading.value * 1023);
        const btn_val = btn.digitalRead();

        console.log(`x = ${x_val}, y = ${y_val}, btn = ${btn_val}\n`);
        });
    });
    }, 100);

Explication du code
-------------------

.. code-block:: js

    const mcpadc = require('mcp-spi-adc');

Cette ligne importe le module ``mcp-spi-adc``, qui permet la communication avec le MCP3008 ADC en utilisant lâ€™interface SPI matÃ©rielle de la RaspberryÂ Pi.

.. code-block:: js

    const xChannel = mcpadc.openMcp3008(1, { speedHz: 1350000 }, ...);
    const yChannel = mcpadc.openMcp3008(2, { speedHz: 1350000 }, ...);

Ces lignes ouvrent les canaux dâ€™entrÃ©e analogiquesÂ 1 etÂ 2 du MCP3008 pour lire respectivement les signaux des axesÂ X etÂ Y du joystick.  
La vitesse de communication SPI est dÃ©finie Ã Â 1,35Â MHz.

.. code-block:: js

    const btn = new Gpio(22, {
      mode: Gpio.INPUT,
      pullUpDown: Gpio.PUD_UP,
    });

Initialise la brocheÂ GPIOÂ 22 comme entrÃ©e numÃ©rique avec une rÃ©sistance de tirage interne activÃ©e. 
Cette broche est utilisÃ©e pour lire lâ€™Ã©tat dâ€™un bouton poussoir.

.. code-block:: js

    setInterval(() => {
      xChannel.read(...);
      yChannel.read(...);
    }, 100);

Cette fonction sâ€™exÃ©cute toutes lesÂ 100Â millisecondes.  
Elle lit les valeurs des axesÂ X etÂ Y du joystick via les canauxÂ 1 etÂ 2 du MCP3008 en utilisant SPI.  
Les valeurs flottantes (plage 0.0â€“1.0) sont converties en entiers 10Â bits (0â€“1023).  
Elle lit Ã©galement lâ€™Ã©tat du bouton via ``digitalRead()`` sur GPIO22, renvoyantÂ 0 lorsquâ€™il est pressÃ© etÂ 1 lorsquâ€™il est relÃ¢chÃ©.  
Toutes les valeurs sont affichÃ©es dans la console.
