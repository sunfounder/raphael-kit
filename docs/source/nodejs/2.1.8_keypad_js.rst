.. note::

    Hallo und willkommen in der SunFounder Raspberry Pi & Arduino & ESP32 Enthusiasten-Gemeinschaft auf Facebook! Tauchen Sie tiefer ein in die Welt von Raspberry Pi, Arduino und ESP32 mit anderen Enthusiasten.

    **Warum beitreten?**

    - **Expertenunterst√ºtzung**: L√∂sen Sie Nachverkaufsprobleme und technische Herausforderungen mit Hilfe unserer Gemeinschaft und unseres Teams.
    - **Lernen & Teilen**: Tauschen Sie Tipps und Anleitungen aus, um Ihre F√§higkeiten zu verbessern.
    - **Exklusive Vorschauen**: Erhalten Sie fr√ºhzeitigen Zugang zu neuen Produktank√ºndigungen und exklusiven Einblicken.
    - **Spezialrabatte**: Genie√üen Sie exklusive Rabatte auf unsere neuesten Produkte.
    - **Festliche Aktionen und Gewinnspiele**: Nehmen Sie an Gewinnspielen und Feiertagsaktionen teil.

    üëâ Sind Sie bereit, mit uns zu erkunden und zu erschaffen? Klicken Sie auf [|link_sf_facebook|] und treten Sie heute bei!

.. _2.1.8_js:

2.1.8 Tastatur
==============

Einf√ºhrung
----------

Eine Tastatur ist ein rechteckiges Feld aus Tasten. In diesem Projekt werden wir sie nutzen, um Zeichen einzugeben.

Ben√∂tigte Komponenten
-------------------------

F√ºr dieses Projekt ben√∂tigen wir die folgenden Komponenten.

.. image:: ../img/list_2.1.5_keypad.png

Es ist definitiv praktisch, ein ganzes Set zu kaufen. Hier ist der Link:

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Name
        - ARTIKEL IN DIESEM KIT
        - LINK
    *   - Raphael Kit
        - 337
        - |link_Raphael_kit|

Sie k√∂nnen diese auch einzeln √ºber die untenstehenden Links kaufen.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - KOMPONENTENBESCHREIBUNG
        - KAUF-LINK

    *   - :ref:`cpn_gpio_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_keypad`
        - \-

Schaltplan
----------

.. image:: ../img/image315.png

.. image:: ../img/image316.png

Experimentelle Verfahren
-----------------------------

**Schritt 1:** Bauen Sie den Schaltkreis.

.. image:: ../img/image186.png

**Schritt 2:** √ñffnen Sie die Code-Datei.

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/raphael-kit/nodejs/

**Schritt 3:** Ausf√ºhren.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo node keypad.js

Nachdem der Code ausgef√ºhrt wurde, werden die Werte der auf der Tastatur gedr√ºckten Tasten (Tastenwert) auf dem Bildschirm angezeigt.

**Code**

.. code-block:: js

    const Gpio = require('pigpio').Gpio; 

    var rowsPins = [18,23,24,25];
    var colsPins = [10,6,27,17];
    var keys = ["1","2","3","A",
            "4","5","6","B",
            "7","8","9","C",
            "*","0","#","D"];      

    for(let i=0;i<rowsPins.length;i++){
        rowsPins[i] = new Gpio(rowsPins[i],{mode: Gpio.OUTPUT})
    }
    for(let i=0;i<colsPins.length;i++){
        colsPins[i] = new Gpio(colsPins[i],{
            mode: Gpio.INPUT,
            pullUpDown: Gpio.PUD_DOWN,
            edge: Gpio.RISING_EDGE
        })
    }

    var last_key_pressed = 0;

    var col=-1;
    for(let i=0;i<colsPins.length;i++){
        colsPins[i].on('interrupt',()=>{
            col=i;
            pressed_keys=keys[row*colsPins.length+col];
            if(last_key_pressed!=pressed_keys){
                console.log(`${pressed_keys}`);
            }
            last_key_pressed = pressed_keys;
        });
    }

    var row=-1;
    setInterval(() => {
        row=(row+1)%rowsPins.length;
        for(let i=0;i<rowsPins.length;i++){
            rowsPins[i].digitalWrite(0);
        }
        rowsPins[row].digitalWrite(1);
    }, 10);


**Code-Erkl√§rung**

.. code-block:: js

    const Gpio = require('pigpio').Gpio; 

    var rowsPins = [18,23,24,25];
    var colsPins = [10,6,27,17];
    var keys = ["1","2","3","A",
            "4","5","6","B",
            "7","8","9","C",
            "*","0","#","D"];      

    for(let i=0;i<rowsPins.length;i++){
        rowsPins[i] = new Gpio(rowsPins[i],{mode: Gpio.OUTPUT})
    }
    for(let i=0;i<colsPins.length;i++){
        colsPins[i] = new Gpio(colsPins[i],{
            mode: Gpio.INPUT,
            pullUpDown: Gpio.PUD_DOWN,
            edge: Gpio.RISING_EDGE
        })
    }



Im Stil der Tastatur, deklarieren Sie zwei S√§tze von Pins und eine Matrix.

Vier der Pins sind die Reihen der Tastatur, setzen Sie diese Pins in den OUTPUT-Modus;
Die anderen vier Pins sind die Spalten der Tastatur, setzen Sie diese Pins in den INPUT-Modus und richten Sie f√ºr sie den Interrupt f√ºr die steigende Flanke ein.

Das Prinzip, wie der Hauptcontroller den Tastenwert erh√§lt, ist wie folgt:
Die vier Reihen-Pins liefern nacheinander ein hohes Signalniveau. Wenn eine Taste gedr√ºckt wird,
wird der entsprechende Spalten-Pin das vom Reihen-Pin freigesetzte hohe Niveau erhalten, welches den Interrupt der steigenden Flanke ausl√∂st.

Zum Beispiel, wenn ich die Taste **3** dr√ºcke: Wenn die 2., 3. und 4. Reihe Pins das hohe Niveau freisetzen, gibt es keine Auswirkung;
Wenn der Reihen-Pin in der ersten Position das hohe Niveau freigibt, wird der dritte Spalten-Pin in der Lage sein, das hohe Niveau zu erhalten und den Interrupt der steigenden Flanke auszul√∂sen. Zu diesem Zeitpunkt l√∂sen die 1., 2. und 4. Spalten-Pins keine Ereignisse aus.

Dann, entsprechend dem 1. Reihen-Pin, der das hohe Niveau freigibt, und dem 3. Spalten-Pin, der das hohe Niveau erh√§lt, wird der Hauptcontroller wissen k√∂nnen, dass die Position der gedr√ºckten Taste (1,3) ist, was der Taste **3** entspricht.

.. image:: ../img/image187.png


.. code-block:: js

    var row=-1;
    setInterval(() => {
        row=(row+1)%rowsPins.length;
        for(let i=0;i<rowsPins.length;i++){
            rowsPins[i].digitalWrite(0);
        }
        rowsPins[row].digitalWrite(1);
    }, 10);

Die vier Reihen-Pins werden regelm√§√üig mit Hochpegel versorgt, und die Variable ``row`` wird verwendet, um den aktuell arbeitenden Reihen-Pin zu lokalisieren.

.. code-block:: js

    var col=-1;
    for(let i=0;i<colsPins.length;i++){
        colsPins[i].on('interrupt',()=>{
            col=i;
            // pressed_keys=keys[row*colsPins.length+col];
            // if(last_key_pressed!=pressed_keys){
            //     console.log(`${pressed_keys}`);
            // }
            // last_key_pressed = pressed_keys;
        });
    }

Richten Sie Interrupt-Funktionen f√ºr die vier Spalten-Pins ein,
und die Variable ``col`` wird verwendet, um die Spalten-Pins zu lokalisieren, die das Ereignis des Interrupts der steigenden Flanke ausl√∂sen.

.. code-block:: js

    pressed_keys=keys[row*colsPins.length+col];
    if(last_key_pressed!=pressed_keys){
        console.log(`${pressed_keys}`);
    }
    last_key_pressed = pressed_keys;

Es gibt auch ein St√ºck Code in der Break-Funktion, um den spezifischen Tastenwert aus der ``keys`` Matrix entsprechend ``row`` und ``col`` zu erhalten.
Und jedes Mal, wenn Sie einen neuen Tastenwert erhalten, drucken Sie den Wert.

Ph√§nomen-Bild
--------------------

.. image:: ../img/image188.jpeg


