.. note::

    Hola, 隆bienvenido a la comunidad de entusiastas de SunFounder Raspberry Pi & Arduino & ESP32 en Facebook! Sum茅rgete m谩s en Raspberry Pi, Arduino y ESP32 con otros entusiastas.

    **驴Por qu茅 unirse?**

    - **Soporte experto**: Resuelve problemas post-venta y desaf铆os t茅cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Previsualizaciones exclusivas**: Accede anticipadamente a nuevos anuncios de productos y adelantos.
    - **Descuentos especiales**: Disfruta de descuentos exclusivos en nuestros productos m谩s nuevos.
    - **Promociones y sorteos festivos**: Participa en sorteos y promociones festivas.

     驴Listo para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 煤nete hoy mismo.

.. _2.2.8_js:

2.2.8 Sensor Ultras贸nico
============================

Introducci贸n
---------------

El sensor ultras贸nico utiliza ultrasonidos para detectar objetos y medir distancias 
con precisi贸n. Emite ondas ultras贸nicas y las convierte en se帽ales electr贸nicas.

Componentes necesarios
---------------------------

En este proyecto, necesitamos los siguientes componentes.

.. image:: ../img/list_2.2.5.png

Es definitivamente conveniente comprar un kit completo, aqu铆 est谩 el enlace:

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nombre
        - ARTCULOS EN ESTE KIT
        - ENLACE
    *   - Kit Raphael
        - 337
        - |link_Raphael_kit|

Tambi茅n puedes comprarlos por separado en los enlaces a continuaci贸n.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCCIN DE COMPONENTES
        - ENLACE DE COMPRA

    *   - :ref:`cpn_gpio_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_ultrasonic_sensor`
        - |link_ultrasonic_buy|

Diagrama esquem谩tico
-------------------------

.. image:: ../img/image329.png


Procedimientos experimentales
--------------------------------

**Paso 1:** Construye el circuito.

.. image:: ../img/image220.png

**Paso 2:** Ve a la carpeta del c贸digo.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/nodejs/

**Paso 3:** Ejecuta el c贸digo.

.. raw:: html

   <run></run>

.. code-block::

    sudo node ultrasonic_sensor.js

Una vez ejecutado el c贸digo, el m贸dulo del sensor ultras贸nico detecta la distancia entre 
el obst谩culo al frente y el propio m贸dulo, luego el valor de la distancia se imprimir谩 en 
la pantalla.


**C贸digo**

.. code-block:: js

    const Gpio = require('pigpio').Gpio;

    // The number of microseconds it takes sound to travel 1cm at 20 degrees celcius
    const MICROSECDONDS_PER_CM = 1e6/34321;

    const trigger = new Gpio(23, {mode: Gpio.OUTPUT});
    const echo = new Gpio(24, {mode: Gpio.INPUT, alert: true});

    trigger.digitalWrite(0); // Make sure trigger is low

    const watchHCSR04 = () => {
      let startTick;

      echo.on('alert', (level, tick) => {
        if (level === 1) {
          startTick = tick;
        } else {
          const endTick = tick;
          const diff = (endTick >> 0) - (startTick >> 0); // Unsigned 32 bit arithmetic
          console.log(diff / 2 / MICROSECDONDS_PER_CM);
        }
      });
    };

    watchHCSR04();

    // Trigger a distance measurement once per second
    setInterval(() => {
      trigger.trigger(10, 1); // Set trigger high for 10 microseconds
    }, 1000);

**Explicaci贸n del C贸digo**

La funci贸n ``trigger`` se puede usar para generar un pulso en un GPIO y 
``alerts`` se pueden usar para determinar el tiempo de un cambio de estado GPIO 
con precisi贸n de unos pocos microsegundos. 

Estas dos caracter铆sticas se pueden combinar para medir la distancia usando un sensor 
ultras贸nico HC-SR04.

.. code-block:: js

    setInterval(() => {
      trigger.trigger(10, 1); // Set trigger high for 10 microseconds
    }, 1000);

This is to periodically send out a 10us ultrasonic pulse.

.. code-block:: js

  const watchHCSR04 = () => {

    echo.on('alert', (level, tick) => {
        if (level === 1) {
          startTick = tick;
        } else {
          const endTick = tick;
          const diff = (endTick >> 0) - (startTick >> 0); // Unsigned 32 bit arithmetic
          console.log(diff / 2 / MICROSECDONDS_PER_CM);
        }    
    });
  };

Esta funci贸n configura una alerta que registrar谩 el tiempo entre el env铆o del pulso (level es 1) y la recepci贸n del eco (level es 0).
Multiplicando la diferencia de tiempo por la velocidad del sonido (y dividiendo por 2), se puede obtener la distancia al obst谩culo delante.

.. https://github.com/fivdi/pigpio

Imagen del fen贸meno
-------------------

.. image:: ../img/image221.jpeg
