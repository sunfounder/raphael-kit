 
.. note::

    Bonjour et bienvenue dans la CommunautÃ© Facebook des passionnÃ©s de Raspberry Pi, Arduino et ESP32 de SunFounder ! Plongez plus profondÃ©ment dans l'univers des Raspberry Pi, Arduino et ESP32 avec d'autres passionnÃ©s.

    **Pourquoi rejoindre ?**

    - **Support d'experts** : RÃ©solvez les problÃ¨mes aprÃ¨s-vente et les dÃ©fis techniques avec l'aide de notre communautÃ© et de notre Ã©quipe.
    - **Apprendre et partager** : Ã‰changez des astuces et des tutoriels pour amÃ©liorer vos compÃ©tences.
    - **AperÃ§us exclusifs** : AccÃ©dez en avant-premiÃ¨re aux annonces de nouveaux produits et aux aperÃ§us.
    - **RÃ©ductions spÃ©ciales** : Profitez de rÃ©ductions exclusives sur nos produits les plus rÃ©cents.
    - **Promotions festives et cadeaux** : Participez Ã  des cadeaux et des promotions de vacances.

    ðŸ‘‰ PrÃªt Ã  explorer et Ã  crÃ©er avec nous ? Cliquez [|link_sf_facebook|] et rejoignez-nous aujourd'hui !

.. _4.1.11_py:

4.1.11 Indicateur de Batterie
===================================

.. note::

   .. image:: ../img/mcp3008_and_adc0834.jpg
      :width: 25%
      :align: left
    

   Selon la version de votre kit, identifiez si vous disposez dâ€™un **ADC0834** ou dâ€™un **MCP3008** et suivez la section correspondante.

Introduction
--------------

Dans ce projet, nous allons crÃ©er un dispositif d'indication de batterie qui peut afficher 
visuellement le niveau de la batterie sur un bargraphe LED.

.. warning::

    Nâ€™utilisez pas de composants de batterie dÃ©passant 3,3Â V afin dâ€™Ã©viter une surcharge, ce qui pourrait endommager la puce ou le RaspberryÂ Pi.

Composants Requis
------------------------------

Pour ce projet, nous avons besoin des composants suivants.

.. image:: ../img/list_Battery_Indicator.png
    :align: center

Il est certainement pratique d'acheter un kit complet, voici le lien : 

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nom	
        - Ã‰LÃ‰MENTS DANS CE KIT
        - LIEN
    *   - Kit Raphael
        - 337
        - |link_Raphael_kit|

Vous pouvez Ã©galement les acheter sÃ©parÃ©ment Ã  partir des liens ci-dessous.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCTION DU COMPOSANT
        - LIEN D'ACHAT

    *   - :ref:`cpn_gpio_extension_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_bar_graph`
        - \-
    *   - :ref:`cpn_adc0834`
        - \-

SchÃ©ma de CÃ¢blage
-------------------

============ ======== ======== ===
Nom T-Board  physique wiringPi BCM
GPIO17       Pin 11   0        17
GPIO18       Pin 12   1        18
GPIO27       Pin 13   2        27
GPIO25       Pin 22   6        25
GPIO12       Pin 32   26       12
GPIO16       Pin 36   27       16
GPIO20       Pin 38   28       20
GPIO21       Pin 40   29       21
GPIO5        Pin 29   21       5
GPIO6        Pin 31   22       6
GPIO13       Pin 33   23       13
GPIO19       Pin 35   24       19
GPIO26       Pin 37   25       26
============ ======== ======== ===

.. image:: ../img/Schematic_three_one5.png
   :align: center

ProcÃ©dures ExpÃ©rimentales
-----------------------------

**Ã‰tape 1 :** Construisez le circuit.

.. image:: ../img/image248.png

**Ã‰tape 2 :** Allez dans le dossier du code.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/python/

**Ã‰tape 3 :** ExÃ©cutez le fichier exÃ©cutable.

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 4.1.11_BatteryIndicator.py

AprÃ¨s avoir lancÃ© le programme, connectez sÃ©parÃ©ment un fil de sortie au 3Ã¨me pin de l'ADC0834 
et Ã  la masse (GND), puis reliez-les aux deux pÃ´les d'une batterie. Vous verrez les LED 
correspondantes sur le bargraphe s'allumer pour afficher le niveau de la batterie 
(plage de mesure : 0-5V).

**Code**

.. note::
    Vous pouvez **Modifier/RÃ©initialiser/Copier/ExÃ©cuter/ArrÃªter** le code ci-dessous. Mais avant cela, vous devez aller dans le chemin du code source comme ``raphael-kit/python``. AprÃ¨s avoir modifiÃ© le code, vous pouvez l'exÃ©cuter directement pour voir l'effet.

.. raw:: html

    <run></run>

.. code-block:: python

    import RPi.GPIO as GPIO
    import ADC0834
    import time

    ledPins = [25, 12, 16, 20, 21, 5, 6, 13, 19, 26]

    def setup():
        GPIO.setmode(GPIO.BCM)
        ADC0834.setup()
        for i in ledPins:
            GPIO.setup(i, GPIO.OUT)
            GPIO.output(i, GPIO.HIGH)

    def LedBarGraph(value):
        for i in ledPins:
            GPIO.output(i,GPIO.HIGH)
        for i in range(value):
            GPIO.output(ledPins[i],GPIO.LOW)

    def destroy():
        GPIO.cleanup()

    def loop():
        while True:
            analogVal = ADC0834.getResult()
            LedBarGraph(int(analogVal/25))

    if __name__ == '__main__':
        setup()
        try:
            loop()
        except KeyboardInterrupt: # When 'Ctrl+C' is pressed, the program destroy() will be executed.
            destroy()

**Explication du Code**

.. code-block:: python

    defÂ LedBarGraph(value):
    Â Â Â Â forÂ iÂ inÂ ledPins:
    Â Â Â Â Â Â Â Â GPIO.output(i,GPIO.HIGH)
    Â Â Â Â forÂ iÂ inÂ range(value):
    Â Â Â Â Â Â Â Â GPIO.output(ledPins[i],GPIO.LOW)

Cette fonction permet de contrÃ´ler l'allumage ou l'extinction des **10** LED du bargraphe. 
Nous donnons Ã  ces **10** LED des niveaux hauts pour les Ã©teindre au dÃ©part, puis nous dÃ©cidons 
combien de LED doivent s'allumer en fonction de la valeur analogique reÃ§ue.

.. code-block:: python

    defÂ loop():
    Â Â Â Â whileÂ True:
    Â Â Â Â Â Â Â Â analogValÂ =Â ADC0834.getResult()
    Â Â Â Â Â Â Â Â LedBarGraph(int(analogVal/25))

analogVal produit des valeurs (**0-255**) avec des tensions variables (**0-5V**), par exemple, 
si une tension de 3V est dÃ©tectÃ©e sur une batterie, la valeur correspondante **152** est affichÃ©e 
sur le voltmÃ¨tre.

Les **10** LED du bargraphe sont utilisÃ©es pour afficher les lectures de **analogVal**. 
255/10=25, donc Ã  chaque augmentation de **25** de la valeur analogique, une LED supplÃ©mentaire 
s'allume, par exemple, si "analogVal=150 (environ 3V), il y a 6 LED allumÃ©es."


Image du PhÃ©nomÃ¨ne
------------------------------

.. image:: ../img/image249.jpeg
   :align: center
