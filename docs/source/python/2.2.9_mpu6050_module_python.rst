.. note::

    ã“ã‚“ã«ã¡ã¯ã€SunFounderã®Raspberry Pi & Arduino & ESP32æ„›å¥½å®¶ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã‚ˆã†ã“ãï¼Facebookä¸Šã§Raspberry Piã€Arduinoã€ESP32ã«ã¤ã„ã¦ã‚‚ã£ã¨æ·±ãæ˜ã‚Šä¸‹ã’ã€ä»–ã®æ„›å¥½å®¶ã¨äº¤æµã—ã¾ã—ã‚‡ã†ã€‚

    **å‚åŠ ã™ã‚‹ç†ç”±ã¯ï¼Ÿ**

    - **ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚µãƒãƒ¼ãƒˆ**ï¼šã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„ãƒãƒ¼ãƒ ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€è²©å£²å¾Œã®å•é¡Œã‚„æŠ€è¡“çš„ãªèª²é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚
    - **å­¦ã³ï¼†å…±æœ‰**ï¼šãƒ’ãƒ³ãƒˆã‚„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’äº¤æ›ã—ã¦ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚
    - **ç‹¬å çš„ãªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼šæ–°è£½å“ã®ç™ºè¡¨ã‚„å…ˆè¡Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚
    - **ç‰¹åˆ¥å‰²å¼•**ï¼šæœ€æ–°è£½å“ã®ç‹¬å å‰²å¼•ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
    - **ç¥­ã‚Šã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚®ãƒ•ãƒˆ**ï¼šã‚®ãƒ•ãƒˆã‚„ç¥æ—¥ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚

    ğŸ‘‰ ç§ãŸã¡ã¨ä¸€ç·’ã«æ¢ç´¢ã—ã€å‰µé€ ã™ã‚‹æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ[|link_sf_facebook|]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä»Šã™ãå‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

.. _2.2.9_py:

2.2.9 MPU6050ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
=======================

ã¯ã˜ã‚ã«
---------

MPU-6050ã¯ã€ä¸–ç•Œåˆã‹ã¤å”¯ä¸€ã®6è»¸ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒ‡ãƒã‚¤ã‚¹ï¼ˆ3è»¸ã‚¸ãƒ£ã‚¤ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ãŠã‚ˆã³3è»¸åŠ é€Ÿåº¦è¨ˆï¼‰ã§ã™ã€‚ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã€ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã€ã‚¦ã‚§ã‚¢ãƒ©ãƒ–ãƒ«ã‚»ãƒ³ã‚µãƒ¼ã«å¿…è¦ãªä½æ¶ˆè²»é›»åŠ›ã€ä½ã‚³ã‚¹ãƒˆã€é«˜æ€§èƒ½ãªç‰¹æ€§ã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚

ã“ã®å®Ÿé¨“ã§ã¯ã€I2Cã‚’ä½¿ç”¨ã—ã¦MPU6050ã®ä¸‰è»¸åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã¨ä¸‰è»¸ã‚¸ãƒ£ã‚¤ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ã®å€¤ã‚’å–å¾—ã—ã€ãã‚Œã‚‰ã‚’ç”»é¢ã«è¡¨ç¤ºã—ã¾ã™ã€‚

å¿…è¦ãªéƒ¨å“
-----------------------

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå¿…è¦ã§ã™ã€‚

.. image:: ../img/list_2.2.6.png

ä¸€å¼ã‚’è³¼å…¥ã™ã‚‹ã®ãŒéå¸¸ã«ä¾¿åˆ©ã§ã™ã€ãƒªãƒ³ã‚¯ã¯ã“ã¡ã‚‰ï¼š

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - åå‰
        - ã“ã®ã‚­ãƒƒãƒˆã®ã‚¢ã‚¤ãƒ†ãƒ 
        - ãƒªãƒ³ã‚¯
    *   - Raphael Kit
        - 337
        - |link_Raphael_kit|

ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å€‹åˆ¥ã«ã‚‚è³¼å…¥ã§ãã¾ã™ã€‚

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç´¹ä»‹
        - è³¼å…¥ãƒªãƒ³ã‚¯

    *   - :ref:`cpn_gpio_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_mpu6050`
        - |link_mpu6050_buy|

å›è·¯å›³
-------------

MPU6050ã¯I2Cãƒã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä»‹ã—ã¦ãƒã‚¤ã‚¯ãƒ­ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¨é€šä¿¡ã—ã¾ã™ã€‚SDA1ã¨SCL1ã¯å¯¾å¿œã™ã‚‹ãƒ”ãƒ³ã«æ¥ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

.. image:: ../img/image330.png

å®Ÿé¨“æ‰‹é †
---------------

**ã‚¹ãƒ†ãƒƒãƒ—1ï¼š** å›è·¯ã‚’çµ„ã‚€ã€‚

.. image:: ../img/image227.png

**ã‚¹ãƒ†ãƒƒãƒ—2ï¼š** I2Cã®è¨­å®šã‚’è¡Œã†ï¼ˆè©³ç´°ã¯ä»˜éŒ² :ref:`i2c_config` ã‚’å‚ç…§ã€‚æ—¢ã«è¨­å®šã—ã¦ã„ã‚‹å ´åˆã¯ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚ï¼‰

**ã‚¹ãƒ†ãƒƒãƒ—3ï¼š** ã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã™ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/python

**ã‚¹ãƒ†ãƒƒãƒ—4ï¼š** å®Ÿè¡Œå¯èƒ½ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 2.2.9_mpu6050.py

ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€MPU6050ã§èª­ã¿å–ã£ãŸå„è»¸ã®åŠ é€Ÿåº¦ã€è§’é€Ÿåº¦ã€ãŠã‚ˆã³xè»¸ã¨yè»¸ã®åè§’ãŒè¨ˆç®—ã•ã‚ŒãŸå¾Œã«ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

.. note::

    * ã‚¨ãƒ©ãƒ¼ ``FileNotFoundError: [Errno 2] No such file or directory: '/dev/i2c-1'`` ãŒå‡ºãŸå ´åˆã¯ã€ :ref:`i2c_config` ã‚’å‚ç…§ã—ã¦I2Cã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚
    * ã‚¨ãƒ©ãƒ¼ ``ModuleNotFoundError: No module named 'smbus2'`` ãŒå‡ºãŸå ´åˆã¯ã€ ``sudo pip3 install smbus2`` ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
    * ã‚¨ãƒ©ãƒ¼ ``OSError: [Errno 121] Remote I/O error`` ãŒå‡ºãŸå ´åˆã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®é…ç·šãŒé–“é•ã£ã¦ã„ã‚‹ã‹ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è‡ªä½“ãŒå£Šã‚Œã¦ã„ã¾ã™ã€‚

**ã‚³ãƒ¼ãƒ‰**

.. note::

    ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã§ **ç·¨é›†/ãƒªã‚»ãƒƒãƒˆ/ã‚³ãƒ”ãƒ¼/å®Ÿè¡Œ/åœæ­¢** ã§ãã¾ã™ã€‚ãŸã ã—ã€ãã‚Œã‚’è¡Œã†å‰ã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒ‘ã‚¹ã«ç§»å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ï¼š ``raphael-kit/python`` ã€‚ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸå¾Œã€ç›´æ¥å®Ÿè¡Œã—ã¦åŠ¹æœã‚’ç¢ºèªã§ãã¾ã™ã€‚

.. raw:: html

    <run></run>

.. code-block:: python

    import smbus
    import math
    import time

    # Power management registers
    power_mgmt_1 = 0x6b
    power_mgmt_2 = 0x6c

    def read_byte(adr):
        return bus.read_byte_data(address, adr)

    def read_word(adr):
        high = bus.read_byte_data(address, adr)
        low = bus.read_byte_data(address, adr+1)
        val = (high << 8) + low
        return val

    def read_word_2c(adr):
        val = read_word(adr)
        if (val >= 0x8000):
            return -((65535 - val) + 1)
        else:
            return val

    def dist(a,b):
        return math.sqrt((a*a)+(b*b))

    def get_y_rotation(x,y,z):
        radians = math.atan2(x, dist(y,z))
        return -math.degrees(radians)

    def get_x_rotation(x,y,z):
        radians = math.atan2(y, dist(x,z))
        return math.degrees(radians)


    bus = smbus.SMBus(1) # or bus = smbus.SMBus(1) for Revision 2 boards
    address = 0x68       # This is the address value read via the i2cdetect command

    # Now wake the 6050 up as it starts in sleep mode
    bus.write_byte_data(address, power_mgmt_1, 0)

    while True:
        time.sleep(0.1)
        gyro_xout = read_word_2c(0x43)
        gyro_yout = read_word_2c(0x45)
        gyro_zout = read_word_2c(0x47)

        print ("gyro_xout : ", gyro_xout, " scaled: ", (gyro_xout / 131))
        print ("gyro_yout : ", gyro_yout, " scaled: ", (gyro_yout / 131))
        print ("gyro_zout : ", gyro_zout, " scaled: ", (gyro_zout / 131))

        accel_xout = read_word_2c(0x3b)
        accel_yout = read_word_2c(0x3d)
        accel_zout = read_word_2c(0x3f)

        accel_xout_scaled = accel_xout / 16384.0
        accel_yout_scaled = accel_yout / 16384.0
        accel_zout_scaled = accel_zout / 16384.0

        print ("accel_xout: ", accel_xout, " scaled: ", accel_xout_scaled)
        print ("accel_yout: ", accel_yout, " scaled: ", accel_yout_scaled)
        print ("accel_zout: ", accel_zout, " scaled: ", accel_zout_scaled)

        print ("x rotation: " , get_x_rotation(accel_xout_scaled, accel_yout_scaled, accel_zout_scaled))
        print ("y rotation: " , get_y_rotation(accel_xout_scaled, accel_yout_scaled, accel_zout_scaled))

        time.sleep(1)

**ã‚³ãƒ¼ãƒ‰èª¬æ˜**

.. code-block:: python

    def read_word(adr):
        high = bus.read_byte_data(address, adr)
        low = bus.read_byte_data(address, adr+1)
        val = (high << 8) + low
        return val

    def read_word_2c(adr):
        val = read_word(adr)
        if (val >= 0x8000):
            return -((65535 - val) + 1)
        else:
            return val

MPU6050ã‹ã‚‰é€ã‚‰ã‚Œã¦ãã‚‹ã‚»ãƒ³ã‚µãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ã€‚


.. code-block:: python

    def get_y_rotation(x,y,z):
        radians = math.atan2(x, dist(y,z))
        return -math.degrees(radians)

Yè»¸ã®ãŸã‚ã¿è§’ã‚’è¨ˆç®—ã™ã‚‹ã€‚

.. code-block:: python

    def get_x_rotation(x,y,z):
        radians = math.atan2(y, dist(x,z))
        return math.degrees(radians)

Xè»¸ã®ãŸã‚ã¿è§’ã‚’è¨ˆç®—ã™ã‚‹ã€‚

.. code-block:: python

    gyro_xout = read_word_2c(0x43)
    gyro_yout = read_word_2c(0x45)
    gyro_zout = read_word_2c(0x47)

    print ("gyro_xout : ", gyro_xout, " scaled: ", (gyro_xout / 131))
    print ("gyro_yout : ", gyro_yout, " scaled: ", (gyro_yout / 131))
    print ("gyro_zout : ", gyro_zout, " scaled: ", (gyro_zout / 131))

åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ä¸Šã®xè»¸ã€yè»¸ã€zè»¸ã®å€¤ã‚’èª­ã¿å–ã‚Šã€ãã‚Œã‚‰ã®è¦ç´ ã‚’åŠ é€Ÿåº¦å€¤ï¼ˆé‡åŠ›å˜ä½ï¼‰ã«å¤‰æ›ã—ã¦å°åˆ·ã—ã¾ã™ã€‚

.. code-block:: python

    accel_xout = read_word_2c(0x3b)
    accel_yout = read_word_2c(0x3d)
    accel_zout = read_word_2c(0x3f)

    accel_xout_scaled = accel_xout / 16384.0
    accel_yout_scaled = accel_yout / 16384.0
    accel_zout_scaled = accel_zout / 16384.0

    print ("accel_xout: ", accel_xout, " scaled: ", accel_xout_scaled)
    print ("accel_yout: ", accel_yout, " scaled: ", accel_yout_scaled)
    print ("accel_zout: ", accel_zout, " scaled: ", accel_zout_scaled)

åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ä¸Šã®xè»¸ã€yè»¸ã€zè»¸ã®å€¤ã‚’èª­ã¿å–ã‚Šã€ãã‚Œã‚‰ã®è¦ç´ ã‚’åŠ é€Ÿåº¦å€¤ï¼ˆé‡åŠ›å˜ä½ï¼‰ã«å¤‰æ›ã—ã¦å°åˆ·ã—ã¾ã™ã€‚

.. code-block:: python

    print ("x rotation: " , get_x_rotation(accel_xout_scaled, accel_yout_scaled, accel_zout_scaled))
    print ("y rotation: " , get_y_rotation(accel_xout_scaled, accel_yout_scaled, accel_zout_scaled))

xè»¸ãŠã‚ˆã³yè»¸ã®åè§’ã‚’å°åˆ·ã—ã¾ã™ã€‚

ç¾è±¡ã®ç”»åƒ
-------------

.. image:: ../img/image228.jpeg