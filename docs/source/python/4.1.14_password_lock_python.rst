.. note::

    ã“ã‚“ã«ã¡ã¯ã€SunFounderã®Raspberry Pi & Arduino & ESP32æ„›å¥½å®¶ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã‚ˆã†ã“ãï¼Facebookä¸Šã§Raspberry Piã€Arduinoã€ESP32ã«ã¤ã„ã¦ã‚‚ã£ã¨æ·±ãæ˜ã‚Šä¸‹ã’ã€ä»–ã®æ„›å¥½å®¶ã¨äº¤æµã—ã¾ã—ã‚‡ã†ã€‚

    **å‚åŠ ã™ã‚‹ç†ç”±ã¯ï¼Ÿ**

    - **ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚µãƒãƒ¼ãƒˆ**ï¼šã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„ãƒãƒ¼ãƒ ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€è²©å£²å¾Œã®å•é¡Œã‚„æŠ€è¡“çš„ãªèª²é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚
    - **å­¦ã³ï¼†å…±æœ‰**ï¼šãƒ’ãƒ³ãƒˆã‚„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’äº¤æ›ã—ã¦ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚
    - **ç‹¬å çš„ãªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼šæ–°è£½å“ã®ç™ºè¡¨ã‚„å…ˆè¡Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚
    - **ç‰¹åˆ¥å‰²å¼•**ï¼šæœ€æ–°è£½å“ã®ç‹¬å å‰²å¼•ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
    - **ç¥­ã‚Šã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚®ãƒ•ãƒˆ**ï¼šã‚®ãƒ•ãƒˆã‚„ç¥æ—¥ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚

    ğŸ‘‰ ç§ãŸã¡ã¨ä¸€ç·’ã«æ¢ç´¢ã—ã€å‰µé€ ã™ã‚‹æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ[|link_sf_facebook|]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä»Šã™ãå‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

.. _4.1.14_py:

4.1.14 ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ­ãƒƒã‚¯
================================

ã¯ã˜ã‚ã«
-------------

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ã¨LCDã‚’ä½¿ç”¨ã—ã¦ã€çµ„ã¿åˆã‚ã›ãƒ­ãƒƒã‚¯ã‚’ä½œæˆã—ã¾ã™ã€‚LCDã«ã¯ã€ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã‚ˆã†ã«ä¿ƒã™å¯¾å¿œã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚æ­£ã—ããƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå…¥åŠ›ã•ã‚ŒãŸå ´åˆã€ã€Œæ­£è§£ã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åŸºã«ã—ã¦ã€ãƒ–ã‚¶ãƒ¼ã‚„LEDãªã©ã®è¿½åŠ ã®é›»å­éƒ¨å“ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ã®ç•°ãªã‚‹å®Ÿé¨“ç¾è±¡ã‚’è¿½åŠ ã§ãã¾ã™ã€‚

å¿…è¦ãªéƒ¨å“
------------------------------

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå¿…è¦ã§ã™ã€‚

.. image:: ../img/list_Password_Lock.png
    :align: center

å…¨ä½“ã®ã‚­ãƒƒãƒˆã‚’è³¼å…¥ã™ã‚‹ã¨ç¢ºã‹ã«ä¾¿åˆ©ã§ã™ã€‚ã“ã¡ã‚‰ãŒãƒªãƒ³ã‚¯ã§ã™ï¼š

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - åå‰
        - ã“ã®ã‚­ãƒƒãƒˆã®ã‚¢ã‚¤ãƒ†ãƒ 
        - ãƒªãƒ³ã‚¯
    *   - Raphael Kit
        - 337
        - |link_Raphael_kit|

ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ã‚‚å€‹åˆ¥ã«è³¼å…¥ã§ãã¾ã™ã€‚

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç´¹ä»‹
        - è³¼å…¥ãƒªãƒ³ã‚¯

    *   - :ref:`cpn_gpio_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_i2c_lcd`
        - |link_i2clcd1602_buy|
    *   - :ref:`cpn_keypad`
        - \-

å›è·¯å›³
------------------

============ ======== ======== ===
T-Board Name physical wiringPi BCM
GPIO18       Pin 12   1        18
GPIO23       Pin 16   4        23
GPIO24       Pin 18   5        24
GPIO25       Pin 22   6        25
GPIO17       Pin 11   0        17
GPIO27       Pin 13   2        27
GPIO22       Pin 15   3        22
SPIMOSI      Pin 19   12       10
SDA1         Pin 3             
SCL1         Pin 5             
============ ======== ======== ===

.. image:: ../img/Schematic_three_one9.png
   :align: center

å®Ÿé¨“æ‰‹é †
-------------------------

**ã‚¹ãƒ†ãƒƒãƒ—1:** å›è·¯ã‚’çµ„ã¿ç«‹ã¦ã‚‹ã€‚

.. image:: ../img/image262.png

**ã‚¹ãƒ†ãƒƒãƒ—2:** ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¤‰æ›´ã™ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/raphael-kit/python/

**ã‚¹ãƒ†ãƒƒãƒ—3:** å®Ÿè¡Œã™ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block:: 

    sudo python3 4.1.14_PasswordLock.py

ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ï¼š1984ã€‚LCD1602ã«ã€Œæ­£è§£ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãã‚Œä»¥å¤–ã®å ´åˆã€ã€Œé–“é•ã£ãŸã‚­ãƒ¼ã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

.. note::

    * ã‚¨ãƒ©ãƒ¼ ``FileNotFoundError: [Errno 2] No such file or directory: '/dev/i2c-1'`` ãŒè¡¨ç¤ºã•ã‚ŒãŸå ´åˆã€ :ref:`i2c_config` ã‚’å‚ç…§ã—ã¦I2Cã‚’æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
    * ã‚¨ãƒ©ãƒ¼ ``ModuleNotFoundError: No module named 'smbus2'`` ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆã€ ``sudo apt install python3-smbus2`` ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
    * ã‚¨ãƒ©ãƒ¼ ``OSError: [Errno 121] Remote I/O error`` ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒèª¤ã£ã¦é…ç·šã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå£Šã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
    * ã‚³ãƒ¼ãƒ‰ã¨é…ç·šãŒæ­£ã—ã„ã«ã‚‚é–¢ã‚ã‚‰ãšã€LCDã«å†…å®¹ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã€èƒŒé¢ã®ãƒãƒ†ãƒ³ã‚·ãƒ§ãƒ¡ãƒ¼ã‚¿ã‚’å›ã—ã¦ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã‚’ä¸Šã’ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

**ã‚³ãƒ¼ãƒ‰**

.. note::
    ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ **å¤‰æ›´/ãƒªã‚»ãƒƒãƒˆ/ã‚³ãƒ”ãƒ¼/å®Ÿè¡Œ/åœæ­¢** ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ã‹ã—ã€ãã‚Œã‚’è¡Œã†å‰ã«ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒ‘ã‚¹ ``raphael-kit/python`` ã«ç§»å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ãŸå¾Œã€ãã®åŠ¹æœã‚’ç›´æ¥ç¢ºèªã™ã‚‹ãŸã‚ã«å®Ÿè¡Œã§ãã¾ã™ã€‚

.. raw:: html

    <run></run>

.. code-block:: python

    #!/usr/bin/env python3

    import RPi.GPIO as GPIO 
    import time
    import LCD1602

    ##################### HERE IS THE KEYPAD LIBRARY TRANSPLANTED FROM Arduino ############
    #class Key:Define some of the properties of Key
    class Keypad():

        def __init__(self, rowsPins, colsPins, keys):
            self.rowsPins = rowsPins
            self.colsPins = colsPins
            self.keys = keys
            GPIO.setwarnings(False)
            GPIO.setmode(GPIO.BCM)
            GPIO.setup(self.rowsPins, GPIO.OUT, initial=GPIO.LOW)
            GPIO.setup(self.colsPins, GPIO.IN, pull_up_down=GPIO.PUD_DOWN)

        def read(self):
            pressed_keys = []
            for i, row in enumerate(self.rowsPins):
                GPIO.output(row, GPIO.HIGH)
                for j, col in enumerate(self.colsPins):
                    index = i * len(self.colsPins) + j
                    if (GPIO.input(col) == 1):
                        pressed_keys.append(self.keys[index])
                GPIO.output(row, GPIO.LOW)
            return pressed_keys

    ################ EXAMPLE CODE START HERE ################        
    LENS = 4
    password=['1','9','8','4']
    testword=['0','0','0','0']
    keyIndex=0
    
    def check():
        for i in range(0,LENS):
            if(password[i]!=testword[i]):
                return 0
        return 1

    def setup():
        global keypad, last_key_pressed
        rowsPins = [18,23,24,25]
        colsPins = [10,22,27,17]
        keys = ["1","2","3","A",
                "4","5","6","B",
                "7","8","9","C",
                "*","0","#","D"]
        keypad = Keypad(rowsPins, colsPins, keys)
        last_key_pressed = []
        LCD1602.init(0x27, 1)    # init(slave address, background light)
        LCD1602.clear()
        LCD1602.write(0, 0, 'WELCOME!')
        LCD1602.write(2, 1, 'Enter password')
        time.sleep(2)

    def destroy():
        LCD1602.clear()
        GPIO.cleanup()

    def loop():
        global keyIndex
        global LENS
        global keypad, last_key_pressed
        while(True):
            pressed_keys = keypad.read()
            if len(pressed_keys) != 0 and last_key_pressed != pressed_keys:
                LCD1602.clear()
                LCD1602.write(0, 0, "Enter password:")
                LCD1602.write(15-keyIndex,1, pressed_keys)
                testword[keyIndex]=pressed_keys
                keyIndex+=1
                if (keyIndex is LENS):
                    if (check() is 0):
                        LCD1602.clear()
                        LCD1602.write(3, 0, "WRONG KEY!")
                        LCD1602.write(0, 1, "please try again")
                    else:
                        LCD1602.clear()
                        LCD1602.write(4, 0, "CORRECT!")
                        LCD1602.write(2, 1, "welcome back")
                keyIndex=keyIndex%LENS

            last_key_pressed = pressed_keys
            time.sleep(0.1)
            
    if __name__ == '__main__':     # Program start from here
        try:
            setup()
            loop()
        except KeyboardInterrupt:  # When 'Ctrl+C' is pressed, the program destroy() will be  executed.
            destroy()

**ã‚³ãƒ¼ãƒ‰èª¬æ˜**

.. code-block:: python

    LENS = 4
    password=['1','9','8','4']
    ...
    rowsPins = [18,23,24,25]
    colsPins = [10,22,27,17]
    keys = ["1","2","3","A",
            "4","5","6","B",
            "7","8","9","C",
            "*","0","#","D"]

ã“ã“ã§ã¯ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®é•·ã•LENSã€ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ã‚­ãƒ¼ã‚’ä¿å­˜ã™ã‚‹é…åˆ—keysã€ãŠã‚ˆã³æ­£ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä¿å­˜ã™ã‚‹é…åˆ—passwordã‚’å®šç¾©ã—ã¾ã™ã€‚

.. code-block:: python

    class Keypad():
        def __init__(self, rowsPins, colsPins, keys):
            self.rowsPins = rowsPins
            self.colsPins = colsPins
            self.keys = keys
            GPIO.setwarnings(False)
            GPIO.setmode(GPIO.BCM)
            GPIO.setup(self.rowsPins, GPIO.OUT, initial=GPIO.LOW)
            GPIO.setup(self.colsPins, GPIO.IN, pull_up_down=GPIO.PUD_DOWN)
    ...

ã“ã®ã‚¯ãƒ©ã‚¹ã¯ã€æŠ¼ã•ã‚ŒãŸã‚­ãƒ¼ã®å€¤ã‚’èª­ã¿å–ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€ã“ã®æ–‡æ›¸ã® :ref:`2.1.8_py` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

.. code-block:: python

    while(True):
            pressed_keys = keypad.read()
            if len(pressed_keys) != 0 and last_key_pressed != pressed_keys:
                LCD1602.clear()
                LCD1602.write(0, 0, "Enter password:")
                LCD1602.write(15-keyIndex,1, pressed_keys)
                testword[keyIndex]=pressed_keys
                keyIndex+=1
    ...

ã‚­ãƒ¼ã®å€¤ã‚’èª­ã¿å–ã‚Šã€ãƒ†ã‚¹ãƒˆé…åˆ—testwordã«ä¿å­˜ã—ã¾ã™ã€‚ä¿å­˜ã•ã‚ŒãŸã‚­ãƒ¼ã®å€¤ãŒ4ã‚’è¶…ãˆã‚‹å ´åˆã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®æ­£ç¢ºæ€§ãŒè‡ªå‹•çš„ã«ç¢ºèªã•ã‚Œã€ç¢ºèªçµæœãŒLCDã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

.. code-block:: python

    def check():
        for i in range(0,LENS):
            if(password[i]!=testword[i]):
                return 0
        return 1

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®æ­£ç¢ºæ€§ã‚’ç¢ºèªã—ã¾ã™ã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯1ã‚’è¿”ã—ã€ãã†ã§ãªã„å ´åˆã¯0ã‚’è¿”ã—ã¾ã™ã€‚

ç¾è±¡ã®ç”»åƒ
---------------------


.. image:: ../img/image263.jpeg
   :align: center