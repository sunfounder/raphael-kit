.. note::

    ã“ã‚“ã«ã¡ã¯ã€SunFounderã®Raspberry Pi & Arduino & ESP32æ„›å¥½å®¶ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã‚ˆã†ã“ãï¼Facebookä¸Šã§Raspberry Piã€Arduinoã€ESP32ã«ã¤ã„ã¦ã‚‚ã£ã¨æ·±ãæ˜ã‚Šä¸‹ã’ã€ä»–ã®æ„›å¥½å®¶ã¨äº¤æµã—ã¾ã—ã‚‡ã†ã€‚

    **å‚åŠ ã™ã‚‹ç†ç”±ã¯ï¼Ÿ**

    - **ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚µãƒãƒ¼ãƒˆ**ï¼šã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„ãƒãƒ¼ãƒ ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€è²©å£²å¾Œã®å•é¡Œã‚„æŠ€è¡“çš„ãªèª²é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚
    - **å­¦ã³ï¼†å…±æœ‰**ï¼šãƒ’ãƒ³ãƒˆã‚„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’äº¤æ›ã—ã¦ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚
    - **ç‹¬å çš„ãªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼šæ–°è£½å“ã®ç™ºè¡¨ã‚„å…ˆè¡Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚
    - **ç‰¹åˆ¥å‰²å¼•**ï¼šæœ€æ–°è£½å“ã®ç‹¬å å‰²å¼•ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
    - **ç¥­ã‚Šã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚®ãƒ•ãƒˆ**ï¼šã‚®ãƒ•ãƒˆã‚„ç¥æ—¥ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚

    ğŸ‘‰ ç§ãŸã¡ã¨ä¸€ç·’ã«æ¢ç´¢ã—ã€å‰µé€ ã™ã‚‹æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ[|link_sf_facebook|]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä»Šã™ãå‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

.. _4.1.1_py:

4.1.1 ã‚«ãƒ¡ãƒ©
=================

ã¯ã˜ã‚ã«
-----------------

ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨LEDãŒç‚¹æ»…ã—ãªãŒã‚‰å†™çœŸã‚’æ’®ã‚‹ã‚«ãƒ¡ãƒ©ã‚’ä½œæˆã—ã¾ã™ã€‚

å¿…è¦ãªéƒ¨å“
------------------------------

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¿…è¦ãªãƒ‘ãƒ¼ãƒ„ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

.. image:: ../img/3.1.15camera_list.png
  :width: 800
  :align: center

ä¸€å¼ã‚’ã¾ã¨ã‚ã¦è³¼å…¥ã™ã‚‹æ–¹ãŒä¾¿åˆ©ã§ã™ã€‚ãƒªãƒ³ã‚¯ã¯ã“ã¡ã‚‰ã§ã™ï¼š

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - åå‰
        - ã“ã®ã‚­ãƒƒãƒˆã®ã‚¢ã‚¤ãƒ†ãƒ 
        - ãƒªãƒ³ã‚¯
    *   - Raphael Kit
        - 337
        - |link_Raphael_kit|

ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ã€å„ãƒ‘ãƒ¼ãƒ„ã‚’å€‹åˆ¥ã«è³¼å…¥ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç´¹ä»‹
        - è³¼å…¥ãƒªãƒ³ã‚¯

    *   - :ref:`cpn_gpio_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_led`
        - |link_led_buy|
    *   - :ref:`cpn_button`
        - |link_button_buy|
    *   - :ref:`cpn_camera_module`
        - |link_camera_buy|

å›è·¯å›³
-----------------------

============ ======== ======== ===
T-Board Name physical wiringPi BCM
GPIO17       Pin 11   0        17
GPIO18       Pin 12   1        18
============ ======== ======== ===

.. image:: ../img/4.1.1_camera_schematic.png
   :align: center

å®Ÿé¨“æ‰‹é †
------------------------------

**ã‚¹ãƒ†ãƒƒãƒ—1:** å›è·¯ã‚’çµ„ã¿ç«‹ã¦ã¾ã™ã€‚

.. image:: ../img/4.1.1_camera_circuit.png
  :width: 800
  :align: center

**ã‚¹ãƒ†ãƒƒãƒ—2:** ã‚«ãƒ¡ãƒ©ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æ¥ç¶šã—ã€è¨­å®šã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚è©³ã—ãã¯ :ref:`cpn_camera_module` ã‚’å‚ç…§ã€‚

**ã‚¹ãƒ†ãƒƒãƒ—3:** Raspberry Piãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã«å…¥ã‚Šã¾ã™ã€‚ã‚ˆã‚Šè‰¯ã„ä½“é¨“ã®ãŸã‚ã«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãŒå¿…è¦ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼š `Raspberry Piã‚’æ¥ç¶šã™ã‚‹ <https://projects.raspberrypi.org/en/projects/raspberry-pi-setting-up/3>`_ ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ãƒªãƒ¢ãƒ¼ãƒˆã‹ã‚‰Raspberry Piã®ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚è©³ã—ã„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯ :ref:`remote_desktop` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**ã‚¹ãƒ†ãƒƒãƒ—4:** ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãã€ã‚³ãƒ¼ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¾ã™ã€‚

.. code-block::

    cd ~/raphael-kit/python/

**ã‚¹ãƒ†ãƒƒãƒ—5:** ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

.. code-block::

    sudo python3 4.1.1_Camera.py

ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€æ¬¡ã®å‹•ä½œãŒè¡Œã‚ã‚Œã¾ã™ï¼š

- ãƒ©ã‚¤ãƒ–ã‚«ãƒ¡ãƒ©ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‹ãã¾ã™ã€‚
- ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã‚‹ã®ã‚’å¾…æ©Ÿã—ã¾ã™ã€‚
- ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã‚‹ã¨ï¼š

  - LED ãŒ 3 å›ç‚¹æ»…ã—ã¾ã™ã€‚
  - ã‚«ãƒ¡ãƒ©ãŒå†™çœŸã‚’æ’®å½±ã—ã¾ã™ã€‚
  - LED ãŒç¢ºèªã¨ã—ã¦ 0.5 ç§’é–“ç‚¹ç¯ã—ã¾ã™ã€‚
  - æ’®å½±ã—ãŸç”»åƒã¯ ``/home/<username>/`` ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãã®ãƒ•ã‚¡ã‚¤ãƒ«åã§ä¿å­˜ã•ã‚Œã¾ã™ã€‚

- ``Ctrl+C`` ã‚’æŠ¼ã™ã¨ã€ã„ã¤ã§ã‚‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’åœæ­¢ã—ã€GPIO ãƒªã‚½ãƒ¼ã‚¹ã‚’è§£æ”¾ã—ã¦ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ­£å¸¸ã«çµ‚äº†ã§ãã¾ã™ã€‚

.. note::

    Pythonã®IDEã§ ``~/raphael-kit/python/`` ã® ``4.1.1_Camera.py`` ã‚’é–‹ãã€å®Ÿè¡Œãƒœã‚¿ãƒ³ã§ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã€ã‚¹ãƒˆãƒƒãƒ—ãƒœã‚¿ãƒ³ã§ã‚³ãƒ¼ãƒ‰ã‚’åœæ­¢ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

PCã«å†™çœŸã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã¯ :ref:`Filezilla Software` ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

**ã‚³ãƒ¼ãƒ‰**

.. code-block:: python

    #!/usr/bin/env python3
    import time
    import os
    import RPi.GPIO as GPIO
    from picamera2 import Picamera2, Preview

    # ----------------------------
    # GPIO SETUP
    # ----------------------------

    BUTTON_PIN = 18  # The push button is connected to GPIO18
    LED_PIN = 17     # The LED is connected to GPIO17

    GPIO.setmode(GPIO.BCM)  # Use BCM GPIO numbering

    # The button uses a 10K pull-up resistor externally.
    # When released â†’ HIGH, when pressed â†’ LOW.
    GPIO.setup(BUTTON_PIN, GPIO.IN, pull_up_down=GPIO.PUD_UP)

    # LED is an output (HIGH â†’ ON, LOW â†’ OFF)
    GPIO.setup(LED_PIN, GPIO.OUT)
    GPIO.output(LED_PIN, GPIO.LOW)  # Ensure LED is OFF at startup

    # ----------------------------
    # USER DIRECTORY SETUP
    # ----------------------------

    # Get the current logged-in username
    user = os.getlogin()

    # Build the path to the user's home directory (ex: /home/pi)
    user_home = os.path.expanduser(f"~{user}")

    # ----------------------------
    # CAMERA SETUP
    # ----------------------------

    # Create a Picamera2 object
    camera = Picamera2()

    # Create a preview configuration:
    # main â†’ the main camera stream
    # size â†’ resolution 800x600
    # format â†’ display format used by the preview window
    preview_config = camera.create_preview_configuration(
        main={"size": (800, 600), "format": "XRGB8888"}
    )

    # Apply the configuration to the camera
    camera.configure(preview_config)

    # Start the preview window using QTGL (GPU-accelerated)
    camera.start_preview(Preview.QTGL)

    # Start the camera hardware
    camera.start()

    print("Ready! Press the button to take a photo...")

    # ----------------------------
    # MAIN LOOP
    # ----------------------------
    try:
        while True:
            # Check if button is pressed (LOW means pressed)
            if GPIO.input(BUTTON_PIN) == GPIO.LOW:
                print("Button pressed! Taking photo...")

                # Flash LED 3 times to warn before taking the photo
                for _ in range(3):
                    GPIO.output(LED_PIN, GPIO.HIGH)
                    time.sleep(0.1)
                    GPIO.output(LED_PIN, GPIO.LOW)
                    time.sleep(0.1)

                # Build a unique filename using current date and time
                # Example: /home/pi/my_photo_20251201_143522.jpg
                timestamp = time.strftime("%Y%m%d_%H%M%S")
                filename = os.path.join(user_home, f"my_photo_{timestamp}.jpg")

                # Capture the image
                camera.capture_file(filename)

                print(f"Photo saved to: {filename}")

                # Turn LED ON briefly to confirm capture
                GPIO.output(LED_PIN, GPIO.HIGH)
                time.sleep(0.5)
                GPIO.output(LED_PIN, GPIO.LOW)

                # Debounce delay to prevent repeated triggers
                time.sleep(0.3)

            # Small delay to reduce CPU usage
            time.sleep(0.01)

    # ----------------------------
    # CLEAN EXIT WHEN CTRL+C IS PRESSED
    # ----------------------------
    except KeyboardInterrupt:
        print("\nCtrl+C received, exiting...")

    # ----------------------------
    # CLEANUP SECTION
    # ----------------------------
    finally:
        # Safely try to stop the camera preview
        try:
            camera.stop_preview()
        except:
            pass  # Ignore errors if preview wasn't running

        # Safely close the camera device
        try:
            camera.close()
        except:
            pass

        # Reset GPIO pins to a safe state
        GPIO.cleanup()

        print("Program exited cleanly.")

**ã‚³ãƒ¼ãƒ‰èª¬æ˜**

#. ``BUTTON_PIN`` ã«æ¥ç¶šã•ã‚ŒãŸãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚

   .. code-block:: python

       if GPIO.input(BUTTON_PIN) == GPIO.LOW:

   ãƒœã‚¿ãƒ³ã«ã¯ãƒ—ãƒ«ã‚¢ãƒƒãƒ—æŠµæŠ—ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€é€šå¸¸çŠ¶æ…‹ã¯ ``HIGH`` ã§ã™ã€‚  
   ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã‚‹ã¨ä¿¡å·ãŒ ``LOW`` ã«ãªã‚Šã€å†™çœŸæ’®å½±ãƒ—ãƒ­ã‚»ã‚¹ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚

#. å†™çœŸã‚’æ’®ã‚‹å‰ã«ã€LED ã‚’ 3 å›ç‚¹æ»…ã•ã›ã¦è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›ã—ã¾ã™ã€‚

   .. code-block:: python

       for _ in range(3):
           GPIO.output(LED_PIN, GPIO.HIGH)
           time.sleep(0.1)
           GPIO.output(LED_PIN, GPIO.LOW)
           time.sleep(0.1)

   ã“ã‚Œã¯ Raspberry Pi ãŒæ’®å½±æº–å‚™ã‚’ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚

#. ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä½¿ç”¨ã—ã¦ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ•ã‚¡ã‚¤ãƒ«åã‚’ç”Ÿæˆã—ã€å†™çœŸã‚’æ’®å½±ã—ã¾ã™ã€‚

   .. code-block:: python

       timestamp = time.strftime("%Y%m%d_%H%M%S")
       filename = os.path.join(user_home, f"my_photo_{timestamp}.jpg")
       camera.capture_file(filename)

   ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã«ã‚ˆã‚Šã€å„å†™çœŸã®ãƒ•ã‚¡ã‚¤ãƒ«åãŒé‡è¤‡ã—ãªã„ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  
   ç”»åƒã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

#. LED ã‚’ 0.5 ç§’é–“ç‚¹ç¯ã•ã›ã€å†™çœŸãŒæ’®å½±ã•ã‚ŒãŸã“ã¨ã‚’çŸ¥ã‚‰ã›ã¾ã™ã€‚

   .. code-block:: python

       GPIO.output(LED_PIN, GPIO.HIGH)
       time.sleep(0.5)
       GPIO.output(LED_PIN, GPIO.LOW)

   ã“ã®çŸ­ã„ç‚¹ç¯ãŒæ’®å½±æˆåŠŸã‚’ç¤ºã™ã‚µã‚¤ãƒ³ã«ãªã‚Šã¾ã™ã€‚

#. ãƒœã‚¿ãƒ³ãŒä¸€åº¦æŠ¼ã•ã‚ŒãŸéš›ã«è¤‡æ•°å›åå¿œã—ã¦ã—ã¾ã†ã®ã‚’é˜²ããŸã‚ã€çŸ­ã„é…å»¶ã‚’è¿½åŠ ã—ã¾ã™ã€‚

   .. code-block:: python

       time.sleep(0.3)

   ã“ã®ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†ã«ã‚ˆã‚Šã€å®‰å®šã—ãŸãƒœã‚¿ãƒ³å‹•ä½œãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚

ç¾è±¡ã®ç”»åƒ
------------------------

.. image:: ../img/4.1.1camera.JPG
   :align: center
