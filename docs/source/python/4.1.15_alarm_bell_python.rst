.. note::

    Hello, welcome to the SunFounder Raspberry Pi & Arduino & ESP32 Enthusiasts Community on Facebook! Dive deeper into Raspberry Pi, Arduino, and ESP32 with fellow enthusiasts.

    **Why Join?**

    - **Expert Support**: Solve post-sale issues and technical challenges with help from our community and team.
    - **Learn & Share**: Exchange tips and tutorials to enhance your skills.
    - **Exclusive Previews**: Get early access to new product announcements and sneak peeks.
    - **Special Discounts**: Enjoy exclusive discounts on our newest products.
    - **Festive Promotions and Giveaways**: Take part in giveaways and holiday promotions.

    ðŸ‘‰ Ready to explore and create with us? Click [|link_sf_facebook|] and join today!

.. _4.1.15_py:

4.1.15 Alarm Bell
================================

Introduction
-----------------

In this project, we will make a manual alarm device. You can replace the
toggle switch with a thermistor or a photosensitive sensor to make a
temperature alarm or a light alarm.

Required Components
------------------------------

In this project, we need the following components.

.. image:: ../img/list_Alarm_Bell.png
    :align: center

It's definitely convenient to buy a whole kit, here's the link: 

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Name	
        - ITEMS IN THIS KIT
        - LINK
    *   - Raphael Kit
        - 337
        - |link_Raphael_kit|

You can also buy them separately from the links below.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - COMPONENT INTRODUCTION
        - PURCHASE LINK

    *   - :ref:`cpn_gpio_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_led`
        - |link_led_buy|
    *   - :ref:`cpn_buzzer`
        - |link_passive_buzzer_buy|
    *   - :ref:`cpn_slide_switch`
        - |link_slide_switch_buy|
    *   - :ref:`cpn_transistor`
        - |link_transistor_buy|
    *   - :ref:`cpn_capacitor`
        - |link_capacitor_buy|

Schematic Diagram
-------------------------

============ ======== ======== ===
T-Board Name physical wiringPi BCM
GPIO17       Pin 11   0        17
GPIO18       Pin 12   1        18
GPIO27       Pin 13   2        27
GPIO22       Pin 15   3        22
============ ======== ======== ===

.. image:: ../img/Schematic_three_one10.png
   :align: center

Experimental Procedures
-----------------------------

**Step 1**: Build the circuit.

.. image:: ../img/image266.png

**Step 2:** Change directory.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/python/

**Step 3:** Run.

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 4.1.15_AlarmBell.py

After the program starts, the toggle switch will be toggled to the
right, and the buzzer will give out alarm sounds. At the same time, the
red and green LEDs will flash at a certain frequency.

**Code**

.. note::
    You can **Modify/Reset/Copy/Run/Stop** the code below. But before that, you need to go to  source code path like ``raphael-kit/python``.

.. raw:: html

    <run></run>

.. code-block:: python

    #!/usr/bin/env python3

    import RPi.GPIO as GPIO
    import time
    import threading

    BeepPin=22
    ALedPin=17
    BLedPin=27
    switchPin=18

    Buzz=0
    flag =0
    note=150
    pitch=20

    def setup():
        GPIO.setmode(GPIO.BCM)
        GPIO.setup(BeepPin, GPIO.OUT)
        GPIO.setup(ALedPin,GPIO.OUT,initial=GPIO.LOW)
        GPIO.setup(BLedPin,GPIO.OUT,initial=GPIO.LOW)
        GPIO.setup(switchPin,GPIO.IN)
        global Buzz
        Buzz=GPIO.PWM(BeepPin,note)

    def ledWork():
        while flag:
            GPIO.output(ALedPin,GPIO.HIGH)
            time.sleep(0.5)
            GPIO.output(ALedPin,GPIO.LOW)
            GPIO.output(BLedPin,GPIO.HIGH)
            time.sleep(0.5)
            GPIO.output(BLedPin,GPIO.LOW)

    def buzzerWork():
        global pitch
        global note
        while flag:
            if note >= 800 or note <=130:
                pitch = -pitch
            note = note + pitch 
            Buzz.ChangeFrequency(note)
            time.sleep(0.01)

    def on():
        global flag
        flag = 1
        Buzz.start(50)
        tBuzz = threading.Thread(target=buzzerWork) 
        tBuzz.start()
        tLed = threading.Thread(target=ledWork) 
        tLed.start()    

    def off():
        global flag
        flag = 0
        Buzz.stop()
        GPIO.output(ALedPin,GPIO.LOW)
        GPIO.output(BLedPin,GPIO.LOW)      

    def main():
        lastState=0
        while True:
            currentState =GPIO.input(switchPin)
            if currentState == 1 and lastState == 0:
                on()
            elif currentState == 0 and lastState == 1:
                off()
            lastState=currentState

    def destroy():
        off()
        GPIO.cleanup()

    if __name__ == '__main__':
        setup()
        try:
            main()
        except KeyboardInterrupt:
            destroy()

**Code Explanation**

.. code-block:: python

    importÂ threading

Here, we import the ``Threading`` module and it allows you to do
multiple things at once, while normal programs can only execute code
from top to bottom. With ``Threading`` modules, the LED and the buzzer
can work separately.

.. code-block:: python

    defÂ ledWork():
    Â Â Â Â whileÂ flag:
    Â Â Â Â Â Â Â Â GPIO.output(ALedPin,GPIO.HIGH)
    Â Â Â Â Â Â Â Â time.sleep(0.5)
    Â Â Â Â Â Â Â Â GPIO.output(ALedPin,GPIO.LOW)
    Â Â Â Â Â Â Â Â GPIO.output(BLedPin,GPIO.HIGH)
    Â Â Â Â Â Â Â Â time.sleep(0.5)
    Â Â Â Â Â Â Â Â GPIO.output(BLedPin,GPIO.LOW)

The function ``ledWork()`` helps to set the working state of these 2 LEDs:
it keeps the green LED lighting up for 0.5s and then turns off;
similarly, keeps the red LED lighting up for 0.5s and then turns off.

.. code-block:: python

    defÂ buzzerWork():
    Â Â Â Â globalÂ pitch
    Â Â Â Â globalÂ note
    Â Â Â Â whileÂ flag:
    Â Â Â Â Â Â Â Â ifÂ noteÂ >=Â 800Â orÂ noteÂ <=130:
    Â Â Â Â Â Â Â Â Â Â Â Â pitchÂ =Â -pitch
    Â Â Â Â Â Â Â Â noteÂ =Â noteÂ +Â pitchÂ 
    Â Â Â Â Â Â Â Â Buzz.ChangeFrequency(note)
    Â Â Â Â Â Â Â Â time.sleep(0.01)

The function ``buzzWork()`` is used to set the working state of the buzzer.
Here we set the frequency as between 130 and 800, to accumulate or decay
at an interval of 20.

.. code-block:: python

    defÂ on():
    Â Â Â Â globalÂ flag
    Â Â Â Â flagÂ =Â 1
    Â Â Â Â Buzz.start(50)
    Â Â Â Â tBuzzÂ =Â threading.Thread(target=buzzerWork)Â 
    Â Â Â Â tBuzz.start()
    Â Â Â Â tLedÂ =Â threading.Thread(target=ledWork)Â 
    Â Â Â Â tLed.start()Â Â 

In the function ``on()`` :

1) Define the mark â€œflag=1â€, indicating the ending of the control
   thread.

2) Start the Buzz, and set the duty cycle to 50%.

3) Create **2** separate threads so that the LED and the buzzer can work
   at the same time.

``threading.Thread()`` function is used to create the thread and its prototype is as follows:

   ``classÂ threading.Thread(group=None,Â target=None,Â name=None,Â args=(),Â kwargs={},Â *,Â daemon=None)``

Among the construction methods, the principal parameter is ``target``,
we need to assign a callable object (here are the functions ``ledWork``
and ``BuzzWork``) to ``target``.

Next ``start()`` is called to start the thread object, ex., ``tBuzz.start()`` is used to start the newly installed ``tBuzz`` thread.

.. code-block:: python

    defÂ off():
    Â Â Â Â globalÂ flag
    Â Â Â Â flagÂ =Â 0
    Â Â Â Â Buzz.stop()
    Â Â Â Â GPIO.output(ALedPin,GPIO.LOW)
    Â Â Â Â GPIO.output(BLedPin,GPIO.LOW)

The function ``Off()`` defines â€œflag=0â€ so as to exit the threads
**ledWork** and **BuzzWork** and then turn off the buzzer and the LED.

.. code-block:: python

    defÂ main():
    Â Â Â Â lastState=0
    Â Â Â Â whileÂ True:
    Â Â Â Â Â Â Â Â currentStateÂ =GPIO.input(switchPin)
    Â Â Â Â Â Â Â Â ifÂ currentStateÂ ==Â 1Â andÂ lastStateÂ ==Â 0:
    Â Â Â Â Â Â Â Â Â Â Â Â on()
    Â Â Â Â Â Â Â Â elifÂ currentStateÂ ==Â 0Â andÂ lastStateÂ ==Â 1:
    Â Â Â Â Â Â Â Â Â Â Â Â off()
    Â Â Â Â Â Â Â Â lastState=currentState

``Main()`` contains the whole process of the program: firstly read the value
of the slide switch; if the toggle switch is toggled to the right (the
reading is 1), the function ``on()`` is called, the buzzer is driven to emit
sounds and the the red and the green LEDs blink. Otherwise, the buzzer
and the LED donâ€™t work.

Phenomenon Picture
------------------------

.. image:: ../img/image267.jpeg
   :align: center