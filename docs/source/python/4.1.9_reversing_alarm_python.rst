.. note::

    隆Hola! Bienvenido a la comunidad de entusiastas de SunFounder Raspberry Pi, Arduino y ESP32 en Facebook. Sum茅rgete m谩s en Raspberry Pi, Arduino y ESP32 con otros entusiastas.

    **驴Por qu茅 unirse?**

    - **Soporte experto**: Resuelve problemas postventa y desaf铆os t茅cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprender y compartir**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Avances exclusivos**: Accede anticipadamente a nuevos anuncios de productos y adelantos exclusivos.
    - **Descuentos especiales**: Disfruta de descuentos exclusivos en nuestros productos m谩s recientes.
    - **Promociones y sorteos festivos**: Participa en sorteos y promociones navide帽as.

     驴Listo para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 煤nete hoy mismo.

.. _4.1.9_py:

4.1.9 Alarma de Reversa
=======================================

Introducci贸n
-----------------

En este proyecto, utilizaremos una pantalla LCD, un zumbador y sensores ultras贸nicos 
para crear un sistema de asistencia de reversa. Podemos colocarlo en un veh铆culo a 
control remoto para simular el proceso real de reversa en un garaje.

Componentes Necesarios
------------------------------

En este proyecto, necesitamos los siguientes componentes.

.. image:: ../img/list_Reversing_Alarm.png
    :align: center

Es muy conveniente comprar un kit completo, aqu铆 est谩 el enlace:

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nombre
        - ELEMENTOS EN ESTE KIT
        - ENLACE
    *   - Kit Raphael
        - 337
        - |link_Raphael_kit|

Tambi茅n puedes comprarlos por separado en los enlaces a continuaci贸n.

.. list-table::
    :widths: 30 20
    :header-rows: 1

    *   - INTRODUCCIN DEL COMPONENTE
        - ENLACE DE COMPRA

    *   - :ref:`cpn_gpio_extension_board`
        - |link_gpio_board_buy|
    *   - :ref:`cpn_breadboard`
        - |link_breadboard_buy|
    *   - :ref:`cpn_wires`
        - |link_wires_buy|
    *   - :ref:`cpn_resistor`
        - |link_resistor_buy|
    *   - :ref:`cpn_buzzer`
        - \-
    *   - :ref:`cpn_transistor`
        - |link_transistor_buy|
    *   - :ref:`cpn_ultrasonic_sensor`
        - |link_ultrasonic_buy|
    *   - :ref:`cpn_i2c_lcd`
        - |link_i2clcd1602_buy|

Diagrama Esquem谩tico
------------------------

El sensor ultras贸nico detecta la distancia entre 茅l y el obst谩culo que se mostrar谩 
en la pantalla LCD en forma de c贸digo. Al mismo tiempo, el sensor ultras贸nico permite 
que el zumbador emita un sonido de advertencia de frecuencia diferente seg煤n el valor 
de la distancia.

============== =============== ======== ===
Nombre T-Board cableado f铆sico wiringPi BCM
GPIO23         Pin 16          4        23
GPIO24         Pin 18          5        24
GPIO17         Pin 11          0        17
SDA1           Pin 3             
SCL1           Pin 5             
============== =============== ======== ===

.. image:: ../img/Schematic_three_one3.png
   :align: center

Procedimientos Experimentales
----------------------------------

**Paso 1:** Construye el circuito.

.. image:: ../img/image242.png
    :width: 700
    :align: center

**Paso 2:** Cambia de directorio.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/raphael-kit/python/

**Paso 3:** Ejecuta.

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 4.1.9_ReversingAlarm.py

Mientras el c贸digo se ejecuta, el m贸dulo del sensor ultras贸nico detecta la 
distancia al obst谩culo y luego muestra la informaci贸n sobre la distancia 
en el LCD1602; adem谩s, el zumbador emite un tono de advertencia cuya frecuencia 
cambia con la distancia.

.. note::

    * Si obtienes el error ``FileNotFoundError: [Errno 2] No such file or directory: '/dev/i2c-1'``, necesitas referirte a :ref:`i2c_config` para habilitar el I2C.
    * Si obtienes el error ``ModuleNotFoundError: No module named 'smbus2'``, por favor ejecuta ``sudo pip3 install smbus2``.
    * Si aparece el error ``OSError: [Errno 121] Remote I/O error``, significa que el m贸dulo est谩 mal cableado o el m贸dulo est谩 roto.
    * Si el c贸digo y el cableado est谩n bien, pero el LCD a煤n no muestra contenido, puedes girar el potenci贸metro en la parte trasera para aumentar el contraste.


**C贸digo**

.. note::
    Puedes **Modificar/Restablecer/Copiar/Ejecutar/Detener** el c贸digo a continuaci贸n. Pero antes de eso, necesitas ir a la ruta del c贸digo fuente como ``raphael-kit/python``. Despu茅s de modificar el c贸digo, puedes ejecutarlo directamente para ver el efecto.

.. raw:: html

    <run></run>

.. code-block:: python

    import LCD1602
    import time
    import RPi.GPIO as GPIO

    TRIG = 16
    ECHO = 18
    BUZZER = 11

    def lcdsetup():
        LCD1602.init(0x27, 1)   # init(slave address, background light)
        LCD1602.clear()   
        LCD1602.write(0, 0, 'Ultrasonic Starting')
        LCD1602.write(1, 1, 'By SunFounder')
        time.sleep(2)

    def setup():
        GPIO.setmode(GPIO.BOARD)
        GPIO.setup(TRIG, GPIO.OUT)
        GPIO.setup(ECHO, GPIO.IN)
        GPIO.setup(BUZZER, GPIO.OUT, initial=GPIO.LOW)
        lcdsetup()

    def distance():
        GPIO.output(TRIG, 0)
        time.sleep(0.000002)

        GPIO.output(TRIG, 1)
        time.sleep(0.00001)
        GPIO.output(TRIG, 0)

        while GPIO.input(ECHO) == 0:
            a = 0
        time1 = time.time()
        while GPIO.input(ECHO) == 1:
            a = 1
        time2 = time.time()

        during = time2 - time1
        return during * 340 / 2 * 100

    def destroy():
        GPIO.output(BUZZER, GPIO.LOW)
        GPIO.cleanup()
        LCD1602.clear()

    def loop():
        while True:
            dis = distance()
            print (dis, 'cm')
            print ('')
            GPIO.output(BUZZER, GPIO.LOW)
            if (dis > 400):
                LCD1602.clear()
                LCD1602.write(0, 0, 'Error')
                LCD1602.write(3, 1, 'Out of range')
                time.sleep(0.5)
            else:
                LCD1602.clear()
                LCD1602.write(0, 0, 'Distance is')
                LCD1602.write(5, 1, str(round(dis,2)) +' cm')
            if(dis>=50):
                    time.sleep(0.5)
            elif(dis<50 and dis>20):
                for i in range(0,2,1):
                        GPIO.output(BUZZER, GPIO.HIGH)
                        time.sleep(0.05)
                        GPIO.output(BUZZER, GPIO.LOW)
                        time.sleep(0.2)
            elif(dis<=20):
                for i in range(0,5,1):
                        GPIO.output(BUZZER, GPIO.HIGH)
                        time.sleep(0.05)
                        GPIO.output(BUZZER, GPIO.LOW)
                        time.sleep(0.05)


    if __name__ == "__main__":
        setup()
        try:       
            loop()
        except KeyboardInterrupt:
            destroy()



**Explicaci贸n del C贸digo**

.. code-block:: python

    def lcdsetup():
        LCD1602.init(0x27, 1)   # init(slave address, background light)

    def setup():
        GPIO.setmode(GPIO.BOARD)
        GPIO.setup(TRIG, GPIO.OUT)
        GPIO.setup(ECHO, GPIO.IN)
        GPIO.setup(BUZZER, GPIO.OUT, initial=GPIO.LOW)
        lcdsetup()

En este programa, aplicamos de manera sint茅tica los componentes utilizados anteriormente. 
Aqu铆 usamos zumbadores, LCD y ultrasonido. Podemos inicializarlos de la misma manera que 
hicimos antes.

.. code-block:: python

    dis = distance()
    print (dis, 'cm')
    print ('')
    GPIO.output(BUZZER, GPIO.LOW)
    if (dis > 400):
        LCD1602.clear()
        LCD1602.write(0, 0, 'Error')
        LCD1602.write(3, 1, 'Out of range')
        time.sleep(0.5)
    else:
        LCD1602.clear()
        LCD1602.write(0, 0, 'Distance is')
        LCD1602.write(5, 1, str(round(dis,2)) +' cm')

Aqu铆 obtenemos los valores del sensor ultras贸nico y calculamos la distancia. 
Si el valor de la distancia es mayor que el rango de detecci贸n, se imprime un 
mensaje de error en el LCD. Y si la distancia est谩 dentro del rango de trabajo, 
se mostrar谩n los resultados correspondientes.

.. code-block:: python

    LCD1602.write(5, 1, str(round(dis,2)) +' cm')

Dado que la salida del LCD solo soporta tipos de caracteres, necesitamos usar **str()** 
para convertir los valores num茅ricos a caracteres. Vamos a redondearlo a dos decimales.

.. code-block:: python

    if(dis>=50):
        time.sleep(0.5)
    elif(dis<50 and dis>20):
        for i in range(0,2,1):
            GPIO.output(BUZZER, GPIO.HIGH)
            time.sleep(0.05)
            GPIO.output(BUZZER, GPIO.LOW)
            time.sleep(0.2)
    elif(dis<=20):
        for i in range(0,5,1):
            GPIO.output(BUZZER, GPIO.HIGH)
            time.sleep(0.05)
            GPIO.output(BUZZER, GPIO.LOW)
            time.sleep(0.05)

Esta condici贸n de juicio se utiliza para controlar el sonido del zumbador. Seg煤n la diferencia 
en la distancia, se puede dividir en tres casos, en los cuales habr谩 diferentes frecuencias de 
sonido. Dado que el valor total de retardo es de 500 ms, todos ellos pueden proporcionar un 
intervalo de 500 ms para que el sensor ultras贸nico funcione.


Imagen del Fen贸meno
-----------------------

.. image:: ../img/image243.jpeg
   :align: center
